"use strict";d3.biHiSankey=function(){function n(n){return n.y+n.height/2}function t(n){return n.value}function e(n){n.sourceLinks=[],n.rightLinks=[],n.targetLinks=[],n.leftLinks=[],n.connectedNodes=[],n.children=[],n.ancestors=[]}function r(){b.forEach(function(n){C[n.id]=n,e(n)})}function i(){z=b.filter(function(n){return!n.children.length})}function u(){A=b.filter(function(n){return n.children.length})}function c(n){n.children.forEach(function(n){n.ancestors=n.ancestors.concat(this.ancestors.concat([this])),c(n)},n)}function o(){var n,t=[];b.forEach(function(e){n=C[e.parent],n?(e.parent=n,n.children.push(e)):(e.parent=null,t.push(e))}),i(),u(),t.forEach(function(n){c(n)})}function s(){var n,t;F.forEach(function(e){n=C[e.source]||e.source,t=C[e.target]||e.target,e.id=e.source+"-"+e.target,e.source=n,e.target=t,n.sourceLinks.push(e),t.targetLinks.push(e)})}function a(n){return n.filter(function(n){return"collapsed"===n.source.state&&"collapsed"===n.target.state})}function f(){z.forEach(function(n){n.sourceLinks.forEach(function(t){var e,r=t.target;z.indexOf(r)>=0&&(e=r.ancestors.filter(function(t){return n.ancestors.indexOf(t)<0}),e.forEach(function(e){var r={source:n,target:e,value:t.value,id:n.id+"-"+e.id};n.sourceLinks.push(r),e.targetLinks.push(r),F.push(r)}))}),n.targetLinks.forEach(function(t){var e,r=t.source;z.indexOf(r)>=0&&(e=r.ancestors.filter(function(t){return n.ancestors.indexOf(t)<0}),e.forEach(function(e){var r={source:e,target:n,value:t.value,id:e.id+"-"+n.id};e.sourceLinks.push(r),n.targetLinks.push(r),F.push(r)}))})}),A.forEach(function(n){n.sourceLinks.forEach(function(t){var e,r=t.target;z.indexOf(r)>=0&&(e=r.ancestors.filter(function(t){return n.ancestors.indexOf(t)<0}),e.forEach(function(e){var r={source:n,target:e,value:t.value,id:n.id+"-"+e.id};n.sourceLinks.push(r),e.targetLinks.push(r),F.push(r)}))})})}function h(){F=d3.nest().key(function(n){return n.source.id+"->"+n.target.id}).entries(F).map(function(n){return n.values}).map(function(n){return n.reduce(function(n,t){return{source:n.source,target:n.target,id:d3.min([n.id,t.id]),value:n.value+t.value}})})}function d(n){var e=Math.max(n.length-1,0)*M;return d3.sum(n,t)*H+e}function l(){b.forEach(function(n){n.value=Math.max(d3.sum(n.leftLinks,t),d3.sum(n.rightLinks,t)),n.netFlow=d3.sum(a(n.targetLinks),t)-d3.sum(a(n.sourceLinks),t),n.height=Math.max(d(a(n.leftLinks)),d(a(n.rightLinks))),n.linkSpaceCount=Math.max(Math.max(n.leftLinks.length,n.rightLinks.length)-1,0)})}function g(){var n,t;F.forEach(function(e){n=e.source,t=e.target,n.connectedNodes.indexOf(t)<0&&n.connectedNodes.push(t),t.connectedNodes.indexOf(n)<0&&t.connectedNodes.push(n)})}function k(){var n=[];return F.filter(function(n){return n.target.x===n.source.x}).forEach(function(t){n.indexOf(t.target)<0&&n.push(t.target)}),n}function v(){var n;d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(b).map(function(n){return n.values}).forEach(function(t){t.forEach(function(t){for(n=t.connectedNodes.map(function(n){return n.x});t.x>0&&n.indexOf(t.x-1)<0;)t.x-=1})})}function p(){var n=d3.min(b,function(n){return n.x}),t=d3.max(b,function(n){return n.x})-n;K=(S[0]-O)/t,b.forEach(function(n){n.x*=K})}function L(){for(var n=b,t,e=0,r=function n(e){t.indexOf(e.target)<0&&e.target.x===this.x&&t.push(e.target)},i=function n(t){t.x=e,t.width=O,t.sourceLinks.forEach(r,t)};n.length;)t=[],n.forEach(i),n=t.length?t:k(),e+=1;v(),p()}function x(){var n,t;b.forEach(function(n){n.rightLinks=[],n.leftLinks=[]}),F.forEach(function(e){n=e.source,t=e.target,n.x<t.x?(n.rightLinks.push(e),t.leftLinks.push(e),e.direction=1):(n.leftLinks.push(e),t.rightLinks.push(e),e.direction=-1)})}function E(n){b.forEach(function(t){t.y-=n})}function y(e){function r(){var n,t,e;H=d3.min(h,function(r){return n=d3.sum(r,function(n){return n.linkSpaceCount}),t=d3.sum(r,function(n){return n.value}),(e=S[1]-(r.length-1)*w-n*M)/t}),F.forEach(function(n){var t=Math.abs(n.source.x-n.target.x);t/(n.value*H)<4&&(H=.25*t/n.value)})}function i(){h.forEach(function(n){n.forEach(function(n,t){n.y=t,n.heightAllowance=n.value*H+M*n.linkSpaceCount})})}function u(){F.forEach(function(n){n.thickness=n.value*H})}function c(e){function r(t){return n(t.source)*t.value}h.forEach(function(i){i.forEach(function(i){if(i.rightLinks.length){var u=d3.sum(i.rightLinks,r)/d3.sum(i.rightLinks,t);i.y+=(u-n(i))*e}})})}function o(e){function r(t){return n(t.target)*t.value}h.slice().reverse().forEach(function(i){i.forEach(function(i){if(i.leftLinks.length){var u=d3.sum(i.leftLinks,r)/d3.sum(i.leftLinks,t);i.y+=(u-n(i))*e}})})}function s(){function n(n,t){return n.y-t.y}h.forEach(function(t){var e,r,i=0,u=t.length,c;for(t.sort(n),c=0;c<u;++c)e=t[c],r=i-e.y,r>0&&(e.y+=r),i=e.y+e.heightAllowance+w;if((r=i-w-S[1])>0)for(e.y-=r,i=e.y,c=u-2;c>=0;--c)e=t[c],r=e.y+e.heightAllowance+w-i,r>0&&(e.y-=r),i=e.y})}var a,f,h=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(b).map(function(n){return n.values});for(r(),i(),u(),s(),f=1;e>0;--e)f*=.99,o(f),s(),c(f),s();a=d3.min(b,function(n){return n.y}),E(a)}function m(){function n(n,t){var e=n.direction>0?n.source:n.target,r=t.direction>0?t.source:t.target;return e.y-r.y}function t(n,t){var e=n.direction>0?n.target:n.source,r=t.direction>0?t.target:t.source;return e.y-r.y}b.forEach(function(e){e.rightLinks.sort(t),e.leftLinks.sort(n)}),b.forEach(function(n){var t=0,e=0;n.rightLinks.forEach(function(n){n.direction>0?(n.sourceY=t,"collapsed"===n.target.state&&(t+=n.thickness+M)):(n.targetY=t,"collapsed"===n.source.state&&(t+=n.thickness+M))}),n.leftLinks.forEach(function(n){n.direction<0?(n.sourceY=e,"collapsed"===n.target.state&&(e+=n.thickness+M)):(n.targetY=e,"collapsed"===n.source.state&&(e+=n.thickness+M))})})}var N={},O=24,w=8,M=5,Y=0,S=[1,1],b=[],C={},A=[],z=[],F=[],K=1,H=1,W=.5;return N.arrowheadScaleFactor=function(n){return arguments.length?(Y=+n,N):Y},N.collapsedNodes=function(){return b.filter(function(n){return"collapsed"===n.state})},N.connected=function(n,t){return n.connectedNodes.indexOf(t)>=0},N.expandedNodes=function(){return b.filter(function(n){return"expanded"===n.state})},N.layout=function(n){return L(),x(),l(),y(n),l(),m(),N},N.link=function(){function n(n){var t=n.thickness*Y,e=3*n.thickness/4-t,i=n.source.x+n.source.width,u=i+t/2,c=n.target.x-e-t,o=d3.interpolateNumber(i,c),s=o(r),a=o(1-r),f=n.source.y+n.sourceY+n.thickness/2,h=n.target.y+n.targetY+n.thickness/2;return"M"+i+","+f+"L"+u+","+f+"C"+s+","+f+" "+a+","+h+" "+c+","+h+"L"+(c+e)+","+h}function t(n){var t=n.thickness*Y,e=n.thickness/4,i=n.source.x,u=i-t/2,c=n.target.x+n.target.width+e+t,o=d3.interpolateNumber(i,c),s=o(r),a=o(1-r),f=n.source.y+n.sourceY+n.thickness/2,h=n.target.y+n.targetY+n.thickness/2;return"M"+i+","+f+"L"+u+","+f+"C"+s+","+f+" "+a+","+h+" "+c+","+h+"L"+(c-e)+","+h}function e(e){return e.source.x<e.target.x?n(e):t(e)}var r=.5;return e.curvature=function(n){return arguments.length?(r=+n,e):r},e},N.links=function(n){return arguments.length?(F=n.filter(function(n){return n.source!==n.target}),N):F},N.linkSpacing=function(n){return arguments.length?(M=+n,N):M},N.nodes=function(n){return arguments.length?(b=n,N):b},N.nodeWidth=function(n){return arguments.length?(O=+n,N):O},N.nodeSpacing=function(n){return arguments.length?(w=+n,N):w},N.relayout=function(){return x(),l(),m(),N},N.size=function(n){return arguments.length?(S=n,N):S},N.visibleLinks=function(){return a(F)},N.initializeNodes=function(n){return r(),o(),s(),f(),h(),g(),b.forEach(n),N},N};
//# sourceMappingURL=./d3-sankeyBi-min.js.map