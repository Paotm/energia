{"version":3,"sources":["../src/js/d3-sankeyLoop.js"],"names":["d3","sankey","computeNodeLinks","nodes","forEach","node","sourceLinks","targetLinks","links","link","source","target","push","computeNodeValues","value","Math","max","sum","computeNodeBreadths","remainingNodes","nextNodes","x","cantidadCol","console","log","v","k","pos","length","dx","nodeWidth","indexOf","cycleBreaker","findAndMarkCycleBreaker","sinksRight","moveSinksRight","id","scaleNodeBreadths","size","depthFirstCycleSearch","cursorNode","path","n","l","weakest","pop","moveSourcesRight","min","d","kx","computeNodeDepths","iterations","initializeNodeDepth","ky","nodesByBreadth","nodePadding","i","y","dy","relaxLeftToRight","alpha","weightedSource","sy","breadth","center","relaxRightToLeft","weightedTarget","ty","slice","reverse","resolveCollisions","y0","sort","byValue","ascendingDepth","a","b","nest","key","sortKeys","ascending","entries","map","values","computeLinkDepths","ascendingSourceDepth","ascendingTargetDepth","first","second","firstValue","secondValue","_","arguments","layout","relayout","xs","xt","xi","interpolateNumber","xsc","curvature","xtc","ys","yt","xdelta","abs","xm","ym","ydelta"],"mappings":"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","file":"d3-sankeyLoop-min.js","sourcesContent":["d3.sankey = function() {\n  var sankey = {},\n      nodeWidth = 24,\n      nodePadding = 30,\n      size = [1, 1],\n      nodes = [],\n      links = [],\n      sinksRight = true;\n\n  sankey.nodeWidth = function(_) {\n    if (!arguments.length) return nodeWidth;\n    nodeWidth = +_;\n    return sankey;\n  };\n\n  sankey.nodePadding = function(_) {\n    if (!arguments.length) return nodePadding;\n    nodePadding = +_;\n    return sankey;\n  };\n\n  sankey.nodes = function(_) {\n    if (!arguments.length) return nodes;\n    nodes = _;\n    return sankey;\n  };\n\n  sankey.links = function(_) {\n    if (!arguments.length) return links;\n    links = _;\n    return sankey;\n  };\n\n  sankey.size = function(_) {\n    if (!arguments.length) return size;\n    size = _;\n    return sankey;\n  };\n\n sankey.sinksRight = function (_) {\n    if (!arguments.length) return sinksRight;\n    sinksRight = _;\n    return sankey;\n };\n\n  sankey.layout = function(iterations) {\n    computeNodeLinks();\n    computeNodeValues();\n    computeNodeBreadths();\n    computeNodeDepths(iterations);\n    return sankey;\n  };\n\n  sankey.relayout = function() {\n    computeLinkDepths();\n    return sankey;\n  };\n\n  // SVG path data generator, to be used as \"d\" attribute on \"path\" element selection.\n  sankey.link = function() {\n    var curvature = .5;\n\n    function link(d) {\n      var xs = d.source.x + d.source.dx,\n          xt = d.target.x,\n          xi = d3.interpolateNumber(xs, xt),\n          xsc = xi(curvature),\n          xtc = xi(1 - curvature),\n          ys = d.source.y + d.sy + d.dy / 2,\n          yt = d.target.y + d.ty + d.dy / 2;\n\n      if (!d.cycleBreaker) {\n        return \"M\" + xs + \",\" + ys\n             + \"C\" + xsc + \",\" + ys\n             + \" \" + xtc + \",\" + yt\n             + \" \" + xt + \",\" + yt;\n      } else {\n        var xdelta = (1.5 * d.dy + 0.05 * Math.abs(xs - xt));\n        xsc = xs + xdelta;\n        xtc = xt - xdelta;\n        var xm = xi(0.5);\n        var ym = d3.interpolateNumber(ys, yt)(0.5);\n        var ydelta = (2 * d.dy + 0.1 * Math.abs(xs - xt) + 0.1 * Math.abs(ys - yt)) * (ym < (size[1] / 2) ? -1 : 1);\n        return \"M\" + xs + \",\" + ys\n             + \"C\" + xsc + \",\" + ys\n             + \" \" + xsc + \",\" + (ys + ydelta)\n             + \" \" + xm + \",\" + (ym + ydelta)\n             + \"S\" + xtc + \",\" + yt\n             + \" \" + xt + \",\" + yt;\n\n      }\n    }\n\n    link.curvature = function(_) {\n      if (!arguments.length) return curvature;\n      curvature = +_;\n      return link;\n    };\n\n    return link;\n  };\n\n  // Populate the sourceLinks and targetLinks for each node.\n  // Also, if the source and target are not objects, assume they are indices.\n  function computeNodeLinks() {\n    nodes.forEach(function(node) {\n      // Links that have this node as source.\n      node.sourceLinks = [];\n      // Links that have this node as target.\n      node.targetLinks = [];\n    });\n    links.forEach(function(link) {\n      var source = link.source,\n          target = link.target;\n      if (typeof source === \"number\") source = link.source = nodes[link.source];\n      if (typeof target === \"number\") target = link.target = nodes[link.target];\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n  }\n\n  // Compute the value (size) of each node by summing the associated links.\n  function computeNodeValues() {\n    nodes.forEach(function(node) {\n      node.value = Math.max(\n        d3.sum(node.sourceLinks, value),\n        d3.sum(node.targetLinks, value)\n      );\n    });\n  }\n\n  // Iteratively assign the breadth (x-position) for each node.\n  // Nodes are assigned the maximum breadth of incoming neighbors plus one;\n  // nodes with no incoming links are assigned breadth zero, while\n  // nodes with no outgoing links are assigned the maximum breadth.\n  function computeNodeBreadths() {\n    var remainingNodes = nodes,\n        nextNodes,\n        x = 0,\n        cantidadCol = 4;\n\n    console.log('inicio'); // borrar\n    nodes.forEach((v, k) => {\n      console.log(v);\n      console.log(v.pos);\n    });\n    // Work from left to right.\n    // Keep updating the breath (x-position) of nodes that are target of recently updated nodes.\n\n    while (remainingNodes.length && x < nodes.length) {\n      nextNodes = [];\n\n      remainingNodes.forEach(function(node) {\n        node.x = node.pos - 1;\n        node.dx = nodeWidth;\n\n        node.sourceLinks.forEach(function(link) {\n          if (nextNodes.indexOf(link.target) < 0 && !link.cycleBreaker) {\n            nextNodes.push(link.target);\n          }\n        });\n      });\n\n      if (nextNodes.length == remainingNodes.length) {\n        // There must be a cycle here. Let's search for a link that breaks it.\n        findAndMarkCycleBreaker(nextNodes);\n        // Start over.\n        // TODO: make this optional?\n        return computeNodeBreadths();\n      } else {\n        remainingNodes = nextNodes;\n        ++x;\n      }\n    }\n\n    // Optionally move pure sinks always to the right.\n    if (sinksRight) {\n      moveSinksRight(cantidadCol);\n    }\n    console.log('inicio');\n    nodes.forEach((v, k) => {\n      if (v.id === 74) {\n        console.log(v.pos);\n        console.log(v.x);\n      }\n    });\n    // scaleNodeBreadths((size[0] - nodeWidth) / (x - 5));\n    scaleNodeBreadths((size[0] - nodeWidth) / (cantidadCol - 1));\n    console.log('inicio');\n    nodes.forEach((v, k) => {\n      if (v.id === 74) {\n        console.log(v.pos);\n        console.log(v.x);\n      }\n    });\n  }\n\n  // Find a link that breaks a cycle in the graph (if any).\n  function findAndMarkCycleBreaker(nodes) {\n  // Go through all nodes from the given subset and traverse links searching for cycles.\n    var link;\n    for (var n=nodes.length - 1; n >= 0; n--) {\n      link = depthFirstCycleSearch(nodes[n], []);\n      if (link) {\n        return link;\n      }\n    }\n\n    // Depth-first search to find a link that is part of a cycle.\n    function depthFirstCycleSearch(cursorNode, path) {\n      var target, link;\n      for (var n = cursorNode.sourceLinks.length - 1; n >= 0; n--) {\n        link = cursorNode.sourceLinks[n];\n        if (link.cycleBreaker) {\n          // Skip already known cycle breakers.\n          continue;\n        }\n\n        // Check if target of link makes a cycle in current path.\n        target = link.target;\n        for (var l = 0; l < path.length; l++) {\n          if (path[l].source == target) {\n            // We found a cycle. Search for weakest link in cycle\n            var weakest = link;\n            for (; l < path.length; l++) {\n              if (path[l].value < weakest.value) {\n                weakest = path[l];\n              }\n            }\n            // Mark weakest link as (known) cycle breaker and abort search.\n            weakest.cycleBreaker = true;\n            return weakest;\n          }\n        }\n\n        // Recurse deeper.\n        path.push(link);\n        link = depthFirstCycleSearch(target, path);\n        path.pop();\n        // Stop further search if we found a cycle breaker.\n        if (link) {\n          return link;\n        }\n      }\n    }\n  }\n\n\n  function moveSourcesRight() {\n    nodes.forEach(function(node) {\n      if (!node.targetLinks.length) {\n        node.x = d3.min(node.sourceLinks, function(d) { return d.target.x; }) - 1;\n      }\n    });\n  }\n\n  function moveSinksRight(x) {\n    nodes.forEach(function(node) {\n      if (!node.sourceLinks.length) {\n        node.x = x - 1;\n      }\n    });\n  }\n\n  function scaleNodeBreadths(kx) {\n    nodes.forEach(function(node) {\n      node.x *= kx;\n    });\n  }\n\n  // Compute the depth (y-position) for each node.\n  function computeNodeDepths(iterations) {\n    // Group nodes by breath.\n    var nodesByBreadth = d3.nest()\n        .key(function(d) { return d.x; })\n        .sortKeys(d3.ascending)\n        .entries(nodes)\n        .map(function(d) { return d.values; });\n\n    //\n    initializeNodeDepth();\n    resolveCollisions();\n    computeLinkDepths();\n    for (var alpha = 1; iterations > 0; --iterations) {\n      relaxRightToLeft(alpha *= .99);\n      resolveCollisions();\n      computeLinkDepths();\n      relaxLeftToRight(alpha);\n      resolveCollisions();\n      computeLinkDepths();\n    }\n\n    function initializeNodeDepth() {\n      // Calculate vertical scaling factor.\n      var ky = d3.min(nodesByBreadth, function(nodes) {\n        return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);\n      });\n\n      nodesByBreadth.forEach(function(nodes) {\n        nodes.forEach(function(node, i) {\n          node.y = i;\n          node.dy = node.value * ky;\n        });\n      });\n\n      links.forEach(function(link) {\n        link.dy = link.value * ky;\n      });\n    }\n\n    function relaxLeftToRight(alpha) {\n      nodesByBreadth.forEach(function(nodes, breadth) {\n        nodes.forEach(function(node) {\n          if (node.targetLinks.length) {\n            // Value-weighted average of the y-position of source node centers linked to this node.\n            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedSource(link) {\n        return (link.source.y + link.sy + link.dy / 2) * link.value;\n      }\n    }\n\n    function relaxRightToLeft(alpha) {\n      nodesByBreadth.slice().reverse().forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.sourceLinks.length) {\n            // Value-weighted average of the y-positions of target nodes linked to this node.\n            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);\n            node.y += (y - center(node)) * alpha;\n          }\n        });\n      });\n\n      function weightedTarget(link) {\n        return (link.target.y + link.ty + link.dy / 2) * link.value;\n      }\n    }\n\n    function resolveCollisions() {\n      nodesByBreadth.forEach(function(nodes) {\n        var node,\n            dy,\n            y0 = 0,\n            n = nodes.length,\n            i;\n\n        // Push any overlapping nodes down.\n        nodes.sort(byValue);\n        for (i = 0; i < n; ++i) {\n          node = nodes[i];\n          dy = y0 - node.y;\n          if (dy > 0) node.y += dy;\n          y0 = node.y + node.dy + nodePadding;\n        }\n\n        // If the bottommost node goes outside the bounds, push it back up.\n        dy = y0 - nodePadding - size[1];\n        if (dy > 0) {\n          y0 = node.y -= dy;\n\n          // Push any overlapping nodes back up.\n          for (i = n - 2; i >= 0; --i) {\n            node = nodes[i];\n            dy = node.y + node.dy + nodePadding - y0;\n            if (dy > 0) node.y -= dy;\n            y0 = node.y;\n          }\n        }\n      });\n    }\n\n    function ascendingDepth(a, b) {\n      return a.y - b.y;\n    }\n  }\n\n  // Compute y-offset of the source endpoint (sy) and target endpoints (ty) of links,\n  // relative to the source/target node's y-position.\n  function computeLinkDepths() {\n    nodes.forEach(function(node) {\n      node.sourceLinks.sort(byValue);\n      node.targetLinks.sort(byValue);\n    });\n    nodes.forEach(function(node) {\n      var sy = 0, ty = 0;\n      node.sourceLinks.forEach(function(link) {\n        link.sy = sy;\n        sy += link.dy;\n      });\n      node.targetLinks.forEach(function(link) {\n        link.ty = ty;\n        ty += link.dy;\n      });\n    });\n\n    function ascendingSourceDepth(a, b) {\n      return a.source.y - b.source.y;\n    }\n\n    function ascendingTargetDepth(a, b) {\n      return a.target.y - b.target.y;\n    }\n  }\n\n  // Y-position of the middle of a node.\n  function center(node) {\n    return node.y + node.dy / 2;\n  }\n\n  // Value property accessor.\n  function value(x) {\n    return x.value;\n  }\n\n  // Alteración del código\n  // Ordena los nodos de mayor a menor en función de su valor\n  function byValue(first, second) {\n    let firstValue = first.value,\n        secondValue = second.value;\n\n    if (firstValue < secondValue) {\n      return 1;\n    } else if (firstValue > secondValue) {\n      return -1;\n    }\n\n    return 0;\n  }\n\n  return sankey;\n};\n"]}