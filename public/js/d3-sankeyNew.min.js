"use strict";

d3.sankey = function () {
  var sankey = {},
      nodeWidth = 24,
      nodePadding = 30,
      size = [1, 1],
      nodes = [],
      links = [],
      components = [];

  sankey.nodeWidth = function (_) {
    if (!arguments.length) return nodeWidth;
    nodeWidth = +_;
    return sankey;
  };

  sankey.nodePadding = function (_) {
    if (!arguments.length) return nodePadding;
    nodePadding = +_;
    return sankey;
  };

  sankey.nodes = function (_) {
    if (!arguments.length) return nodes;
    nodes = _;
    return sankey;
  };

  sankey.links = function (_) {
    if (!arguments.length) return links;
    links = _;
    return sankey;
  };

  sankey.size = function (_) {
    if (!arguments.length) return size;
    size = _;
    return sankey;
  };

  sankey.layout = function (iterations) {
    computeNodeLinks();
    computeNodeValues();

    computeNodeStructure();
    computeNodeBreadths();

    computeNodeDepths(iterations);
    computeLinkDepths();

    return sankey;
  };

  sankey.relayout = function () {
    computeLinkDepths();
    return sankey;
  };

  // A more involved path generator that requires 3 elements to render --
  // It draws a starting element, intermediate and end element that are useful
  // while drawing reverse links to get an appropriate fill.
  //
  // Each link is now an area and not a basic spline and no longer guarantees
  // fixed width throughout.
  //
  // Sample usage:
  //
  //  linkNodes = this._svg.append("g").selectAll(".link")
  //      .data(this.links)
  //    .enter().append("g")
  //      .attr("fill", "none")
  //      .attr("class", ".link")
  //      .sort(function(a, b) { return b.dy - a.dy; });
  //
  //  linkNodePieces = [];
  //  for (var i = 0; i < 3; i++) {
  //    linkNodePieces[i] = linkNodes.append("path")
  //      .attr("class", ".linkPiece")
  //      .attr("d", path(i))
  //      .attr("fill", ...)
  //  }
  sankey.reversibleLink = function () {
    var curvature = 0.5;

    // Used when source is behind target, the first and last paths are simple
    // lines at the start and end node while the second path is the spline
    function forwardLink(part, d) {
      var x0 = d.source.x + d.source.dx,
          x1 = d.target.x,
          xi = d3.interpolateNumber(x0, x1),
          x2 = xi(curvature),
          x3 = xi(1 - curvature),
          y0 = d.source.y + d.sy,
          y1 = d.target.y + d.ty,
          y2 = d.source.y + d.sy + d.dy,
          y3 = d.target.y + d.ty + d.dy;

      switch (part) {
        case 0:
          return "M" + x0 + "," + y0 + "L" + x0 + "," + (y0 + d.dy);

        case 1:
          return "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1 + "L" + x1 + "," + y3 + "C" + x3 + "," + y3 + " " + x2 + "," + y2 + " " + x0 + "," + y2 + "Z";

        case 2:
          return "M" + x1 + "," + y1 + "L" + x1 + "," + (y1 + d.dy);
      }
    }

    // Used for self loops and when the source is actually in front of the
    // target; the first element is a turning path from the source to the
    // destination, the second element connects the two twists and the last
    // twists into the target element.
    //
    //
    //  /--Target
    //  \----------------------\
    //                 Source--/
    //
    function backwardLink(part, d) {
      var curveExtension = 30;
      var curveDepth = 15;

      function getDir(d) {
        return d.source.y + d.sy > d.target.y + d.ty ? -1 : 1;
      }

      function p(x, y) {
        return x + "," + y + " ";
      }

      var dt = getDir(d) * curveDepth,
          x0 = d.source.x + d.source.dx,
          y0 = d.source.y + d.sy,
          x1 = d.target.x,
          y1 = d.target.y + d.ty;

      switch (part) {
        case 0:
          return "M" + p(x0, y0) + "C" + p(x0, y0) + p(x0 + curveExtension, y0) + p(x0 + curveExtension, y0 + dt) + "L" + p(x0 + curveExtension, y0 + dt + d.dy) + "C" + p(x0 + curveExtension, y0 + d.dy) + p(x0, y0 + d.dy) + p(x0, y0 + d.dy) + "Z";
        case 1:
          return "M" + p(x0 + curveExtension, y0 + dt) + "C" + p(x0 + curveExtension, y0 + 3 * dt) + p(x1 - curveExtension, y1 - 3 * dt) + p(x1 - curveExtension, y1 - dt) + "L" + p(x1 - curveExtension, y1 - dt + d.dy) + "C" + p(x1 - curveExtension, y1 - 3 * dt + d.dy) + p(x0 + curveExtension, y0 + 3 * dt + d.dy) + p(x0 + curveExtension, y0 + dt + d.dy) + "Z";

        case 2:
          return "M" + p(x1 - curveExtension, y1 - dt) + "C" + p(x1 - curveExtension, y1) + p(x1, y1) + p(x1, y1) + "L" + p(x1, y1 + d.dy) + "C" + p(x1, y1 + d.dy) + p(x1 - curveExtension, y1 + d.dy) + p(x1 - curveExtension, y1 + d.dy - dt) + "Z";
      }
    }

    return function (part) {
      return function (d) {
        if (d.source.x < d.target.x) {
          return forwardLink(part, d);
        } else {
          return backwardLink(part, d);
        }
      };
    };
  };

  // The standard link path using a constant width spline that needs a
  // single path element.
  sankey.link = function () {
    var curvature = .5;

    function link(d) {
      var x0 = d.source.x + d.source.dx,
          x1 = d.target.x,
          xi = d3.interpolateNumber(x0, x1),
          x2 = xi(curvature),
          x3 = xi(1 - curvature),
          y0 = d.source.y + d.sy + d.dy / 2,
          y1 = d.target.y + d.ty + d.dy / 2;
      return "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1;
    }

    link.curvature = function (_) {
      if (!arguments.length) return curvature;
      curvature = +_;
      return link;
    };

    return link;
  };

  // Populate the sourceLinks and targetLinks for each node.
  // Also, if the source and target are not objects, assume they are indices.
  var computeNodeLinks = function computeNodeLinks() {
    var source = void 0,
        target = void 0;

    nodes.forEach(function (node) {
      node.sourceLinks = [];
      node.targetLinks = [];
    });
    links.forEach(function (link) {
      source = link.source = nodes[parseInt(link.source)];
      target = link.target = nodes[parseInt(link.target)];
      source.sourceLinks.push(link);
      target.targetLinks.push(link);
    });
  };

  // Compute the value (size) of each node by summing the associated links.
  var computeNodeValues = function computeNodeValues() {
    var fluid = void 0;

    nodes.forEach(function (node) {
      if (!node.value) {
        fluid = Math.max(d3.sum(node.sourceLinks, value), d3.sum(node.targetLinks, value));

        node.value = fluid;
      }
    });
  };

  // Take the list of nodes and create a DAG of supervertices, each consisting
  // of a strongly connected component of the graph
  //
  // Based off:
  // http://en.wikipedia.org/wiki/Tarjan's_strongly_connected_components_algorithm
  var computeNodeStructure = function computeNodeStructure() {
    var nodeStack = [],
        index = 0;

    var connect = function connect(node) {

      node.lowIndex = node.index = index++;
      node.onStack = true;
      nodeStack.push(node);

      var target = void 0;

      if (node.sourceLinks) {
        node.sourceLinks.forEach(function (sourceLink) {
          target = sourceLink.target;

          if (!target.hasOwnProperty('index')) {
            connect(target);
            node.lowIndex = Math.min(node.lowIndex, target.lowIndex);
          } else if (target.onStack) {
            node.lowIndex = Math.min(node.lowIndex, target.index);
          }
        });

        // console.log('connect');
        // console.log(components.length);
        // console.log(node);

        if (node.lowIndex === node.index) {
          var component = [],
              currentNode;

          do {
            currentNode = nodeStack.pop();
            currentNode.onStack = false;
            component.push(currentNode);
          } while (currentNode != node);

          components.push({
            root: node,
            scc: component
          });
        } else {}
      }
    };

    nodes.forEach(function (node) {
      if (!node.index) {
        connect(node);
      }
    });

    components.forEach(function (component, i) {
      component.index = i;
      component.scc.forEach(function (node) {
        node.component = i;
      });
    });
  };

  // Assign the breadth (x-position) for each strongly connected component,
  // followed by assigning breadth within the component.
  function computeNodeBreadths() {
    layerComponents();
    // console.log(sankey.nodes().length);
    // console.log(components.length);
    components.forEach(function (component, i) {
      bfs(component.root, function (node) {
        var result = node.sourceLinks.filter(function (sourceLink) {
          return sourceLink.target.component == i;
        }).map(function (sourceLink) {
          return sourceLink.target;
        });
        return result;
      });
    });

    var max = 0;

    var componentsByBreadth = d3.nest().key(function (d) {
      // console.log('aca');
      // return d.scc[0].pos;
      return d.root.pos;
      // return d.x;
    }).sortKeys(d3.ascending).entries(components).map(function (d) {
      return d.values;
    });

    var max = -1,
        nextMax = -1;
    componentsByBreadth.forEach(function (c) {
      c.forEach(function (component) {
        component.x = max + 1;
        component.scc.forEach(function (node) {
          if (node.layer) node.x = node.layer;else node.x = component.x + node.x;
          nextMax = Math.max(nextMax, node.x);
        });
      });
      max = nextMax;
    });

    nodes.filter(function (node) {
      var outLinks = node.sourceLinks.filter(function (link) {
        return link.source.name != link.target.name;
      });
      return outLinks.length == 0;
    }).forEach(function (node) {
      node.x = max;
    });

    scaleNodeBreadths((size[0] - nodeWidth) / Math.max(max, 1));

    function flatten(a) {
      return [].concat.apply([], a);
    }

    function layerComponents() {
      var remainingComponents = components,
          nextComponents,
          visitedIndex,
          x = 0;

      while (remainingComponents.length) {
        nextComponents = [];
        visitedIndex = {};

        remainingComponents.forEach(function (component) {
          component.x = x;

          component.scc.forEach(function (n) {
            n.sourceLinks.forEach(function (l) {
              if (!visitedIndex.hasOwnProperty(l.target.component) && l.target.component != component.index) {
                nextComponents.push(components[l.target.component]);
                visitedIndex[l.target.component] = true;
              }
            });
          });
        });

        remainingComponents = nextComponents;
        ++x;
      }
    }

    function bfs(node, extractTargets) {
      var queue = [node],
          currentCount = 1,
          nextCount = 0;
      var x = 0;

      while (currentCount > 0) {
        var currentNode = queue.shift();
        currentCount--;

        if (!currentNode.hasOwnProperty('x')) {
          currentNode.x = x;
          currentNode.dx = nodeWidth;

          var targets = extractTargets(currentNode);

          queue = queue.concat(targets);
          nextCount += targets.length;
        }

        if (currentCount == 0) {
          // level change
          x++;
          currentCount = nextCount;
          nextCount = 0;
        }
      }
    }
  }

  function moveSourcesRight() {
    nodes.forEach(function (node) {
      if (!node.targetLinks.length) {
        node.x = d3.min(node.sourceLinks, function (d) {
          return d.target.x;
        }) - 1;
      }
    });
  }

  function moveSinksRight(x) {
    nodes.forEach(function (node) {
      if (!node.sourceLinks.length) {
        node.x = x - 1;
      }
    });
  }

  function scaleNodeBreadths(kx) {
    nodes.forEach(function (node) {
      node.x *= kx;
    });
  }

  function computeNodeDepths(iterations) {
    var nodesByBreadth = d3.nest().key(function (d) {
      return d.x;
    }).sortKeys(d3.ascending).entries(nodes).map(function (d) {
      return d.values;
    });

    initializeNodeDepth();
    resolveCollisions();

    for (var alpha = 1; iterations > 0; --iterations) {
      relaxLeftToRight(alpha);
      resolveCollisions();
      relaxRightToLeft(alpha);
      resolveCollisions();
    }

    function initializeNodeDepth() {
      var ky = d3.min(nodesByBreadth, function (nodes) {
        return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);
      });

      nodesByBreadth.forEach(function (nodes) {
        nodes.forEach(function (node, i) {
          node.y = i;
          node.dy = node.value * ky;
        });
      });

      links.forEach(function (link) {
        link.dy = link.value * ky;
      });
    }

    function relaxLeftToRight(alpha) {

      nodesByBreadth.forEach(function (nodes, breadth) {
        nodes.forEach(function (node) {
          if (node.targetLinks.length) {
            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);
            node.y += (y - center(node)) * alpha;
          }
        });
      });

      function weightedSource(link) {
        return center(link.source) * link.value;
      }
    }

    function relaxRightToLeft(alpha) {
      nodesByBreadth.slice().reverse().forEach(function (nodes) {
        nodes.forEach(function (node) {
          if (node.sourceLinks.length) {
            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);
            node.y += (y - center(node)) * alpha;
          }
        });
      });

      function weightedTarget(link) {
        return center(link.target) * link.value;
      }
    }

    function resolveCollisions() {
      nodesByBreadth.forEach(function (nodes) {
        var node,
            dy,
            y0 = 0,
            n = nodes.length,
            i;

        // Push any overlapping nodes down.
        // Alteracion del codigo
        nodes.sort(byValue);
        // nodes.sort(ascendingDepth);
        for (i = 0; i < n; ++i) {
          node = nodes[i];
          dy = y0 - node.y;
          if (dy > 0) node.y += dy;
          y0 = node.y + node.dy + nodePadding;
        }

        // If the bottommost node goes outside the bounds, push it back up.
        dy = y0 - nodePadding - size[1];
        if (dy > 0) {
          y0 = node.y -= dy;

          // Push any overlapping nodes back up.
          for (i = n - 2; i >= 0; --i) {
            node = nodes[i];
            dy = node.y + node.dy + nodePadding - y0;
            if (dy > 0) node.y -= dy;
            y0 = node.y;
          }
        }
      });
    }
    function ascendingDepth(a, b) {
      return b.y - a.y;
      // return a.y - b.y;
    }
  }

  // Alteración del código
  // Ordena los nodos de mayor a menor en función de su valor
  function byValue(first, second) {
    var firstValue = first.value,
        secondValue = second.value;

    if (firstValue < secondValue) {
      return 1;
    } else if (firstValue > secondValue) {
      return -1;
    }

    return 0;
  }

  function computeLinkDepths() {
    nodes.forEach(function (node) {
      // Alteracion del codigo
      node.sourceLinks.sort(byValue);
      // node.sourceLinks.sort(ascendingTargetDepth);
      // Alteracion del codigo
      node.targetLinks.sort(byValue);
      // node.targetLinks.sort(ascendingSourceDepth);
    });
    nodes.forEach(function (node) {
      var sy = 0,
          ty = 0;
      node.sourceLinks.forEach(function (link) {
        link.sy = sy;
        sy += link.dy;
      });
      node.targetLinks.forEach(function (link) {
        link.ty = ty;
        ty += link.dy;
      });
    });

    function ascendingSourceDepth(a, b) {
      return b.source.y - a.source.y;
      // return a.source.y - b.source.y;
    }

    function ascendingTargetDepth(a, b) {
      return b.target.y - a.target.y;
      // return a.target.y - b.target.y;
    }
  }

  function center(node) {
    return node.y + node.dy / 2;
  }

  function value(link) {
    return link.value;
  }

  return sankey;
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImQzLXNhbmtleU5ldy5qcyJdLCJuYW1lcyI6WyJkMyIsInNhbmtleSIsIm5vZGVXaWR0aCIsIm5vZGVQYWRkaW5nIiwic2l6ZSIsIm5vZGVzIiwibGlua3MiLCJjb21wb25lbnRzIiwiXyIsImFyZ3VtZW50cyIsImxlbmd0aCIsImxheW91dCIsIml0ZXJhdGlvbnMiLCJjb21wdXRlTm9kZUxpbmtzIiwiY29tcHV0ZU5vZGVWYWx1ZXMiLCJjb21wdXRlTm9kZVN0cnVjdHVyZSIsImNvbXB1dGVOb2RlQnJlYWR0aHMiLCJjb21wdXRlTm9kZURlcHRocyIsImNvbXB1dGVMaW5rRGVwdGhzIiwicmVsYXlvdXQiLCJyZXZlcnNpYmxlTGluayIsImN1cnZhdHVyZSIsImZvcndhcmRMaW5rIiwicGFydCIsImQiLCJ4MCIsInNvdXJjZSIsIngiLCJkeCIsIngxIiwidGFyZ2V0IiwieGkiLCJpbnRlcnBvbGF0ZU51bWJlciIsIngyIiwieDMiLCJ5MCIsInkiLCJzeSIsInkxIiwidHkiLCJ5MiIsImR5IiwieTMiLCJiYWNrd2FyZExpbmsiLCJjdXJ2ZUV4dGVuc2lvbiIsImN1cnZlRGVwdGgiLCJnZXREaXIiLCJwIiwiZHQiLCJsaW5rIiwiZm9yRWFjaCIsIm5vZGUiLCJzb3VyY2VMaW5rcyIsInRhcmdldExpbmtzIiwicGFyc2VJbnQiLCJwdXNoIiwiZmx1aWQiLCJ2YWx1ZSIsIk1hdGgiLCJtYXgiLCJzdW0iLCJub2RlU3RhY2siLCJpbmRleCIsImNvbm5lY3QiLCJsb3dJbmRleCIsIm9uU3RhY2siLCJzb3VyY2VMaW5rIiwiaGFzT3duUHJvcGVydHkiLCJtaW4iLCJjb21wb25lbnQiLCJjdXJyZW50Tm9kZSIsInBvcCIsInJvb3QiLCJzY2MiLCJpIiwibGF5ZXJDb21wb25lbnRzIiwiYmZzIiwicmVzdWx0IiwiZmlsdGVyIiwibWFwIiwiY29tcG9uZW50c0J5QnJlYWR0aCIsIm5lc3QiLCJrZXkiLCJwb3MiLCJzb3J0S2V5cyIsImFzY2VuZGluZyIsImVudHJpZXMiLCJ2YWx1ZXMiLCJuZXh0TWF4IiwiYyIsImxheWVyIiwib3V0TGlua3MiLCJuYW1lIiwic2NhbGVOb2RlQnJlYWR0aHMiLCJmbGF0dGVuIiwiYSIsImNvbmNhdCIsImFwcGx5IiwicmVtYWluaW5nQ29tcG9uZW50cyIsIm5leHRDb21wb25lbnRzIiwidmlzaXRlZEluZGV4IiwibiIsImwiLCJleHRyYWN0VGFyZ2V0cyIsInF1ZXVlIiwiY3VycmVudENvdW50IiwibmV4dENvdW50Iiwic2hpZnQiLCJ0YXJnZXRzIiwibW92ZVNvdXJjZXNSaWdodCIsIm1vdmVTaW5rc1JpZ2h0Iiwia3giLCJub2Rlc0J5QnJlYWR0aCIsImluaXRpYWxpemVOb2RlRGVwdGgiLCJyZXNvbHZlQ29sbGlzaW9ucyIsImFscGhhIiwicmVsYXhMZWZ0VG9SaWdodCIsInJlbGF4UmlnaHRUb0xlZnQiLCJreSIsImJyZWFkdGgiLCJ3ZWlnaHRlZFNvdXJjZSIsImNlbnRlciIsInNsaWNlIiwicmV2ZXJzZSIsIndlaWdodGVkVGFyZ2V0Iiwic29ydCIsImJ5VmFsdWUiLCJhc2NlbmRpbmdEZXB0aCIsImIiLCJmaXJzdCIsInNlY29uZCIsImZpcnN0VmFsdWUiLCJzZWNvbmRWYWx1ZSIsImFzY2VuZGluZ1NvdXJjZURlcHRoIiwiYXNjZW5kaW5nVGFyZ2V0RGVwdGgiXSwibWFwcGluZ3MiOiI7O0FBQUFBLEdBQUdDLE1BQUgsR0FBWSxZQUFXO0FBQ3JCLE1BQUlBLFNBQVMsRUFBYjtBQUFBLE1BQ0lDLFlBQVksRUFEaEI7QUFBQSxNQUVJQyxjQUFjLEVBRmxCO0FBQUEsTUFHSUMsT0FBTyxDQUFDLENBQUQsRUFBSSxDQUFKLENBSFg7QUFBQSxNQUlJQyxRQUFRLEVBSlo7QUFBQSxNQUtJQyxRQUFRLEVBTFo7QUFBQSxNQU1JQyxhQUFhLEVBTmpCOztBQVFBTixTQUFPQyxTQUFQLEdBQW1CLFVBQVNNLENBQVQsRUFBWTtBQUM3QixRQUFJLENBQUNDLFVBQVVDLE1BQWYsRUFBdUIsT0FBT1IsU0FBUDtBQUN2QkEsZ0JBQVksQ0FBQ00sQ0FBYjtBQUNBLFdBQU9QLE1BQVA7QUFDRCxHQUpEOztBQU1BQSxTQUFPRSxXQUFQLEdBQXFCLFVBQVNLLENBQVQsRUFBWTtBQUMvQixRQUFJLENBQUNDLFVBQVVDLE1BQWYsRUFBdUIsT0FBT1AsV0FBUDtBQUN2QkEsa0JBQWMsQ0FBQ0ssQ0FBZjtBQUNBLFdBQU9QLE1BQVA7QUFDRCxHQUpEOztBQU1BQSxTQUFPSSxLQUFQLEdBQWUsVUFBU0csQ0FBVCxFQUFZO0FBQ3pCLFFBQUksQ0FBQ0MsVUFBVUMsTUFBZixFQUF1QixPQUFPTCxLQUFQO0FBQ3ZCQSxZQUFRRyxDQUFSO0FBQ0EsV0FBT1AsTUFBUDtBQUNELEdBSkQ7O0FBTUFBLFNBQU9LLEtBQVAsR0FBZSxVQUFTRSxDQUFULEVBQVk7QUFDekIsUUFBSSxDQUFDQyxVQUFVQyxNQUFmLEVBQXVCLE9BQU9KLEtBQVA7QUFDdkJBLFlBQVFFLENBQVI7QUFDQSxXQUFPUCxNQUFQO0FBQ0QsR0FKRDs7QUFNQUEsU0FBT0csSUFBUCxHQUFjLFVBQVNJLENBQVQsRUFBWTtBQUN4QixRQUFJLENBQUNDLFVBQVVDLE1BQWYsRUFBdUIsT0FBT04sSUFBUDtBQUN2QkEsV0FBT0ksQ0FBUDtBQUNBLFdBQU9QLE1BQVA7QUFDRCxHQUpEOztBQU1BQSxTQUFPVSxNQUFQLEdBQWdCLFVBQVNDLFVBQVQsRUFBcUI7QUFDbkNDO0FBQ0FDOztBQUVBQztBQUNBQzs7QUFFQUMsc0JBQWtCTCxVQUFsQjtBQUNBTTs7QUFFQSxXQUFPakIsTUFBUDtBQUNELEdBWEQ7O0FBYUFBLFNBQU9rQixRQUFQLEdBQWtCLFlBQVc7QUFDM0JEO0FBQ0EsV0FBT2pCLE1BQVA7QUFDRCxHQUhEOztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUEsU0FBT21CLGNBQVAsR0FBd0IsWUFBVztBQUNqQyxRQUFJQyxZQUFZLEdBQWhCOztBQUVBO0FBQ0E7QUFDQSxhQUFTQyxXQUFULENBQXFCQyxJQUFyQixFQUEyQkMsQ0FBM0IsRUFBOEI7QUFDNUIsVUFBSUMsS0FBS0QsRUFBRUUsTUFBRixDQUFTQyxDQUFULEdBQWFILEVBQUVFLE1BQUYsQ0FBU0UsRUFBL0I7QUFBQSxVQUNJQyxLQUFLTCxFQUFFTSxNQUFGLENBQVNILENBRGxCO0FBQUEsVUFFSUksS0FBSy9CLEdBQUdnQyxpQkFBSCxDQUFxQlAsRUFBckIsRUFBeUJJLEVBQXpCLENBRlQ7QUFBQSxVQUdJSSxLQUFLRixHQUFHVixTQUFILENBSFQ7QUFBQSxVQUlJYSxLQUFLSCxHQUFHLElBQUlWLFNBQVAsQ0FKVDtBQUFBLFVBS0ljLEtBQUtYLEVBQUVFLE1BQUYsQ0FBU1UsQ0FBVCxHQUFhWixFQUFFYSxFQUx4QjtBQUFBLFVBTUlDLEtBQUtkLEVBQUVNLE1BQUYsQ0FBU00sQ0FBVCxHQUFhWixFQUFFZSxFQU54QjtBQUFBLFVBT0lDLEtBQUtoQixFQUFFRSxNQUFGLENBQVNVLENBQVQsR0FBYVosRUFBRWEsRUFBZixHQUFvQmIsRUFBRWlCLEVBUC9CO0FBQUEsVUFRSUMsS0FBS2xCLEVBQUVNLE1BQUYsQ0FBU00sQ0FBVCxHQUFhWixFQUFFZSxFQUFmLEdBQW9CZixFQUFFaUIsRUFSL0I7O0FBVUEsY0FBUWxCLElBQVI7QUFDRSxhQUFLLENBQUw7QUFDRSxpQkFBTyxNQUFNRSxFQUFOLEdBQVcsR0FBWCxHQUFpQlUsRUFBakIsR0FBc0IsR0FBdEIsR0FBNEJWLEVBQTVCLEdBQWlDLEdBQWpDLElBQXdDVSxLQUFLWCxFQUFFaUIsRUFBL0MsQ0FBUDs7QUFFRixhQUFLLENBQUw7QUFDRSxpQkFBTyxNQUFNaEIsRUFBTixHQUFXLEdBQVgsR0FBaUJVLEVBQWpCLEdBQ0EsR0FEQSxHQUNNRixFQUROLEdBQ1csR0FEWCxHQUNpQkUsRUFEakIsR0FDc0IsR0FEdEIsR0FDNEJELEVBRDVCLEdBQ2lDLEdBRGpDLEdBQ3VDSSxFQUR2QyxHQUM0QyxHQUQ1QyxHQUNrRFQsRUFEbEQsR0FDdUQsR0FEdkQsR0FDNkRTLEVBRDdELEdBRUEsR0FGQSxHQUVNVCxFQUZOLEdBRVcsR0FGWCxHQUVpQmEsRUFGakIsR0FHQSxHQUhBLEdBR01SLEVBSE4sR0FHVyxHQUhYLEdBR2lCUSxFQUhqQixHQUdzQixHQUh0QixHQUc0QlQsRUFINUIsR0FHaUMsR0FIakMsR0FHdUNPLEVBSHZDLEdBRzRDLEdBSDVDLEdBR2tEZixFQUhsRCxHQUd1RCxHQUh2RCxHQUc2RGUsRUFIN0QsR0FJQSxHQUpQOztBQU1GLGFBQUssQ0FBTDtBQUNFLGlCQUFPLE1BQU1YLEVBQU4sR0FBVyxHQUFYLEdBQWlCUyxFQUFqQixHQUFzQixHQUF0QixHQUE0QlQsRUFBNUIsR0FBaUMsR0FBakMsSUFBd0NTLEtBQUtkLEVBQUVpQixFQUEvQyxDQUFQO0FBWko7QUFjRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQVNFLFlBQVQsQ0FBc0JwQixJQUF0QixFQUE0QkMsQ0FBNUIsRUFBK0I7QUFDN0IsVUFBSW9CLGlCQUFpQixFQUFyQjtBQUNBLFVBQUlDLGFBQWEsRUFBakI7O0FBRUEsZUFBU0MsTUFBVCxDQUFnQnRCLENBQWhCLEVBQW1CO0FBQ2pCLGVBQU9BLEVBQUVFLE1BQUYsQ0FBU1UsQ0FBVCxHQUFhWixFQUFFYSxFQUFmLEdBQW9CYixFQUFFTSxNQUFGLENBQVNNLENBQVQsR0FBYVosRUFBRWUsRUFBbkMsR0FBd0MsQ0FBQyxDQUF6QyxHQUE2QyxDQUFwRDtBQUNEOztBQUVELGVBQVNRLENBQVQsQ0FBV3BCLENBQVgsRUFBY1MsQ0FBZCxFQUFpQjtBQUNmLGVBQU9ULElBQUksR0FBSixHQUFVUyxDQUFWLEdBQWMsR0FBckI7QUFDRDs7QUFFRCxVQUFJWSxLQUFLRixPQUFPdEIsQ0FBUCxJQUFZcUIsVUFBckI7QUFBQSxVQUNJcEIsS0FBS0QsRUFBRUUsTUFBRixDQUFTQyxDQUFULEdBQWFILEVBQUVFLE1BQUYsQ0FBU0UsRUFEL0I7QUFBQSxVQUVJTyxLQUFLWCxFQUFFRSxNQUFGLENBQVNVLENBQVQsR0FBYVosRUFBRWEsRUFGeEI7QUFBQSxVQUdJUixLQUFLTCxFQUFFTSxNQUFGLENBQVNILENBSGxCO0FBQUEsVUFJSVcsS0FBS2QsRUFBRU0sTUFBRixDQUFTTSxDQUFULEdBQWFaLEVBQUVlLEVBSnhCOztBQU1BLGNBQVFoQixJQUFSO0FBQ0UsYUFBSyxDQUFMO0FBQ0UsaUJBQU8sTUFBTXdCLEVBQUV0QixFQUFGLEVBQU1VLEVBQU4sQ0FBTixHQUNBLEdBREEsR0FDTVksRUFBRXRCLEVBQUYsRUFBTVUsRUFBTixDQUROLEdBRU1ZLEVBQUV0QixLQUFLbUIsY0FBUCxFQUF1QlQsRUFBdkIsQ0FGTixHQUdNWSxFQUFFdEIsS0FBS21CLGNBQVAsRUFBdUJULEtBQUthLEVBQTVCLENBSE4sR0FJQSxHQUpBLEdBSU1ELEVBQUV0QixLQUFLbUIsY0FBUCxFQUF1QlQsS0FBS2EsRUFBTCxHQUFVeEIsRUFBRWlCLEVBQW5DLENBSk4sR0FLQSxHQUxBLEdBS01NLEVBQUV0QixLQUFLbUIsY0FBUCxFQUF1QlQsS0FBS1gsRUFBRWlCLEVBQTlCLENBTE4sR0FNTU0sRUFBRXRCLEVBQUYsRUFBTVUsS0FBS1gsRUFBRWlCLEVBQWIsQ0FOTixHQU9NTSxFQUFFdEIsRUFBRixFQUFNVSxLQUFLWCxFQUFFaUIsRUFBYixDQVBOLEdBUUEsR0FSUDtBQVNGLGFBQUssQ0FBTDtBQUNFLGlCQUFPLE1BQU1NLEVBQUV0QixLQUFLbUIsY0FBUCxFQUF1QlQsS0FBS2EsRUFBNUIsQ0FBTixHQUNBLEdBREEsR0FDTUQsRUFBRXRCLEtBQUttQixjQUFQLEVBQXVCVCxLQUFLLElBQUlhLEVBQWhDLENBRE4sR0FFTUQsRUFBRWxCLEtBQUtlLGNBQVAsRUFBdUJOLEtBQUssSUFBSVUsRUFBaEMsQ0FGTixHQUdNRCxFQUFFbEIsS0FBS2UsY0FBUCxFQUF1Qk4sS0FBS1UsRUFBNUIsQ0FITixHQUlBLEdBSkEsR0FJTUQsRUFBRWxCLEtBQUtlLGNBQVAsRUFBdUJOLEtBQUtVLEVBQUwsR0FBVXhCLEVBQUVpQixFQUFuQyxDQUpOLEdBS0EsR0FMQSxHQUtNTSxFQUFFbEIsS0FBS2UsY0FBUCxFQUF1Qk4sS0FBSyxJQUFJVSxFQUFULEdBQWN4QixFQUFFaUIsRUFBdkMsQ0FMTixHQU1NTSxFQUFFdEIsS0FBS21CLGNBQVAsRUFBdUJULEtBQUssSUFBSWEsRUFBVCxHQUFjeEIsRUFBRWlCLEVBQXZDLENBTk4sR0FPTU0sRUFBRXRCLEtBQUttQixjQUFQLEVBQXVCVCxLQUFLYSxFQUFMLEdBQVV4QixFQUFFaUIsRUFBbkMsQ0FQTixHQVFBLEdBUlA7O0FBVUYsYUFBSyxDQUFMO0FBQ0UsaUJBQU8sTUFBTU0sRUFBRWxCLEtBQUtlLGNBQVAsRUFBdUJOLEtBQUtVLEVBQTVCLENBQU4sR0FDQSxHQURBLEdBQ01ELEVBQUVsQixLQUFLZSxjQUFQLEVBQXVCTixFQUF2QixDQUROLEdBRU1TLEVBQUVsQixFQUFGLEVBQU1TLEVBQU4sQ0FGTixHQUdNUyxFQUFFbEIsRUFBRixFQUFNUyxFQUFOLENBSE4sR0FJQSxHQUpBLEdBSU1TLEVBQUVsQixFQUFGLEVBQU1TLEtBQUtkLEVBQUVpQixFQUFiLENBSk4sR0FLQSxHQUxBLEdBS01NLEVBQUVsQixFQUFGLEVBQU1TLEtBQUtkLEVBQUVpQixFQUFiLENBTE4sR0FNTU0sRUFBRWxCLEtBQUtlLGNBQVAsRUFBdUJOLEtBQUtkLEVBQUVpQixFQUE5QixDQU5OLEdBT01NLEVBQUVsQixLQUFLZSxjQUFQLEVBQXVCTixLQUFLZCxFQUFFaUIsRUFBUCxHQUFZTyxFQUFuQyxDQVBOLEdBUUEsR0FSUDtBQXZCSjtBQWlDRDs7QUFFRCxXQUFPLFVBQVN6QixJQUFULEVBQWU7QUFDcEIsYUFBTyxVQUFTQyxDQUFULEVBQVk7QUFDakIsWUFBSUEsRUFBRUUsTUFBRixDQUFTQyxDQUFULEdBQWFILEVBQUVNLE1BQUYsQ0FBU0gsQ0FBMUIsRUFBNkI7QUFDM0IsaUJBQU9MLFlBQVlDLElBQVosRUFBa0JDLENBQWxCLENBQVA7QUFDRCxTQUZELE1BRU87QUFDTCxpQkFBT21CLGFBQWFwQixJQUFiLEVBQW1CQyxDQUFuQixDQUFQO0FBQ0Q7QUFDRixPQU5EO0FBT0QsS0FSRDtBQVNELEdBeEdEOztBQTBHQTtBQUNBO0FBQ0F2QixTQUFPZ0QsSUFBUCxHQUFjLFlBQVc7QUFDdkIsUUFBSTVCLFlBQVksRUFBaEI7O0FBRUEsYUFBUzRCLElBQVQsQ0FBY3pCLENBQWQsRUFBaUI7QUFDZixVQUFJQyxLQUFLRCxFQUFFRSxNQUFGLENBQVNDLENBQVQsR0FBYUgsRUFBRUUsTUFBRixDQUFTRSxFQUEvQjtBQUFBLFVBQ0lDLEtBQUtMLEVBQUVNLE1BQUYsQ0FBU0gsQ0FEbEI7QUFBQSxVQUVJSSxLQUFLL0IsR0FBR2dDLGlCQUFILENBQXFCUCxFQUFyQixFQUF5QkksRUFBekIsQ0FGVDtBQUFBLFVBR0lJLEtBQUtGLEdBQUdWLFNBQUgsQ0FIVDtBQUFBLFVBSUlhLEtBQUtILEdBQUcsSUFBSVYsU0FBUCxDQUpUO0FBQUEsVUFLSWMsS0FBS1gsRUFBRUUsTUFBRixDQUFTVSxDQUFULEdBQWFaLEVBQUVhLEVBQWYsR0FBb0JiLEVBQUVpQixFQUFGLEdBQU8sQ0FMcEM7QUFBQSxVQU1JSCxLQUFLZCxFQUFFTSxNQUFGLENBQVNNLENBQVQsR0FBYVosRUFBRWUsRUFBZixHQUFvQmYsRUFBRWlCLEVBQUYsR0FBTyxDQU5wQztBQU9BLGFBQU8sTUFBTWhCLEVBQU4sR0FBVyxHQUFYLEdBQWlCVSxFQUFqQixHQUNBLEdBREEsR0FDTUYsRUFETixHQUNXLEdBRFgsR0FDaUJFLEVBRGpCLEdBRUEsR0FGQSxHQUVNRCxFQUZOLEdBRVcsR0FGWCxHQUVpQkksRUFGakIsR0FHQSxHQUhBLEdBR01ULEVBSE4sR0FHVyxHQUhYLEdBR2lCUyxFQUh4QjtBQUlEOztBQUVEVyxTQUFLNUIsU0FBTCxHQUFpQixVQUFTYixDQUFULEVBQVk7QUFDM0IsVUFBSSxDQUFDQyxVQUFVQyxNQUFmLEVBQXVCLE9BQU9XLFNBQVA7QUFDdkJBLGtCQUFZLENBQUNiLENBQWI7QUFDQSxhQUFPeUMsSUFBUDtBQUNELEtBSkQ7O0FBTUEsV0FBT0EsSUFBUDtBQUNELEdBeEJEOztBQTBCQTtBQUNBO0FBQ0EsTUFBTXBDLG1CQUFtQixTQUFuQkEsZ0JBQW1CLEdBQU07QUFDN0IsUUFBSWEsZUFBSjtBQUFBLFFBQVlJLGVBQVo7O0FBRUF6QixVQUFNNkMsT0FBTixDQUFjLFVBQUNDLElBQUQsRUFBVTtBQUN0QkEsV0FBS0MsV0FBTCxHQUFtQixFQUFuQjtBQUNBRCxXQUFLRSxXQUFMLEdBQW1CLEVBQW5CO0FBQ0QsS0FIRDtBQUlBL0MsVUFBTTRDLE9BQU4sQ0FBYyxVQUFDRCxJQUFELEVBQVU7QUFDdEJ2QixlQUFTdUIsS0FBS3ZCLE1BQUwsR0FBY3JCLE1BQU1pRCxTQUFTTCxLQUFLdkIsTUFBZCxDQUFOLENBQXZCO0FBQ0FJLGVBQVNtQixLQUFLbkIsTUFBTCxHQUFjekIsTUFBTWlELFNBQVNMLEtBQUtuQixNQUFkLENBQU4sQ0FBdkI7QUFDQUosYUFBTzBCLFdBQVAsQ0FBbUJHLElBQW5CLENBQXdCTixJQUF4QjtBQUNBbkIsYUFBT3VCLFdBQVAsQ0FBbUJFLElBQW5CLENBQXdCTixJQUF4QjtBQUNELEtBTEQ7QUFNRCxHQWJEOztBQWVBO0FBQ0EsTUFBTW5DLG9CQUFvQixTQUFwQkEsaUJBQW9CLEdBQU07QUFDOUIsUUFBSTBDLGNBQUo7O0FBRUFuRCxVQUFNNkMsT0FBTixDQUFjLFVBQUNDLElBQUQsRUFBVTtBQUN0QixVQUFJLENBQUNBLEtBQUtNLEtBQVYsRUFBaUI7QUFDZkQsZ0JBQVFFLEtBQUtDLEdBQUwsQ0FDTjNELEdBQUc0RCxHQUFILENBQU9ULEtBQUtDLFdBQVosRUFBeUJLLEtBQXpCLENBRE0sRUFFTnpELEdBQUc0RCxHQUFILENBQU9ULEtBQUtFLFdBQVosRUFBeUJJLEtBQXpCLENBRk0sQ0FBUjs7QUFLQU4sYUFBS00sS0FBTCxHQUFhRCxLQUFiO0FBQ0Q7QUFDRixLQVREO0FBVUQsR0FiRDs7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTXpDLHVCQUF1QixTQUF2QkEsb0JBQXVCLEdBQU07QUFDakMsUUFBSThDLFlBQVksRUFBaEI7QUFBQSxRQUNJQyxRQUFRLENBRFo7O0FBR0EsUUFBSUMsVUFBVSxTQUFWQSxPQUFVLENBQUNaLElBQUQsRUFBVTs7QUFHdEJBLFdBQUthLFFBQUwsR0FBZ0JiLEtBQUtXLEtBQUwsR0FBYUEsT0FBN0I7QUFDQVgsV0FBS2MsT0FBTCxHQUFlLElBQWY7QUFDQUosZ0JBQVVOLElBQVYsQ0FBZUosSUFBZjs7QUFFQSxVQUFJckIsZUFBSjs7QUFFQSxVQUFJcUIsS0FBS0MsV0FBVCxFQUFzQjtBQUNwQkQsYUFBS0MsV0FBTCxDQUFpQkYsT0FBakIsQ0FBeUIsVUFBQ2dCLFVBQUQsRUFBZ0I7QUFDdkNwQyxtQkFBU29DLFdBQVdwQyxNQUFwQjs7QUFFQSxjQUFJLENBQUNBLE9BQU9xQyxjQUFQLENBQXNCLE9BQXRCLENBQUwsRUFBcUM7QUFDbkNKLG9CQUFRakMsTUFBUjtBQUNBcUIsaUJBQUthLFFBQUwsR0FBZ0JOLEtBQUtVLEdBQUwsQ0FBU2pCLEtBQUthLFFBQWQsRUFBd0JsQyxPQUFPa0MsUUFBL0IsQ0FBaEI7QUFDRCxXQUhELE1BR08sSUFBSWxDLE9BQU9tQyxPQUFYLEVBQW9CO0FBQ3pCZCxpQkFBS2EsUUFBTCxHQUFnQk4sS0FBS1UsR0FBTCxDQUFTakIsS0FBS2EsUUFBZCxFQUF3QmxDLE9BQU9nQyxLQUEvQixDQUFoQjtBQUNEO0FBQ0YsU0FURDs7QUFXQTtBQUNBO0FBQ0E7O0FBRUEsWUFBSVgsS0FBS2EsUUFBTCxLQUFrQmIsS0FBS1csS0FBM0IsRUFBa0M7QUFDaEMsY0FBSU8sWUFBWSxFQUFoQjtBQUFBLGNBQW9CQyxXQUFwQjs7QUFFQSxhQUFHO0FBQ0RBLDBCQUFjVCxVQUFVVSxHQUFWLEVBQWQ7QUFDQUQsd0JBQVlMLE9BQVosR0FBc0IsS0FBdEI7QUFDQUksc0JBQVVkLElBQVYsQ0FBZWUsV0FBZjtBQUNELFdBSkQsUUFJU0EsZUFBZW5CLElBSnhCOztBQU1BNUMscUJBQVdnRCxJQUFYLENBQWdCO0FBQ2RpQixrQkFBTXJCLElBRFE7QUFFZHNCLGlCQUFLSjtBQUZTLFdBQWhCO0FBSUQsU0FiRCxNQWFPLENBRU47QUFDRjtBQUNGLEtBMUNEOztBQTRDQWhFLFVBQU02QyxPQUFOLENBQWMsVUFBQ0MsSUFBRCxFQUFVO0FBQ3RCLFVBQUksQ0FBQ0EsS0FBS1csS0FBVixFQUFpQjtBQUNmQyxnQkFBUVosSUFBUjtBQUNEO0FBQ0YsS0FKRDs7QUFNQTVDLGVBQVcyQyxPQUFYLENBQW1CLFVBQVNtQixTQUFULEVBQW9CSyxDQUFwQixFQUFzQjtBQUN2Q0wsZ0JBQVVQLEtBQVYsR0FBa0JZLENBQWxCO0FBQ0FMLGdCQUFVSSxHQUFWLENBQWN2QixPQUFkLENBQXNCLFVBQVNDLElBQVQsRUFBZTtBQUNuQ0EsYUFBS2tCLFNBQUwsR0FBaUJLLENBQWpCO0FBQ0QsT0FGRDtBQUdELEtBTEQ7QUFNRCxHQTVERDs7QUE4REE7QUFDQTtBQUNBLFdBQVMxRCxtQkFBVCxHQUErQjtBQUM3QjJEO0FBQ0E7QUFDQTtBQUNBcEUsZUFBVzJDLE9BQVgsQ0FBbUIsVUFBU21CLFNBQVQsRUFBb0JLLENBQXBCLEVBQXNCO0FBQ3ZDRSxVQUFJUCxVQUFVRyxJQUFkLEVBQW9CLFVBQVNyQixJQUFULEVBQWM7QUFDaEMsWUFBSTBCLFNBQVMxQixLQUFLQyxXQUFMLENBQ1YwQixNQURVLENBQ0gsVUFBU1osVUFBVCxFQUFvQjtBQUMxQixpQkFBT0EsV0FBV3BDLE1BQVgsQ0FBa0J1QyxTQUFsQixJQUErQkssQ0FBdEM7QUFDRCxTQUhVLEVBSVZLLEdBSlUsQ0FJTixVQUFTYixVQUFULEVBQW9CO0FBQ3ZCLGlCQUFPQSxXQUFXcEMsTUFBbEI7QUFDRCxTQU5VLENBQWI7QUFPQSxlQUFPK0MsTUFBUDtBQUNELE9BVEQ7QUFVRCxLQVhEOztBQWFBLFFBQUlsQixNQUFNLENBQVY7O0FBRUEsUUFBSXFCLHNCQUFzQmhGLEdBQUdpRixJQUFILEdBQ3ZCQyxHQUR1QixDQUNuQixVQUFTMUQsQ0FBVCxFQUFZO0FBQ2Y7QUFDQTtBQUNBLGFBQU9BLEVBQUVnRCxJQUFGLENBQU9XLEdBQWQ7QUFDQTtBQUNELEtBTnVCLEVBT3ZCQyxRQVB1QixDQU9kcEYsR0FBR3FGLFNBUFcsRUFRdkJDLE9BUnVCLENBUWYvRSxVQVJlLEVBU3ZCd0UsR0FUdUIsQ0FTbkIsVUFBU3ZELENBQVQsRUFBWTtBQUFFLGFBQU9BLEVBQUUrRCxNQUFUO0FBQWtCLEtBVGIsQ0FBMUI7O0FBV0EsUUFBSTVCLE1BQU0sQ0FBQyxDQUFYO0FBQUEsUUFBYzZCLFVBQVUsQ0FBQyxDQUF6QjtBQUNBUix3QkFBb0I5QixPQUFwQixDQUE0QixVQUFTdUMsQ0FBVCxFQUFXO0FBQ3JDQSxRQUFFdkMsT0FBRixDQUFVLFVBQVNtQixTQUFULEVBQW1CO0FBQzNCQSxrQkFBVTFDLENBQVYsR0FBY2dDLE1BQU0sQ0FBcEI7QUFDQVUsa0JBQVVJLEdBQVYsQ0FBY3ZCLE9BQWQsQ0FBc0IsVUFBU0MsSUFBVCxFQUFjO0FBQ3hDLGNBQUlBLEtBQUt1QyxLQUFULEVBQWdCdkMsS0FBS3hCLENBQUwsR0FBT3dCLEtBQUt1QyxLQUFaLENBQWhCLEtBQ1d2QyxLQUFLeEIsQ0FBTCxHQUFTMEMsVUFBVTFDLENBQVYsR0FBY3dCLEtBQUt4QixDQUE1QjtBQUNMNkQsb0JBQVU5QixLQUFLQyxHQUFMLENBQVM2QixPQUFULEVBQWtCckMsS0FBS3hCLENBQXZCLENBQVY7QUFDRCxTQUpEO0FBS0QsT0FQRDtBQVFBZ0MsWUFBTTZCLE9BQU47QUFDRCxLQVZEOztBQWFBbkYsVUFDR3lFLE1BREgsQ0FDVSxVQUFTM0IsSUFBVCxFQUFlO0FBQ3JCLFVBQUl3QyxXQUFXeEMsS0FBS0MsV0FBTCxDQUFpQjBCLE1BQWpCLENBQXdCLFVBQVM3QixJQUFULEVBQWM7QUFBRSxlQUFPQSxLQUFLdkIsTUFBTCxDQUFZa0UsSUFBWixJQUFvQjNDLEtBQUtuQixNQUFMLENBQVk4RCxJQUF2QztBQUE4QyxPQUF0RixDQUFmO0FBQ0EsYUFBUUQsU0FBU2pGLE1BQVQsSUFBbUIsQ0FBM0I7QUFDRCxLQUpILEVBS0d3QyxPQUxILENBS1csVUFBU0MsSUFBVCxFQUFlO0FBQUVBLFdBQUt4QixDQUFMLEdBQVNnQyxHQUFUO0FBQWUsS0FMM0M7O0FBT0FrQyxzQkFBa0IsQ0FBQ3pGLEtBQUssQ0FBTCxJQUFVRixTQUFYLElBQXdCd0QsS0FBS0MsR0FBTCxDQUFTQSxHQUFULEVBQWMsQ0FBZCxDQUExQzs7QUFFQSxhQUFTbUMsT0FBVCxDQUFpQkMsQ0FBakIsRUFBb0I7QUFDbEIsYUFBTyxHQUFHQyxNQUFILENBQVVDLEtBQVYsQ0FBZ0IsRUFBaEIsRUFBb0JGLENBQXBCLENBQVA7QUFDRDs7QUFFRCxhQUFTcEIsZUFBVCxHQUEyQjtBQUN6QixVQUFJdUIsc0JBQXNCM0YsVUFBMUI7QUFBQSxVQUNJNEYsY0FESjtBQUFBLFVBRUlDLFlBRko7QUFBQSxVQUdJekUsSUFBSSxDQUhSOztBQUtBLGFBQU91RSxvQkFBb0J4RixNQUEzQixFQUFtQztBQUNqQ3lGLHlCQUFpQixFQUFqQjtBQUNBQyx1QkFBZSxFQUFmOztBQUVBRiw0QkFBb0JoRCxPQUFwQixDQUE0QixVQUFTbUIsU0FBVCxFQUFvQjtBQUM5Q0Esb0JBQVUxQyxDQUFWLEdBQWNBLENBQWQ7O0FBRUEwQyxvQkFBVUksR0FBVixDQUFjdkIsT0FBZCxDQUFzQixVQUFTbUQsQ0FBVCxFQUFZO0FBQ2hDQSxjQUFFakQsV0FBRixDQUFjRixPQUFkLENBQXNCLFVBQVNvRCxDQUFULEVBQVk7QUFDaEMsa0JBQUksQ0FBQ0YsYUFBYWpDLGNBQWIsQ0FBNEJtQyxFQUFFeEUsTUFBRixDQUFTdUMsU0FBckMsQ0FBRCxJQUNDaUMsRUFBRXhFLE1BQUYsQ0FBU3VDLFNBQVQsSUFBc0JBLFVBQVVQLEtBRHJDLEVBQzRDO0FBQzFDcUMsK0JBQWU1QyxJQUFmLENBQW9CaEQsV0FBVytGLEVBQUV4RSxNQUFGLENBQVN1QyxTQUFwQixDQUFwQjtBQUNBK0IsNkJBQWFFLEVBQUV4RSxNQUFGLENBQVN1QyxTQUF0QixJQUFtQyxJQUFuQztBQUNEO0FBQ0YsYUFORDtBQU9ELFdBUkQ7QUFTRCxTQVpEOztBQWNBNkIsOEJBQXNCQyxjQUF0QjtBQUNBLFVBQUV4RSxDQUFGO0FBQ0Q7QUFDRjs7QUFFRCxhQUFTaUQsR0FBVCxDQUFhekIsSUFBYixFQUFtQm9ELGNBQW5CLEVBQW1DO0FBQ2pDLFVBQUlDLFFBQVEsQ0FBQ3JELElBQUQsQ0FBWjtBQUFBLFVBQW9Cc0QsZUFBZSxDQUFuQztBQUFBLFVBQXNDQyxZQUFZLENBQWxEO0FBQ0EsVUFBSS9FLElBQUksQ0FBUjs7QUFFQSxhQUFNOEUsZUFBZSxDQUFyQixFQUF3QjtBQUN0QixZQUFJbkMsY0FBY2tDLE1BQU1HLEtBQU4sRUFBbEI7QUFDQUY7O0FBRUEsWUFBSSxDQUFDbkMsWUFBWUgsY0FBWixDQUEyQixHQUEzQixDQUFMLEVBQXNDO0FBQ3BDRyxzQkFBWTNDLENBQVosR0FBZ0JBLENBQWhCO0FBQ0EyQyxzQkFBWTFDLEVBQVosR0FBaUIxQixTQUFqQjs7QUFFQSxjQUFJMEcsVUFBVUwsZUFBZWpDLFdBQWYsQ0FBZDs7QUFFQWtDLGtCQUFRQSxNQUFNUixNQUFOLENBQWFZLE9BQWIsQ0FBUjtBQUNBRix1QkFBYUUsUUFBUWxHLE1BQXJCO0FBQ0Q7O0FBR0QsWUFBSStGLGdCQUFnQixDQUFwQixFQUF1QjtBQUFFO0FBQ3ZCOUU7QUFDQThFLHlCQUFlQyxTQUFmO0FBQ0FBLHNCQUFZLENBQVo7QUFDRDtBQUVGO0FBQ0Y7QUFDRjs7QUFFRCxXQUFTRyxnQkFBVCxHQUE0QjtBQUMxQnhHLFVBQU02QyxPQUFOLENBQWMsVUFBU0MsSUFBVCxFQUFlO0FBQzNCLFVBQUksQ0FBQ0EsS0FBS0UsV0FBTCxDQUFpQjNDLE1BQXRCLEVBQThCO0FBQzVCeUMsYUFBS3hCLENBQUwsR0FBUzNCLEdBQUdvRSxHQUFILENBQU9qQixLQUFLQyxXQUFaLEVBQXlCLFVBQVM1QixDQUFULEVBQVk7QUFBRSxpQkFBT0EsRUFBRU0sTUFBRixDQUFTSCxDQUFoQjtBQUFvQixTQUEzRCxJQUErRCxDQUF4RTtBQUNEO0FBQ0YsS0FKRDtBQUtEOztBQUVELFdBQVNtRixjQUFULENBQXdCbkYsQ0FBeEIsRUFBMkI7QUFDekJ0QixVQUFNNkMsT0FBTixDQUFjLFVBQVNDLElBQVQsRUFBZTtBQUMzQixVQUFJLENBQUNBLEtBQUtDLFdBQUwsQ0FBaUIxQyxNQUF0QixFQUE4QjtBQUM1QnlDLGFBQUt4QixDQUFMLEdBQVNBLElBQUksQ0FBYjtBQUNEO0FBQ0YsS0FKRDtBQUtEOztBQUVELFdBQVNrRSxpQkFBVCxDQUEyQmtCLEVBQTNCLEVBQStCO0FBQzdCMUcsVUFBTTZDLE9BQU4sQ0FBYyxVQUFTQyxJQUFULEVBQWU7QUFDM0JBLFdBQUt4QixDQUFMLElBQVVvRixFQUFWO0FBQ0QsS0FGRDtBQUdEOztBQUVELFdBQVM5RixpQkFBVCxDQUEyQkwsVUFBM0IsRUFBdUM7QUFDckMsUUFBSW9HLGlCQUFpQmhILEdBQUdpRixJQUFILEdBQ2hCQyxHQURnQixDQUNaLFVBQVMxRCxDQUFULEVBQVk7QUFDZixhQUFPQSxFQUFFRyxDQUFUO0FBQ0QsS0FIZ0IsRUFJaEJ5RCxRQUpnQixDQUlQcEYsR0FBR3FGLFNBSkksRUFLaEJDLE9BTGdCLENBS1JqRixLQUxRLEVBTWhCMEUsR0FOZ0IsQ0FNWixVQUFTdkQsQ0FBVCxFQUFZO0FBQUUsYUFBT0EsRUFBRStELE1BQVQ7QUFBa0IsS0FOcEIsQ0FBckI7O0FBUUEwQjtBQUNBQzs7QUFFQSxTQUFLLElBQUlDLFFBQVEsQ0FBakIsRUFBb0J2RyxhQUFhLENBQWpDLEVBQW9DLEVBQUVBLFVBQXRDLEVBQWtEO0FBQ2hEd0csdUJBQWlCRCxLQUFqQjtBQUNBRDtBQUNBRyx1QkFBaUJGLEtBQWpCO0FBQ0FEO0FBQ0Q7O0FBRUQsYUFBU0QsbUJBQVQsR0FBK0I7QUFDN0IsVUFBSUssS0FBS3RILEdBQUdvRSxHQUFILENBQU80QyxjQUFQLEVBQXVCLFVBQVMzRyxLQUFULEVBQWdCO0FBQzlDLGVBQU8sQ0FBQ0QsS0FBSyxDQUFMLElBQVUsQ0FBQ0MsTUFBTUssTUFBTixHQUFlLENBQWhCLElBQXFCUCxXQUFoQyxJQUErQ0gsR0FBRzRELEdBQUgsQ0FBT3ZELEtBQVAsRUFBY29ELEtBQWQsQ0FBdEQ7QUFDRCxPQUZRLENBQVQ7O0FBSUF1RCxxQkFBZTlELE9BQWYsQ0FBdUIsVUFBUzdDLEtBQVQsRUFBZ0I7QUFDckNBLGNBQU02QyxPQUFOLENBQWMsVUFBU0MsSUFBVCxFQUFldUIsQ0FBZixFQUFrQjtBQUM5QnZCLGVBQUtmLENBQUwsR0FBU3NDLENBQVQ7QUFDQXZCLGVBQUtWLEVBQUwsR0FBVVUsS0FBS00sS0FBTCxHQUFhNkQsRUFBdkI7QUFDRCxTQUhEO0FBSUQsT0FMRDs7QUFPQWhILFlBQU00QyxPQUFOLENBQWMsVUFBU0QsSUFBVCxFQUFlO0FBQzNCQSxhQUFLUixFQUFMLEdBQVVRLEtBQUtRLEtBQUwsR0FBYTZELEVBQXZCO0FBQ0QsT0FGRDtBQUdEOztBQUVELGFBQVNGLGdCQUFULENBQTBCRCxLQUExQixFQUFpQzs7QUFFL0JILHFCQUFlOUQsT0FBZixDQUF1QixVQUFTN0MsS0FBVCxFQUFnQmtILE9BQWhCLEVBQXlCO0FBQzlDbEgsY0FBTTZDLE9BQU4sQ0FBYyxVQUFTQyxJQUFULEVBQWU7QUFDM0IsY0FBSUEsS0FBS0UsV0FBTCxDQUFpQjNDLE1BQXJCLEVBQTZCO0FBQzNCLGdCQUFJMEIsSUFBSXBDLEdBQUc0RCxHQUFILENBQU9ULEtBQUtFLFdBQVosRUFBeUJtRSxjQUF6QixJQUEyQ3hILEdBQUc0RCxHQUFILENBQU9ULEtBQUtFLFdBQVosRUFBeUJJLEtBQXpCLENBQW5EO0FBQ0FOLGlCQUFLZixDQUFMLElBQVUsQ0FBQ0EsSUFBSXFGLE9BQU90RSxJQUFQLENBQUwsSUFBcUJnRSxLQUEvQjtBQUNEO0FBQ0YsU0FMRDtBQU1ELE9BUEQ7O0FBU0EsZUFBU0ssY0FBVCxDQUF3QnZFLElBQXhCLEVBQThCO0FBQzVCLGVBQU93RSxPQUFPeEUsS0FBS3ZCLE1BQVosSUFBc0J1QixLQUFLUSxLQUFsQztBQUNEO0FBQ0Y7O0FBRUQsYUFBUzRELGdCQUFULENBQTBCRixLQUExQixFQUFpQztBQUMvQkgscUJBQWVVLEtBQWYsR0FBdUJDLE9BQXZCLEdBQWlDekUsT0FBakMsQ0FBeUMsVUFBUzdDLEtBQVQsRUFBZ0I7QUFDdkRBLGNBQU02QyxPQUFOLENBQWMsVUFBU0MsSUFBVCxFQUFlO0FBQzNCLGNBQUlBLEtBQUtDLFdBQUwsQ0FBaUIxQyxNQUFyQixFQUE2QjtBQUMzQixnQkFBSTBCLElBQUlwQyxHQUFHNEQsR0FBSCxDQUFPVCxLQUFLQyxXQUFaLEVBQXlCd0UsY0FBekIsSUFBMkM1SCxHQUFHNEQsR0FBSCxDQUFPVCxLQUFLQyxXQUFaLEVBQXlCSyxLQUF6QixDQUFuRDtBQUNBTixpQkFBS2YsQ0FBTCxJQUFVLENBQUNBLElBQUlxRixPQUFPdEUsSUFBUCxDQUFMLElBQXFCZ0UsS0FBL0I7QUFDRDtBQUNGLFNBTEQ7QUFNRCxPQVBEOztBQVNBLGVBQVNTLGNBQVQsQ0FBd0IzRSxJQUF4QixFQUE4QjtBQUM1QixlQUFPd0UsT0FBT3hFLEtBQUtuQixNQUFaLElBQXNCbUIsS0FBS1EsS0FBbEM7QUFDRDtBQUNGOztBQUVELGFBQVN5RCxpQkFBVCxHQUE2QjtBQUMzQkYscUJBQWU5RCxPQUFmLENBQXVCLFVBQVM3QyxLQUFULEVBQWdCO0FBQ3JDLFlBQUk4QyxJQUFKO0FBQUEsWUFDSVYsRUFESjtBQUFBLFlBRUlOLEtBQUssQ0FGVDtBQUFBLFlBR0lrRSxJQUFJaEcsTUFBTUssTUFIZDtBQUFBLFlBSUlnRSxDQUpKOztBQU1BO0FBQ0E7QUFDQXJFLGNBQU13SCxJQUFOLENBQVdDLE9BQVg7QUFDQTtBQUNBLGFBQUtwRCxJQUFJLENBQVQsRUFBWUEsSUFBSTJCLENBQWhCLEVBQW1CLEVBQUUzQixDQUFyQixFQUF3QjtBQUN0QnZCLGlCQUFPOUMsTUFBTXFFLENBQU4sQ0FBUDtBQUNBakMsZUFBS04sS0FBS2dCLEtBQUtmLENBQWY7QUFDQSxjQUFJSyxLQUFLLENBQVQsRUFBWVUsS0FBS2YsQ0FBTCxJQUFVSyxFQUFWO0FBQ1pOLGVBQUtnQixLQUFLZixDQUFMLEdBQVNlLEtBQUtWLEVBQWQsR0FBbUJ0QyxXQUF4QjtBQUNEOztBQUVEO0FBQ0FzQyxhQUFLTixLQUFLaEMsV0FBTCxHQUFtQkMsS0FBSyxDQUFMLENBQXhCO0FBQ0EsWUFBSXFDLEtBQUssQ0FBVCxFQUFZO0FBQ1ZOLGVBQUtnQixLQUFLZixDQUFMLElBQVVLLEVBQWY7O0FBRUE7QUFDQSxlQUFLaUMsSUFBSTJCLElBQUksQ0FBYixFQUFnQjNCLEtBQUssQ0FBckIsRUFBd0IsRUFBRUEsQ0FBMUIsRUFBNkI7QUFDM0J2QixtQkFBTzlDLE1BQU1xRSxDQUFOLENBQVA7QUFDQWpDLGlCQUFLVSxLQUFLZixDQUFMLEdBQVNlLEtBQUtWLEVBQWQsR0FBbUJ0QyxXQUFuQixHQUFpQ2dDLEVBQXRDO0FBQ0EsZ0JBQUlNLEtBQUssQ0FBVCxFQUFZVSxLQUFLZixDQUFMLElBQVVLLEVBQVY7QUFDWk4saUJBQUtnQixLQUFLZixDQUFWO0FBQ0Q7QUFDRjtBQUNGLE9BL0JEO0FBZ0NEO0FBQ0QsYUFBUzJGLGNBQVQsQ0FBd0JoQyxDQUF4QixFQUEyQmlDLENBQTNCLEVBQThCO0FBQzVCLGFBQU9BLEVBQUU1RixDQUFGLEdBQU0yRCxFQUFFM0QsQ0FBZjtBQUNBO0FBQ0Q7QUFDRjs7QUFFRDtBQUNBO0FBQ0EsV0FBUzBGLE9BQVQsQ0FBaUJHLEtBQWpCLEVBQXdCQyxNQUF4QixFQUFnQztBQUM5QixRQUFJQyxhQUFhRixNQUFNeEUsS0FBdkI7QUFBQSxRQUNJMkUsY0FBY0YsT0FBT3pFLEtBRHpCOztBQUdBLFFBQUkwRSxhQUFhQyxXQUFqQixFQUE4QjtBQUM1QixhQUFPLENBQVA7QUFDRCxLQUZELE1BRU8sSUFBSUQsYUFBYUMsV0FBakIsRUFBOEI7QUFDbkMsYUFBTyxDQUFDLENBQVI7QUFDRDs7QUFFRCxXQUFPLENBQVA7QUFDRDs7QUFFRCxXQUFTbEgsaUJBQVQsR0FBNkI7QUFDM0JiLFVBQU02QyxPQUFOLENBQWMsVUFBU0MsSUFBVCxFQUFlO0FBQzNCO0FBQ0FBLFdBQUtDLFdBQUwsQ0FBaUJ5RSxJQUFqQixDQUFzQkMsT0FBdEI7QUFDQTtBQUNBO0FBQ0EzRSxXQUFLRSxXQUFMLENBQWlCd0UsSUFBakIsQ0FBc0JDLE9BQXRCO0FBQ0E7QUFDRCxLQVBEO0FBUUF6SCxVQUFNNkMsT0FBTixDQUFjLFVBQVNDLElBQVQsRUFBZTtBQUMzQixVQUFJZCxLQUFLLENBQVQ7QUFBQSxVQUFZRSxLQUFLLENBQWpCO0FBQ0FZLFdBQUtDLFdBQUwsQ0FBaUJGLE9BQWpCLENBQXlCLFVBQVNELElBQVQsRUFBZTtBQUN0Q0EsYUFBS1osRUFBTCxHQUFVQSxFQUFWO0FBQ0FBLGNBQU1ZLEtBQUtSLEVBQVg7QUFDRCxPQUhEO0FBSUFVLFdBQUtFLFdBQUwsQ0FBaUJILE9BQWpCLENBQXlCLFVBQVNELElBQVQsRUFBZTtBQUN0Q0EsYUFBS1YsRUFBTCxHQUFVQSxFQUFWO0FBQ0FBLGNBQU1VLEtBQUtSLEVBQVg7QUFDRCxPQUhEO0FBSUQsS0FWRDs7QUFZQSxhQUFTNEYsb0JBQVQsQ0FBOEJ0QyxDQUE5QixFQUFpQ2lDLENBQWpDLEVBQW9DO0FBQ2xDLGFBQU9BLEVBQUV0RyxNQUFGLENBQVNVLENBQVQsR0FBYTJELEVBQUVyRSxNQUFGLENBQVNVLENBQTdCO0FBQ0E7QUFDRDs7QUFFRCxhQUFTa0csb0JBQVQsQ0FBOEJ2QyxDQUE5QixFQUFpQ2lDLENBQWpDLEVBQW9DO0FBQ2xDLGFBQU9BLEVBQUVsRyxNQUFGLENBQVNNLENBQVQsR0FBYTJELEVBQUVqRSxNQUFGLENBQVNNLENBQTdCO0FBQ0E7QUFDRDtBQUNGOztBQUVELFdBQVNxRixNQUFULENBQWdCdEUsSUFBaEIsRUFBc0I7QUFDcEIsV0FBT0EsS0FBS2YsQ0FBTCxHQUFTZSxLQUFLVixFQUFMLEdBQVUsQ0FBMUI7QUFDRDs7QUFFRCxXQUFTZ0IsS0FBVCxDQUFlUixJQUFmLEVBQXFCO0FBQ25CLFdBQU9BLEtBQUtRLEtBQVo7QUFDRDs7QUFFRCxTQUFPeEQsTUFBUDtBQUNELENBeG1CRCIsImZpbGUiOiJkMy1zYW5rZXlOZXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJkMy5zYW5rZXkgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNhbmtleSA9IHt9LFxuICAgICAgbm9kZVdpZHRoID0gMjQsXG4gICAgICBub2RlUGFkZGluZyA9IDMwLFxuICAgICAgc2l6ZSA9IFsxLCAxXSxcbiAgICAgIG5vZGVzID0gW10sXG4gICAgICBsaW5rcyA9IFtdLFxuICAgICAgY29tcG9uZW50cyA9IFtdO1xuXG4gIHNhbmtleS5ub2RlV2lkdGggPSBmdW5jdGlvbihfKSB7XG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbm9kZVdpZHRoO1xuICAgIG5vZGVXaWR0aCA9ICtfO1xuICAgIHJldHVybiBzYW5rZXk7XG4gIH07XG5cbiAgc2Fua2V5Lm5vZGVQYWRkaW5nID0gZnVuY3Rpb24oXykge1xuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG5vZGVQYWRkaW5nO1xuICAgIG5vZGVQYWRkaW5nID0gK187XG4gICAgcmV0dXJuIHNhbmtleTtcbiAgfTtcblxuICBzYW5rZXkubm9kZXMgPSBmdW5jdGlvbihfKSB7XG4gICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbm9kZXM7XG4gICAgbm9kZXMgPSBfO1xuICAgIHJldHVybiBzYW5rZXk7XG4gIH07XG5cbiAgc2Fua2V5LmxpbmtzID0gZnVuY3Rpb24oXykge1xuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxpbmtzO1xuICAgIGxpbmtzID0gXztcbiAgICByZXR1cm4gc2Fua2V5O1xuICB9O1xuXG4gIHNhbmtleS5zaXplID0gZnVuY3Rpb24oXykge1xuICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7XG4gICAgc2l6ZSA9IF87XG4gICAgcmV0dXJuIHNhbmtleTtcbiAgfTtcblxuICBzYW5rZXkubGF5b3V0ID0gZnVuY3Rpb24oaXRlcmF0aW9ucykge1xuICAgIGNvbXB1dGVOb2RlTGlua3MoKTtcbiAgICBjb21wdXRlTm9kZVZhbHVlcygpO1xuXG4gICAgY29tcHV0ZU5vZGVTdHJ1Y3R1cmUoKTtcbiAgICBjb21wdXRlTm9kZUJyZWFkdGhzKCk7XG5cbiAgICBjb21wdXRlTm9kZURlcHRocyhpdGVyYXRpb25zKTtcbiAgICBjb21wdXRlTGlua0RlcHRocygpO1xuXG4gICAgcmV0dXJuIHNhbmtleTtcbiAgfTtcblxuICBzYW5rZXkucmVsYXlvdXQgPSBmdW5jdGlvbigpIHtcbiAgICBjb21wdXRlTGlua0RlcHRocygpO1xuICAgIHJldHVybiBzYW5rZXk7XG4gIH07XG5cbiAgLy8gQSBtb3JlIGludm9sdmVkIHBhdGggZ2VuZXJhdG9yIHRoYXQgcmVxdWlyZXMgMyBlbGVtZW50cyB0byByZW5kZXIgLS1cbiAgLy8gSXQgZHJhd3MgYSBzdGFydGluZyBlbGVtZW50LCBpbnRlcm1lZGlhdGUgYW5kIGVuZCBlbGVtZW50IHRoYXQgYXJlIHVzZWZ1bFxuICAvLyB3aGlsZSBkcmF3aW5nIHJldmVyc2UgbGlua3MgdG8gZ2V0IGFuIGFwcHJvcHJpYXRlIGZpbGwuXG4gIC8vXG4gIC8vIEVhY2ggbGluayBpcyBub3cgYW4gYXJlYSBhbmQgbm90IGEgYmFzaWMgc3BsaW5lIGFuZCBubyBsb25nZXIgZ3VhcmFudGVlc1xuICAvLyBmaXhlZCB3aWR0aCB0aHJvdWdob3V0LlxuICAvL1xuICAvLyBTYW1wbGUgdXNhZ2U6XG4gIC8vXG4gIC8vICBsaW5rTm9kZXMgPSB0aGlzLl9zdmcuYXBwZW5kKFwiZ1wiKS5zZWxlY3RBbGwoXCIubGlua1wiKVxuICAvLyAgICAgIC5kYXRhKHRoaXMubGlua3MpXG4gIC8vICAgIC5lbnRlcigpLmFwcGVuZChcImdcIilcbiAgLy8gICAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gIC8vICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcIi5saW5rXCIpXG4gIC8vICAgICAgLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYi5keSAtIGEuZHk7IH0pO1xuICAvL1xuICAvLyAgbGlua05vZGVQaWVjZXMgPSBbXTtcbiAgLy8gIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gIC8vICAgIGxpbmtOb2RlUGllY2VzW2ldID0gbGlua05vZGVzLmFwcGVuZChcInBhdGhcIilcbiAgLy8gICAgICAuYXR0cihcImNsYXNzXCIsIFwiLmxpbmtQaWVjZVwiKVxuICAvLyAgICAgIC5hdHRyKFwiZFwiLCBwYXRoKGkpKVxuICAvLyAgICAgIC5hdHRyKFwiZmlsbFwiLCAuLi4pXG4gIC8vICB9XG4gIHNhbmtleS5yZXZlcnNpYmxlTGluayA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjdXJ2YXR1cmUgPSAwLjU7XG5cbiAgICAvLyBVc2VkIHdoZW4gc291cmNlIGlzIGJlaGluZCB0YXJnZXQsIHRoZSBmaXJzdCBhbmQgbGFzdCBwYXRocyBhcmUgc2ltcGxlXG4gICAgLy8gbGluZXMgYXQgdGhlIHN0YXJ0IGFuZCBlbmQgbm9kZSB3aGlsZSB0aGUgc2Vjb25kIHBhdGggaXMgdGhlIHNwbGluZVxuICAgIGZ1bmN0aW9uIGZvcndhcmRMaW5rKHBhcnQsIGQpIHtcbiAgICAgIHZhciB4MCA9IGQuc291cmNlLnggKyBkLnNvdXJjZS5keCxcbiAgICAgICAgICB4MSA9IGQudGFyZ2V0LngsXG4gICAgICAgICAgeGkgPSBkMy5pbnRlcnBvbGF0ZU51bWJlcih4MCwgeDEpLFxuICAgICAgICAgIHgyID0geGkoY3VydmF0dXJlKSxcbiAgICAgICAgICB4MyA9IHhpKDEgLSBjdXJ2YXR1cmUpLFxuICAgICAgICAgIHkwID0gZC5zb3VyY2UueSArIGQuc3ksXG4gICAgICAgICAgeTEgPSBkLnRhcmdldC55ICsgZC50eSxcbiAgICAgICAgICB5MiA9IGQuc291cmNlLnkgKyBkLnN5ICsgZC5keSxcbiAgICAgICAgICB5MyA9IGQudGFyZ2V0LnkgKyBkLnR5ICsgZC5keTtcblxuICAgICAgc3dpdGNoIChwYXJ0KSB7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICByZXR1cm4gXCJNXCIgKyB4MCArIFwiLFwiICsgeTAgKyBcIkxcIiArIHgwICsgXCIsXCIgKyAoeTAgKyBkLmR5KTtcblxuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgcmV0dXJuIFwiTVwiICsgeDAgKyBcIixcIiArIHkwXG4gICAgICAgICAgICAgICArIFwiQ1wiICsgeDIgKyBcIixcIiArIHkwICsgXCIgXCIgKyB4MyArIFwiLFwiICsgeTEgKyBcIiBcIiArIHgxICsgXCIsXCIgKyB5MVxuICAgICAgICAgICAgICAgKyBcIkxcIiArIHgxICsgXCIsXCIgKyB5M1xuICAgICAgICAgICAgICAgKyBcIkNcIiArIHgzICsgXCIsXCIgKyB5MyArIFwiIFwiICsgeDIgKyBcIixcIiArIHkyICsgXCIgXCIgKyB4MCArIFwiLFwiICsgeTJcbiAgICAgICAgICAgICAgICsgXCJaXCI7XG5cbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIHJldHVybiBcIk1cIiArIHgxICsgXCIsXCIgKyB5MSArIFwiTFwiICsgeDEgKyBcIixcIiArICh5MSArIGQuZHkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFVzZWQgZm9yIHNlbGYgbG9vcHMgYW5kIHdoZW4gdGhlIHNvdXJjZSBpcyBhY3R1YWxseSBpbiBmcm9udCBvZiB0aGVcbiAgICAvLyB0YXJnZXQ7IHRoZSBmaXJzdCBlbGVtZW50IGlzIGEgdHVybmluZyBwYXRoIGZyb20gdGhlIHNvdXJjZSB0byB0aGVcbiAgICAvLyBkZXN0aW5hdGlvbiwgdGhlIHNlY29uZCBlbGVtZW50IGNvbm5lY3RzIHRoZSB0d28gdHdpc3RzIGFuZCB0aGUgbGFzdFxuICAgIC8vIHR3aXN0cyBpbnRvIHRoZSB0YXJnZXQgZWxlbWVudC5cbiAgICAvL1xuICAgIC8vXG4gICAgLy8gIC8tLVRhcmdldFxuICAgIC8vICBcXC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cXFxuICAgIC8vICAgICAgICAgICAgICAgICBTb3VyY2UtLS9cbiAgICAvL1xuICAgIGZ1bmN0aW9uIGJhY2t3YXJkTGluayhwYXJ0LCBkKSB7XG4gICAgICB2YXIgY3VydmVFeHRlbnNpb24gPSAzMDtcbiAgICAgIHZhciBjdXJ2ZURlcHRoID0gMTU7XG5cbiAgICAgIGZ1bmN0aW9uIGdldERpcihkKSB7XG4gICAgICAgIHJldHVybiBkLnNvdXJjZS55ICsgZC5zeSA+IGQudGFyZ2V0LnkgKyBkLnR5ID8gLTEgOiAxO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBwKHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHggKyBcIixcIiArIHkgKyBcIiBcIjtcbiAgICAgIH1cblxuICAgICAgdmFyIGR0ID0gZ2V0RGlyKGQpICogY3VydmVEZXB0aCxcbiAgICAgICAgICB4MCA9IGQuc291cmNlLnggKyBkLnNvdXJjZS5keCxcbiAgICAgICAgICB5MCA9IGQuc291cmNlLnkgKyBkLnN5LFxuICAgICAgICAgIHgxID0gZC50YXJnZXQueCxcbiAgICAgICAgICB5MSA9IGQudGFyZ2V0LnkgKyBkLnR5O1xuXG4gICAgICBzd2l0Y2ggKHBhcnQpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIHJldHVybiBcIk1cIiArIHAoeDAsIHkwKSArXG4gICAgICAgICAgICAgICAgIFwiQ1wiICsgcCh4MCwgeTApICtcbiAgICAgICAgICAgICAgICAgICAgICAgcCh4MCArIGN1cnZlRXh0ZW5zaW9uLCB5MCkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgwICsgY3VydmVFeHRlbnNpb24sIHkwICsgZHQpICtcbiAgICAgICAgICAgICAgICAgXCJMXCIgKyBwKHgwICsgY3VydmVFeHRlbnNpb24sIHkwICsgZHQgKyBkLmR5KSArXG4gICAgICAgICAgICAgICAgIFwiQ1wiICsgcCh4MCArIGN1cnZlRXh0ZW5zaW9uLCB5MCArIGQuZHkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgcCh4MCwgeTAgKyBkLmR5KSArXG4gICAgICAgICAgICAgICAgICAgICAgIHAoeDAsIHkwICsgZC5keSkgK1xuICAgICAgICAgICAgICAgICBcIlpcIjtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIHJldHVybiBcIk1cIiArIHAoeDAgKyBjdXJ2ZUV4dGVuc2lvbiwgeTAgKyBkdCkgK1xuICAgICAgICAgICAgICAgICBcIkNcIiArIHAoeDAgKyBjdXJ2ZUV4dGVuc2lvbiwgeTAgKyAzICogZHQpICtcbiAgICAgICAgICAgICAgICAgICAgICAgcCh4MSAtIGN1cnZlRXh0ZW5zaW9uLCB5MSAtIDMgKiBkdCkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgxIC0gY3VydmVFeHRlbnNpb24sIHkxIC0gZHQpICtcbiAgICAgICAgICAgICAgICAgXCJMXCIgKyBwKHgxIC0gY3VydmVFeHRlbnNpb24sIHkxIC0gZHQgKyBkLmR5KSArXG4gICAgICAgICAgICAgICAgIFwiQ1wiICsgcCh4MSAtIGN1cnZlRXh0ZW5zaW9uLCB5MSAtIDMgKiBkdCArIGQuZHkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgcCh4MCArIGN1cnZlRXh0ZW5zaW9uLCB5MCArIDMgKiBkdCArIGQuZHkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgcCh4MCArIGN1cnZlRXh0ZW5zaW9uLCB5MCArIGR0ICsgZC5keSkgK1xuICAgICAgICAgICAgICAgICBcIlpcIjtcblxuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgcmV0dXJuIFwiTVwiICsgcCh4MSAtIGN1cnZlRXh0ZW5zaW9uLCB5MSAtIGR0KSArXG4gICAgICAgICAgICAgICAgIFwiQ1wiICsgcCh4MSAtIGN1cnZlRXh0ZW5zaW9uLCB5MSkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgxLCB5MSkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgxLCB5MSkgK1xuICAgICAgICAgICAgICAgICBcIkxcIiArIHAoeDEsIHkxICsgZC5keSkgK1xuICAgICAgICAgICAgICAgICBcIkNcIiArIHAoeDEsIHkxICsgZC5keSkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgxIC0gY3VydmVFeHRlbnNpb24sIHkxICsgZC5keSkgK1xuICAgICAgICAgICAgICAgICAgICAgICBwKHgxIC0gY3VydmVFeHRlbnNpb24sIHkxICsgZC5keSAtIGR0KSArXG4gICAgICAgICAgICAgICAgIFwiWlwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbihwYXJ0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZCkge1xuICAgICAgICBpZiAoZC5zb3VyY2UueCA8IGQudGFyZ2V0LngpIHtcbiAgICAgICAgICByZXR1cm4gZm9yd2FyZExpbmsocGFydCwgZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGJhY2t3YXJkTGluayhwYXJ0LCBkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBUaGUgc3RhbmRhcmQgbGluayBwYXRoIHVzaW5nIGEgY29uc3RhbnQgd2lkdGggc3BsaW5lIHRoYXQgbmVlZHMgYVxuICAvLyBzaW5nbGUgcGF0aCBlbGVtZW50LlxuICBzYW5rZXkubGluayA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjdXJ2YXR1cmUgPSAuNTtcblxuICAgIGZ1bmN0aW9uIGxpbmsoZCkge1xuICAgICAgdmFyIHgwID0gZC5zb3VyY2UueCArIGQuc291cmNlLmR4LFxuICAgICAgICAgIHgxID0gZC50YXJnZXQueCxcbiAgICAgICAgICB4aSA9IGQzLmludGVycG9sYXRlTnVtYmVyKHgwLCB4MSksXG4gICAgICAgICAgeDIgPSB4aShjdXJ2YXR1cmUpLFxuICAgICAgICAgIHgzID0geGkoMSAtIGN1cnZhdHVyZSksXG4gICAgICAgICAgeTAgPSBkLnNvdXJjZS55ICsgZC5zeSArIGQuZHkgLyAyLFxuICAgICAgICAgIHkxID0gZC50YXJnZXQueSArIGQudHkgKyBkLmR5IC8gMjtcbiAgICAgIHJldHVybiBcIk1cIiArIHgwICsgXCIsXCIgKyB5MFxuICAgICAgICAgICArIFwiQ1wiICsgeDIgKyBcIixcIiArIHkwXG4gICAgICAgICAgICsgXCIgXCIgKyB4MyArIFwiLFwiICsgeTFcbiAgICAgICAgICAgKyBcIiBcIiArIHgxICsgXCIsXCIgKyB5MTtcbiAgICB9XG5cbiAgICBsaW5rLmN1cnZhdHVyZSA9IGZ1bmN0aW9uKF8pIHtcbiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGN1cnZhdHVyZTtcbiAgICAgIGN1cnZhdHVyZSA9ICtfO1xuICAgICAgcmV0dXJuIGxpbms7XG4gICAgfTtcblxuICAgIHJldHVybiBsaW5rO1xuICB9O1xuXG4gIC8vIFBvcHVsYXRlIHRoZSBzb3VyY2VMaW5rcyBhbmQgdGFyZ2V0TGlua3MgZm9yIGVhY2ggbm9kZS5cbiAgLy8gQWxzbywgaWYgdGhlIHNvdXJjZSBhbmQgdGFyZ2V0IGFyZSBub3Qgb2JqZWN0cywgYXNzdW1lIHRoZXkgYXJlIGluZGljZXMuXG4gIGNvbnN0IGNvbXB1dGVOb2RlTGlua3MgPSAoKSA9PiB7XG4gICAgbGV0IHNvdXJjZSwgdGFyZ2V0O1xuXG4gICAgbm9kZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgbm9kZS5zb3VyY2VMaW5rcyA9IFtdO1xuICAgICAgbm9kZS50YXJnZXRMaW5rcyA9IFtdO1xuICAgIH0pO1xuICAgIGxpbmtzLmZvckVhY2goKGxpbmspID0+IHtcbiAgICAgIHNvdXJjZSA9IGxpbmsuc291cmNlID0gbm9kZXNbcGFyc2VJbnQobGluay5zb3VyY2UpXTtcbiAgICAgIHRhcmdldCA9IGxpbmsudGFyZ2V0ID0gbm9kZXNbcGFyc2VJbnQobGluay50YXJnZXQpXTtcbiAgICAgIHNvdXJjZS5zb3VyY2VMaW5rcy5wdXNoKGxpbmspO1xuICAgICAgdGFyZ2V0LnRhcmdldExpbmtzLnB1c2gobGluayk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBDb21wdXRlIHRoZSB2YWx1ZSAoc2l6ZSkgb2YgZWFjaCBub2RlIGJ5IHN1bW1pbmcgdGhlIGFzc29jaWF0ZWQgbGlua3MuXG4gIGNvbnN0IGNvbXB1dGVOb2RlVmFsdWVzID0gKCkgPT4ge1xuICAgIGxldCBmbHVpZDtcblxuICAgIG5vZGVzLmZvckVhY2goKG5vZGUpID0+IHtcbiAgICAgIGlmICghbm9kZS52YWx1ZSkge1xuICAgICAgICBmbHVpZCA9IE1hdGgubWF4KFxuICAgICAgICAgIGQzLnN1bShub2RlLnNvdXJjZUxpbmtzLCB2YWx1ZSksXG4gICAgICAgICAgZDMuc3VtKG5vZGUudGFyZ2V0TGlua3MsIHZhbHVlKVxuICAgICAgICApO1xuXG4gICAgICAgIG5vZGUudmFsdWUgPSBmbHVpZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRha2UgdGhlIGxpc3Qgb2Ygbm9kZXMgYW5kIGNyZWF0ZSBhIERBRyBvZiBzdXBlcnZlcnRpY2VzLCBlYWNoIGNvbnNpc3RpbmdcbiAgLy8gb2YgYSBzdHJvbmdseSBjb25uZWN0ZWQgY29tcG9uZW50IG9mIHRoZSBncmFwaFxuICAvL1xuICAvLyBCYXNlZCBvZmY6XG4gIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVGFyamFuJ3Nfc3Ryb25nbHlfY29ubmVjdGVkX2NvbXBvbmVudHNfYWxnb3JpdGhtXG4gIGNvbnN0IGNvbXB1dGVOb2RlU3RydWN0dXJlID0gKCkgPT4ge1xuICAgIGxldCBub2RlU3RhY2sgPSBbXSxcbiAgICAgICAgaW5kZXggPSAwO1xuXG4gICAgbGV0IGNvbm5lY3QgPSAobm9kZSkgPT4ge1xuXG5cbiAgICAgIG5vZGUubG93SW5kZXggPSBub2RlLmluZGV4ID0gaW5kZXgrKztcbiAgICAgIG5vZGUub25TdGFjayA9IHRydWU7XG4gICAgICBub2RlU3RhY2sucHVzaChub2RlKTtcblxuICAgICAgbGV0IHRhcmdldDtcblxuICAgICAgaWYgKG5vZGUuc291cmNlTGlua3MpIHtcbiAgICAgICAgbm9kZS5zb3VyY2VMaW5rcy5mb3JFYWNoKChzb3VyY2VMaW5rKSA9PiB7XG4gICAgICAgICAgdGFyZ2V0ID0gc291cmNlTGluay50YXJnZXQ7XG5cbiAgICAgICAgICBpZiAoIXRhcmdldC5oYXNPd25Qcm9wZXJ0eSgnaW5kZXgnKSkge1xuICAgICAgICAgICAgY29ubmVjdCh0YXJnZXQpO1xuICAgICAgICAgICAgbm9kZS5sb3dJbmRleCA9IE1hdGgubWluKG5vZGUubG93SW5kZXgsIHRhcmdldC5sb3dJbmRleCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQub25TdGFjaykge1xuICAgICAgICAgICAgbm9kZS5sb3dJbmRleCA9IE1hdGgubWluKG5vZGUubG93SW5kZXgsIHRhcmdldC5pbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBjb25zb2xlLmxvZygnY29ubmVjdCcpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhjb21wb25lbnRzLmxlbmd0aCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKG5vZGUpO1xuXG4gICAgICAgIGlmIChub2RlLmxvd0luZGV4ID09PSBub2RlLmluZGV4KSB7XG4gICAgICAgICAgdmFyIGNvbXBvbmVudCA9IFtdLCBjdXJyZW50Tm9kZTtcblxuICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIGN1cnJlbnROb2RlID0gbm9kZVN0YWNrLnBvcCgpXG4gICAgICAgICAgICBjdXJyZW50Tm9kZS5vblN0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICBjb21wb25lbnQucHVzaChjdXJyZW50Tm9kZSk7XG4gICAgICAgICAgfSB3aGlsZSAoY3VycmVudE5vZGUgIT0gbm9kZSk7XG5cbiAgICAgICAgICBjb21wb25lbnRzLnB1c2goe1xuICAgICAgICAgICAgcm9vdDogbm9kZSxcbiAgICAgICAgICAgIHNjYzogY29tcG9uZW50XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIG5vZGVzLmZvckVhY2goKG5vZGUpID0+IHtcbiAgICAgIGlmICghbm9kZS5pbmRleCkge1xuICAgICAgICBjb25uZWN0KG5vZGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29tcG9uZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGNvbXBvbmVudCwgaSl7XG4gICAgICBjb21wb25lbnQuaW5kZXggPSBpO1xuICAgICAgY29tcG9uZW50LnNjYy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgbm9kZS5jb21wb25lbnQgPSBpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBBc3NpZ24gdGhlIGJyZWFkdGggKHgtcG9zaXRpb24pIGZvciBlYWNoIHN0cm9uZ2x5IGNvbm5lY3RlZCBjb21wb25lbnQsXG4gIC8vIGZvbGxvd2VkIGJ5IGFzc2lnbmluZyBicmVhZHRoIHdpdGhpbiB0aGUgY29tcG9uZW50LlxuICBmdW5jdGlvbiBjb21wdXRlTm9kZUJyZWFkdGhzKCkge1xuICAgIGxheWVyQ29tcG9uZW50cygpO1xuICAgIC8vIGNvbnNvbGUubG9nKHNhbmtleS5ub2RlcygpLmxlbmd0aCk7XG4gICAgLy8gY29uc29sZS5sb2coY29tcG9uZW50cy5sZW5ndGgpO1xuICAgIGNvbXBvbmVudHMuZm9yRWFjaChmdW5jdGlvbihjb21wb25lbnQsIGkpe1xuICAgICAgYmZzKGNvbXBvbmVudC5yb290LCBmdW5jdGlvbihub2RlKXtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG5vZGUuc291cmNlTGlua3NcbiAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKHNvdXJjZUxpbmspe1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZUxpbmsudGFyZ2V0LmNvbXBvbmVudCA9PSBpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLm1hcChmdW5jdGlvbihzb3VyY2VMaW5rKXtcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2VMaW5rLnRhcmdldDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdmFyIG1heCA9IDA7XG5cbiAgICB2YXIgY29tcG9uZW50c0J5QnJlYWR0aCA9IGQzLm5lc3QoKVxuICAgICAgLmtleShmdW5jdGlvbihkKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdhY2EnKTtcbiAgICAgICAgLy8gcmV0dXJuIGQuc2NjWzBdLnBvcztcbiAgICAgICAgcmV0dXJuIGQucm9vdC5wb3M7XG4gICAgICAgIC8vIHJldHVybiBkLng7XG4gICAgICB9KVxuICAgICAgLnNvcnRLZXlzKGQzLmFzY2VuZGluZylcbiAgICAgIC5lbnRyaWVzKGNvbXBvbmVudHMpXG4gICAgICAubWFwKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudmFsdWVzOyB9KTtcblxuICAgIHZhciBtYXggPSAtMSwgbmV4dE1heCA9IC0xO1xuICAgIGNvbXBvbmVudHNCeUJyZWFkdGguZm9yRWFjaChmdW5jdGlvbihjKXtcbiAgICAgIGMuZm9yRWFjaChmdW5jdGlvbihjb21wb25lbnQpe1xuICAgICAgICBjb21wb25lbnQueCA9IG1heCArIDE7XG4gICAgICAgIGNvbXBvbmVudC5zY2MuZm9yRWFjaChmdW5jdGlvbihub2RlKXtcblx0XHQgIGlmIChub2RlLmxheWVyKSBub2RlLng9bm9kZS5sYXllcjtcbiAgICAgICAgICBlbHNlIG5vZGUueCA9IGNvbXBvbmVudC54ICsgbm9kZS54O1xuICAgICAgICAgIG5leHRNYXggPSBNYXRoLm1heChuZXh0TWF4LCBub2RlLngpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgbWF4ID0gbmV4dE1heDtcbiAgICB9KTtcblxuXG4gICAgbm9kZXNcbiAgICAgIC5maWx0ZXIoZnVuY3Rpb24obm9kZSkge1xuICAgICAgICB2YXIgb3V0TGlua3MgPSBub2RlLnNvdXJjZUxpbmtzLmZpbHRlcihmdW5jdGlvbihsaW5rKXsgcmV0dXJuIGxpbmsuc291cmNlLm5hbWUgIT0gbGluay50YXJnZXQubmFtZTsgfSk7XG4gICAgICAgIHJldHVybiAob3V0TGlua3MubGVuZ3RoID09IDApO1xuICAgICAgfSlcbiAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsgbm9kZS54ID0gbWF4OyB9KVxuXG4gICAgc2NhbGVOb2RlQnJlYWR0aHMoKHNpemVbMF0gLSBub2RlV2lkdGgpIC8gTWF0aC5tYXgobWF4LCAxKSk7XG5cbiAgICBmdW5jdGlvbiBmbGF0dGVuKGEpIHtcbiAgICAgIHJldHVybiBbXS5jb25jYXQuYXBwbHkoW10sIGEpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxheWVyQ29tcG9uZW50cygpIHtcbiAgICAgIHZhciByZW1haW5pbmdDb21wb25lbnRzID0gY29tcG9uZW50cyxcbiAgICAgICAgICBuZXh0Q29tcG9uZW50cyxcbiAgICAgICAgICB2aXNpdGVkSW5kZXgsXG4gICAgICAgICAgeCA9IDA7XG5cbiAgICAgIHdoaWxlIChyZW1haW5pbmdDb21wb25lbnRzLmxlbmd0aCkge1xuICAgICAgICBuZXh0Q29tcG9uZW50cyA9IFtdO1xuICAgICAgICB2aXNpdGVkSW5kZXggPSB7fTtcblxuICAgICAgICByZW1haW5pbmdDb21wb25lbnRzLmZvckVhY2goZnVuY3Rpb24oY29tcG9uZW50KSB7XG4gICAgICAgICAgY29tcG9uZW50LnggPSB4O1xuXG4gICAgICAgICAgY29tcG9uZW50LnNjYy5mb3JFYWNoKGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgICAgIG4uc291cmNlTGlua3MuZm9yRWFjaChmdW5jdGlvbihsKSB7XG4gICAgICAgICAgICAgIGlmICghdmlzaXRlZEluZGV4Lmhhc093blByb3BlcnR5KGwudGFyZ2V0LmNvbXBvbmVudCkgJiZcbiAgICAgICAgICAgICAgICAgICBsLnRhcmdldC5jb21wb25lbnQgIT0gY29tcG9uZW50LmluZGV4KSB7XG4gICAgICAgICAgICAgICAgbmV4dENvbXBvbmVudHMucHVzaChjb21wb25lbnRzW2wudGFyZ2V0LmNvbXBvbmVudF0pO1xuICAgICAgICAgICAgICAgIHZpc2l0ZWRJbmRleFtsLnRhcmdldC5jb21wb25lbnRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVtYWluaW5nQ29tcG9uZW50cyA9IG5leHRDb21wb25lbnRzO1xuICAgICAgICArK3g7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYmZzKG5vZGUsIGV4dHJhY3RUYXJnZXRzKSB7XG4gICAgICB2YXIgcXVldWUgPSBbbm9kZV0sIGN1cnJlbnRDb3VudCA9IDEsIG5leHRDb3VudCA9IDA7XG4gICAgICB2YXIgeCA9IDA7XG5cbiAgICAgIHdoaWxlKGN1cnJlbnRDb3VudCA+IDApIHtcbiAgICAgICAgdmFyIGN1cnJlbnROb2RlID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgY3VycmVudENvdW50LS07XG5cbiAgICAgICAgaWYgKCFjdXJyZW50Tm9kZS5oYXNPd25Qcm9wZXJ0eSgneCcpKSB7XG4gICAgICAgICAgY3VycmVudE5vZGUueCA9IHg7XG4gICAgICAgICAgY3VycmVudE5vZGUuZHggPSBub2RlV2lkdGg7XG5cbiAgICAgICAgICB2YXIgdGFyZ2V0cyA9IGV4dHJhY3RUYXJnZXRzKGN1cnJlbnROb2RlKTtcblxuICAgICAgICAgIHF1ZXVlID0gcXVldWUuY29uY2F0KHRhcmdldHMpO1xuICAgICAgICAgIG5leHRDb3VudCArPSB0YXJnZXRzLmxlbmd0aDtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKGN1cnJlbnRDb3VudCA9PSAwKSB7IC8vIGxldmVsIGNoYW5nZVxuICAgICAgICAgIHgrKztcbiAgICAgICAgICBjdXJyZW50Q291bnQgPSBuZXh0Q291bnQ7XG4gICAgICAgICAgbmV4dENvdW50ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gbW92ZVNvdXJjZXNSaWdodCgpIHtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmICghbm9kZS50YXJnZXRMaW5rcy5sZW5ndGgpIHtcbiAgICAgICAgbm9kZS54ID0gZDMubWluKG5vZGUuc291cmNlTGlua3MsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lng7IH0pIC0gMTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1vdmVTaW5rc1JpZ2h0KHgpIHtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmICghbm9kZS5zb3VyY2VMaW5rcy5sZW5ndGgpIHtcbiAgICAgICAgbm9kZS54ID0geCAtIDE7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzY2FsZU5vZGVCcmVhZHRocyhreCkge1xuICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24obm9kZSkge1xuICAgICAgbm9kZS54ICo9IGt4O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcHV0ZU5vZGVEZXB0aHMoaXRlcmF0aW9ucykge1xuICAgIHZhciBub2Rlc0J5QnJlYWR0aCA9IGQzLm5lc3QoKVxuICAgICAgICAua2V5KGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICByZXR1cm4gZC54O1xuICAgICAgICB9KVxuICAgICAgICAuc29ydEtleXMoZDMuYXNjZW5kaW5nKVxuICAgICAgICAuZW50cmllcyhub2RlcylcbiAgICAgICAgLm1hcChmdW5jdGlvbihkKSB7IHJldHVybiBkLnZhbHVlczsgfSk7XG5cbiAgICBpbml0aWFsaXplTm9kZURlcHRoKCk7XG4gICAgcmVzb2x2ZUNvbGxpc2lvbnMoKTtcblxuICAgIGZvciAodmFyIGFscGhhID0gMTsgaXRlcmF0aW9ucyA+IDA7IC0taXRlcmF0aW9ucykge1xuICAgICAgcmVsYXhMZWZ0VG9SaWdodChhbHBoYSk7XG4gICAgICByZXNvbHZlQ29sbGlzaW9ucygpO1xuICAgICAgcmVsYXhSaWdodFRvTGVmdChhbHBoYSk7XG4gICAgICByZXNvbHZlQ29sbGlzaW9ucygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXRpYWxpemVOb2RlRGVwdGgoKSB7XG4gICAgICB2YXIga3kgPSBkMy5taW4obm9kZXNCeUJyZWFkdGgsIGZ1bmN0aW9uKG5vZGVzKSB7XG4gICAgICAgIHJldHVybiAoc2l6ZVsxXSAtIChub2Rlcy5sZW5ndGggLSAxKSAqIG5vZGVQYWRkaW5nKSAvIGQzLnN1bShub2RlcywgdmFsdWUpO1xuICAgICAgfSk7XG5cbiAgICAgIG5vZGVzQnlCcmVhZHRoLmZvckVhY2goZnVuY3Rpb24obm9kZXMpIHtcbiAgICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpKSB7XG4gICAgICAgICAgbm9kZS55ID0gaTtcbiAgICAgICAgICBub2RlLmR5ID0gbm9kZS52YWx1ZSAqIGt5O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHtcbiAgICAgICAgbGluay5keSA9IGxpbmsudmFsdWUgKiBreTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbGF4TGVmdFRvUmlnaHQoYWxwaGEpIHtcblxuICAgICAgbm9kZXNCeUJyZWFkdGguZm9yRWFjaChmdW5jdGlvbihub2RlcywgYnJlYWR0aCkge1xuICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS50YXJnZXRMaW5rcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciB5ID0gZDMuc3VtKG5vZGUudGFyZ2V0TGlua3MsIHdlaWdodGVkU291cmNlKSAvIGQzLnN1bShub2RlLnRhcmdldExpbmtzLCB2YWx1ZSk7XG4gICAgICAgICAgICBub2RlLnkgKz0gKHkgLSBjZW50ZXIobm9kZSkpICogYWxwaGE7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiB3ZWlnaHRlZFNvdXJjZShsaW5rKSB7XG4gICAgICAgIHJldHVybiBjZW50ZXIobGluay5zb3VyY2UpICogbGluay52YWx1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWxheFJpZ2h0VG9MZWZ0KGFscGhhKSB7XG4gICAgICBub2Rlc0J5QnJlYWR0aC5zbGljZSgpLnJldmVyc2UoKS5mb3JFYWNoKGZ1bmN0aW9uKG5vZGVzKSB7XG4gICAgICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLnNvdXJjZUxpbmtzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIHkgPSBkMy5zdW0obm9kZS5zb3VyY2VMaW5rcywgd2VpZ2h0ZWRUYXJnZXQpIC8gZDMuc3VtKG5vZGUuc291cmNlTGlua3MsIHZhbHVlKTtcbiAgICAgICAgICAgIG5vZGUueSArPSAoeSAtIGNlbnRlcihub2RlKSkgKiBhbHBoYTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIHdlaWdodGVkVGFyZ2V0KGxpbmspIHtcbiAgICAgICAgcmV0dXJuIGNlbnRlcihsaW5rLnRhcmdldCkgKiBsaW5rLnZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc29sdmVDb2xsaXNpb25zKCkge1xuICAgICAgbm9kZXNCeUJyZWFkdGguZm9yRWFjaChmdW5jdGlvbihub2Rlcykge1xuICAgICAgICB2YXIgbm9kZSxcbiAgICAgICAgICAgIGR5LFxuICAgICAgICAgICAgeTAgPSAwLFxuICAgICAgICAgICAgbiA9IG5vZGVzLmxlbmd0aCxcbiAgICAgICAgICAgIGk7XG5cbiAgICAgICAgLy8gUHVzaCBhbnkgb3ZlcmxhcHBpbmcgbm9kZXMgZG93bi5cbiAgICAgICAgLy8gQWx0ZXJhY2lvbiBkZWwgY29kaWdvXG4gICAgICAgIG5vZGVzLnNvcnQoYnlWYWx1ZSk7XG4gICAgICAgIC8vIG5vZGVzLnNvcnQoYXNjZW5kaW5nRGVwdGgpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7XG4gICAgICAgICAgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgICAgIGR5ID0geTAgLSBub2RlLnk7XG4gICAgICAgICAgaWYgKGR5ID4gMCkgbm9kZS55ICs9IGR5O1xuICAgICAgICAgIHkwID0gbm9kZS55ICsgbm9kZS5keSArIG5vZGVQYWRkaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIGJvdHRvbW1vc3Qgbm9kZSBnb2VzIG91dHNpZGUgdGhlIGJvdW5kcywgcHVzaCBpdCBiYWNrIHVwLlxuICAgICAgICBkeSA9IHkwIC0gbm9kZVBhZGRpbmcgLSBzaXplWzFdO1xuICAgICAgICBpZiAoZHkgPiAwKSB7XG4gICAgICAgICAgeTAgPSBub2RlLnkgLT0gZHk7XG5cbiAgICAgICAgICAvLyBQdXNoIGFueSBvdmVybGFwcGluZyBub2RlcyBiYWNrIHVwLlxuICAgICAgICAgIGZvciAoaSA9IG4gLSAyOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgICAgICAgZHkgPSBub2RlLnkgKyBub2RlLmR5ICsgbm9kZVBhZGRpbmcgLSB5MDtcbiAgICAgICAgICAgIGlmIChkeSA+IDApIG5vZGUueSAtPSBkeTtcbiAgICAgICAgICAgIHkwID0gbm9kZS55O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGFzY2VuZGluZ0RlcHRoKGEsIGIpIHtcbiAgICAgIHJldHVybiBiLnkgLSBhLnk7XG4gICAgICAvLyByZXR1cm4gYS55IC0gYi55O1xuICAgIH1cbiAgfVxuXG4gIC8vIEFsdGVyYWNpw7NuIGRlbCBjw7NkaWdvXG4gIC8vIE9yZGVuYSBsb3Mgbm9kb3MgZGUgbWF5b3IgYSBtZW5vciBlbiBmdW5jacOzbiBkZSBzdSB2YWxvclxuICBmdW5jdGlvbiBieVZhbHVlKGZpcnN0LCBzZWNvbmQpIHtcbiAgICBsZXQgZmlyc3RWYWx1ZSA9IGZpcnN0LnZhbHVlLFxuICAgICAgICBzZWNvbmRWYWx1ZSA9IHNlY29uZC52YWx1ZTtcblxuICAgIGlmIChmaXJzdFZhbHVlIDwgc2Vjb25kVmFsdWUpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH0gZWxzZSBpZiAoZmlyc3RWYWx1ZSA+IHNlY29uZFZhbHVlKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBmdW5jdGlvbiBjb21wdXRlTGlua0RlcHRocygpIHtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIC8vIEFsdGVyYWNpb24gZGVsIGNvZGlnb1xuICAgICAgbm9kZS5zb3VyY2VMaW5rcy5zb3J0KGJ5VmFsdWUpO1xuICAgICAgLy8gbm9kZS5zb3VyY2VMaW5rcy5zb3J0KGFzY2VuZGluZ1RhcmdldERlcHRoKTtcbiAgICAgIC8vIEFsdGVyYWNpb24gZGVsIGNvZGlnb1xuICAgICAgbm9kZS50YXJnZXRMaW5rcy5zb3J0KGJ5VmFsdWUpO1xuICAgICAgLy8gbm9kZS50YXJnZXRMaW5rcy5zb3J0KGFzY2VuZGluZ1NvdXJjZURlcHRoKTtcbiAgICB9KTtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIHZhciBzeSA9IDAsIHR5ID0gMDtcbiAgICAgIG5vZGUuc291cmNlTGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7XG4gICAgICAgIGxpbmsuc3kgPSBzeTtcbiAgICAgICAgc3kgKz0gbGluay5keTtcbiAgICAgIH0pO1xuICAgICAgbm9kZS50YXJnZXRMaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHtcbiAgICAgICAgbGluay50eSA9IHR5O1xuICAgICAgICB0eSArPSBsaW5rLmR5O1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBhc2NlbmRpbmdTb3VyY2VEZXB0aChhLCBiKSB7XG4gICAgICByZXR1cm4gYi5zb3VyY2UueSAtIGEuc291cmNlLnk7XG4gICAgICAvLyByZXR1cm4gYS5zb3VyY2UueSAtIGIuc291cmNlLnk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXNjZW5kaW5nVGFyZ2V0RGVwdGgoYSwgYikge1xuICAgICAgcmV0dXJuIGIudGFyZ2V0LnkgLSBhLnRhcmdldC55O1xuICAgICAgLy8gcmV0dXJuIGEudGFyZ2V0LnkgLSBiLnRhcmdldC55O1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNlbnRlcihub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUueSArIG5vZGUuZHkgLyAyO1xuICB9XG5cbiAgZnVuY3Rpb24gdmFsdWUobGluaykge1xuICAgIHJldHVybiBsaW5rLnZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIHNhbmtleTtcbn07XG4iXX0=
