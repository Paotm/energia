"use strict";var GLOBAL_NODES=void 0,GLOBAL_LINKS=void 0,INTRO={nodes:[3,28,15,26,12,31],nodes_description:["Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."]},SANKEY={margin:{top:40,right:200,bottom:40,left:200,header:20},separacionNodo:20,anchoNodo:20,secciones_header:[["ENERGÍAS","PRIMARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["SECTORES","DE CONSUMOS"]]},SELECTORES={categorias:[["Energías primarias",["categorias1","categorias1","categorias1","categorias1","categorias1"]],["Energías secundarias",["categorias2","categorias2","categorias2","categorias2","categorias2"]],["Energías terciarias",["categorias3","categorias3","categorias3","categorias3","categorias3"]],["Centros de transformación",["categorias4","categorias4","categorias4","categorias4","categorias4"]],["Consumos",["categorias5","categorias5","categorias5","categorias5","categorias5"]],["No aprovechables",["categorias6","categorias6","categorias6","categorias6","categorias6"]]],anio:[]},COLORES_FLUJO={importacion:"#FFCF87",exportacion:"#00897B",produccion:"#7FC6E6",perdida:"#ED7960",default:"#CFD8DC"},STATIC_NODE={close:!0,id:null},BUSCAR_NODO=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return GLOBAL_NODES.filter(function(o){return o.id===t+e})[0]};Number.prototype.format_number=function(t,e,o,n){var r="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\D":"$")+")",a=this.toFixed(Math.max(0,~~t));return(n?a.replace(".",n):a).replace(new RegExp(r,"g"),"$&"+(o||","))},$(function(){var t=$("#sankey").height(),e=$("#sankey").width(),o=void 0,n=void 0,r=void 0,a=void 0,i=void 0,s=function(){return INTRO.nodes.forEach(function(t,e){INTRO.nodes[e]=BUSCAR_NODO(t)}),!0},l=function(t){$("#tooltip").css({top:$("#sankey svg").position().top+t.y+7,left:$("#sankey svg").position().left+t.x+210}).fadeIn(100),1===t.posicionX||3===t.posicionX||5===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.oferta_interna.format_number(2,3,".",",")),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion.format_number(2,3,".",",")),$(".tooltip_importation").parent().parent().removeAttr("style"),$(".tooltip_importation").text(t.importacion.format_number(2,3,".",",")),$(".tooltip_exportation").parent().parent().removeAttr("style"),$(".tooltip_exportation").text(t.exportacion.format_number(2,3,".",",")),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas.format_number(2,3,".",",")),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros.format_number(2,3,".",","))):2===t.posicionX||4===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo.format_number(2,3,".",",")),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion.format_number(2,3,".",",")),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas.format_number(2,3,".",",")),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros.format_number(2,3,".",","))):($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo.format_number(2,3,".",",")),$(".tooltip_production").parent().parent().css({display:"none"}),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().css({display:"none"}),$(".tooltip_others").parent().parent().css({display:"none"}))},d=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a,i){var s=null===n?a.id:n,l=void 0;switch(e){case"fadeIn":null!==STATIC_NODE.id&&STATIC_NODE.id!==a.id&&($("#tooltip").fadeOut(100),t("fadeOut",STATIC_NODE.id,!0)(a,i)),STATIC_NODE.close=!0,l=d3.select("#node_"+s),l.select("rect").transition().style("stroke","black"),l.select("text").transition().style("fill","black"),o.each(function(t,e){t.source.id===s?d3.select("#node_"+t.target.id).select("text").transition().style("fill","black"):t.target.id===s&&d3.select("#node_"+t.source.id).select("text").transition().style("fill","black")}),o.filter(function(t){return t.source.id===s&&29!==t.target.id&&31!==t.target.id||t.target.id===s&&30!==t.source.id}).transition().duration(100).style("stroke","url(#gradient_prod)").style("stroke-opacity",.5),o.filter(function(t){return 30===t.source.id&&t.target.id===s}).transition().duration(100).style("stroke","url(#gradient_imp)").style("stroke-opacity",.5),o.filter(function(t){return t.source.id===s&&31===t.target.id}).transition().duration(100).style("stroke","url(#gradient_exp)").style("stroke-opacity",.5),o.filter(function(t){return t.source.id===s&&29===t.target.id||t.target.id===s&&29===s}).transition().duration(100).style("stroke",COLORES_FLUJO.perdida).style("stroke-opacity",.5);break;case"fadeOut":STATIC_NODE.close&&STATIC_NODE.id!==a.id||!0===r?(l=d3.select("#node_"+s),l.select("rect").transition().style("stroke",null),l.select("text").transition().style("fill",null),o.each(function(t,e){t.source.id===s?d3.select("#node_"+t.target.id).select("text").transition().style("fill",null):t.target.id===s&&d3.select("#node_"+t.source.id).select("text").transition().style("fill",null)}),o.filter(function(t){return t.source.id===s&&29!==t.target.id&&31!==t.target.id||t.target.id===s&&30!==t.source.id}).transition().duration(100).style("stroke",COLORES_FLUJO.default).style("stroke-opacity",null),o.filter(function(t){return 30===t.source.id&&t.target.id===s}).transition().duration(100).style("stroke","url(#gradient_imp_default)").style("stroke-opacity",null),o.filter(function(t){return t.source.id===s&&31===t.target.id}).transition().duration(100).style("stroke","url(#gradient_exp_default)").style("stroke-opacity",null),o.filter(function(t){return t.source.id===s&&29===t.target.id||t.target.id===s&&29===s}).transition().duration(100).style("stroke",COLORES_FLUJO.default).style("stroke-opacity",null)):STATIC_NODE.close=!0}}},c=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",r=d3.selectAll("#sankey .link").filter(function(t){return t.source.id===INTRO.nodes[e].id&&t.target.id===INTRO.nodes[e+1].id}),a=d3.selectAll("#sankey .node").filter(function(t){return t.id===INTRO.nodes[e].id}),i=void 0,s=void 0,l=void 0,d=void 0;switch(o){case"create":d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),i=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),i.append("div").attr("class","tooltip_header flex flex_justify_between flex_align_start"),i.select(".tooltip_header").append("h2").attr("class","tooltip_name"),i.select(".tooltip_header").append("span").attr("class","glyphicon glyphicon-remove tooltip_exit"),i.append("div").attr("class","tooltip_content"),i.select(".tooltip_content").append("p").attr("class","tooltip_production"),s=i.append("div").attr("class"," tooltip_footer flex flex_justify_between"),l=s.append("button").attr("id","last").text("Anterior"),d=s.append("button").attr("id","next").text("Siguiente"),$(".tooltip_exit").last().on("click",function(){t(e,"delete","none")}),$(document).keyup(function(o){27===o.keyCode&&2===$(".tooltip_exit").length&&t(e,"delete","none")});break;case"delete":return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),d3.selectAll("#sankey .node rect").transition().style("fill",null).style("stroke",null),d3.selectAll("#sankey .node text").transition().style("fill",null),d3.selectAll("#sankey .link").filter(function(t){return 30!==t.source.id&&31!==t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),!1;case"normal":i=d3.select("#tooltip_intro"),s=i.select("div:nth-child(3)"),l=s.select("#last"),d=s.select("#next")}switch(n){case"next":!function(t){a.select("rect").transition().style("stroke","black"),a.select("text").transition().style("fill","black")}(INTRO.nodes[e]),function(t,e){r.style("stroke","url(#gradient_link)").style("stroke-opacity",.5)}(INTRO.nodes[e],INTRO.nodes[e+1]);break;case"back":!function(t){a.select("rect").transition().style("fill",null).style("stroke",null),a.select("text").transition().style("fill",null)}(INTRO.nodes[e+1]),function(t,e){r.style("stroke",null).style("stroke-opacity",null)}(INTRO.nodes[e+1],INTRO.nodes[e+2])}i.select("h2").text(INTRO.nodes[e].nombre),i.select("p").text(INTRO.nodes_description[e]),0===e?(l.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e,"normal","none")}),d.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")})):e===INTRO.nodes.length-1?(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),d.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,"delete","none")})):(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),d.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")}))},p=function(t){return new Promise(function(e){d3.json("./public/data/data_"+t+".json",function(t){GLOBAL_NODES=t.nodes,GLOBAL_LINKS=t.links,e()})})},u=function(t,e,o,n){var s=n.margin,c={width:1400-s.left-s.right,height:e-s.top-s.bottom-s.header-38},p=n.anchoNodo,u=n.separacionNodo,f=[];i=d3.select("#sankey").append("svg").attr("width",c.width+s.right+s.left).attr("height",c.height+s.top+s.bottom+s.header+38).attr("preserveAspectRatio","xMidYMid meet");var m=i.append("g").attr("id","chart-encabezado").attr("transform","translate("+s.left+", "+(s.top+15)+")");m.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(SANKEY.secciones_header[0][0]),m.append("text").attr("class","chart-encabezado-left").attr("x",-10).attr("y",19).text(SANKEY.secciones_header[0][1]);var g=i.append("g").attr("transform","translate("+s.left+", "+(s.top+$("#chart-encabezado")[0].getBBox().height+s.header)+")");r=d3.sankey().nodeWidth(p).nodePadding(u).size([c.width,c.height]).nodes(o.nodes).links(o.links).layout();var _=i.append("defs"),y=_.append("linearGradient").attr("id","gradient_imp").attr("x1","100%").attr("y1","100%").attr("x2","0%").attr("y2","0%");y.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",1),y.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",1),y.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",0);var O=_.append("linearGradient").attr("id","gradient_imp_default").attr("x1","100%").attr("y1","100%").attr("x2","0%").attr("y2","0%");O.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),O.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),O.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",0);var h=_.append("linearGradient").attr("id","gradient_exp").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");h.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",1),h.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",1),h.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",0);var x=_.append("linearGradient").attr("id","gradient_exp_default").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");x.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),x.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),x.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",0);var N=_.append("linearGradient").attr("gradientUnits","userSpaceOnUse").attr("id","gradient_prod").attr("x1","0%").attr("y1","50%").attr("x2","100%").attr("y2","50%");N.append("stop").attr("offset","0%").attr("stop-color","rgb(32,106,171)").attr("stop-opacity",1),N.append("stop").attr("offset","20%").attr("stop-color","rgb(0,117,201)").attr("stop-opacity",1),N.append("stop").attr("offset","40%").attr("stop-color","rgb(0,157,218)").attr("stop-opacity",1),N.append("stop").attr("offset","60%").attr("stop-color","rgb(77,203,236)").attr("stop-opacity",1),N.append("stop").attr("offset","80%").attr("stop-color","rgb(127,218,241)").attr("stop-opacity",1),N.append("stop").attr("offset","100%").attr("stop-color","rgb(178,233,247)").attr("stop-opacity",1),a=r.link();var k=g.append("g").attr("id","links").selectAll(".link").data(r.links()).enter().append("path").attr("d",a).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)});k.filter(function(t){return 30===t.source.id}).style("stroke","url(#gradient_imp_default)"),k.filter(function(t){return 31===t.target.id}).style("stroke","url(#gradient_exp_default)");var b=g.append("g").attr("id","nodes").selectAll(".node").data(r.nodes()).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===f.indexOf(t.x)&&f.push(t.x),"translate("+t.x+", "+t.y+")"});b.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("rect").attr("width",r.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseenter",d("fadeIn",null)).on("mouseleave",d("fadeOut",null)).on("click",function(t){STATIC_NODE.id=t.id,STATIC_NODE.close=!1,l(t)}),b.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("text").attr("class","node-text").attr("x",10+r.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.nombre}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),f.sort(function(t,e){return t-e}),SANKEY.secciones_header.forEach(function(t,e){m.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+p+10}).text(t[0]),m.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+p+10}).attr("y",19).text(t[1])})},f=function(){return t=$("#sankey").height(),e=$("#sankey").width(),$("#content h1").outerHeight()+$("#content form").outerHeight()+550<=$("#content").outerHeight()?(d3.select("#content").attr("style",null),SANKEY.margin.bottom=40,SANKEY.margin.left=200,SANKEY.margin.top=40,SANKEY.margin.header=20,SANKEY.anchoNodo=20,SANKEY.separacionNodo=20):(d3.select("#content").attr("style","height: 100%"),SANKEY.margin.bottom=5,SANKEY.margin.left=150,SANKEY.margin.top=20,SANKEY.margin.header=15,SANKEY.anchoNodo=10,SANKEY.separacionNodo=15),!0},m=function(){return o=d3.selectAll("#sankey .link"),n=d3.selectAll("#sankey .node"),!0};p(2015).then(function(){return s()}).then(function(){return f()}).then(function(){return u(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})}).then(function(){return m()}).then(function(){return c(0,"create","next")}).then(function(){return $("#tooltip").fadeOut(100)}).then(function(){for(var e=2015;e>1959;e--)$("select[name=anio]").append('<option value="'+e+'">'+e+"</option>");$("select[name=anio]").SumoSelect({nativeOnDevice:["Android","BlackBerry","iPhone","iPad","iPod","Opera Mini","IEMobile","Silk"]}),$("select[name=anio]").on("sumo:opened",function(t){$("body").attr("style","position: fixed")}),$("select[name=anio]").on("sumo:closed",function(t){$("body").attr("style","position: relative")}),$("select[name=anio]").on("change",function(e){p($("select[name=anio]")[0].value).then(function(){return f()}).then(function(){return $("#sankey").empty()}).then(function(){return u(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})}).then(function(){return m()}).then(function(){return $("#tooltip").fadeOut(100)})}),$(".tooltip_exit").first().on("click",function(t){$("#tooltip").fadeOut(100),d("fadeOut",STATIC_NODE.id,!0)(BUSCAR_NODO(STATIC_NODE.id))}),$(window).on("resize",function(){f()})})});