"use strict";var GLOBAL_NODES=void 0,GLOBAL_LINKS=void 0,INTRO={nodes:[3,28,15,26,12,31],nodes_description:["Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."]},SANKEY={margin:{top:40,right:200,bottom:40,left:200,header:20},separacionNodo:20,anchoNodo:20,secciones_header:[["ENERGÍAS","PRIMARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["SECTORES","DE CONSUMOS"]]},SELECTORES={categorias:[["Energías primarias",["categorias1","categorias1","categorias1","categorias1","categorias1"]],["Energías secundarias",["categorias2","categorias2","categorias2","categorias2","categorias2"]],["Energías terciarias",["categorias3","categorias3","categorias3","categorias3","categorias3"]],["Centros de transformación",["categorias4","categorias4","categorias4","categorias4","categorias4"]],["Consumos",["categorias5","categorias5","categorias5","categorias5","categorias5"]],["No aprovechables",["categorias6","categorias6","categorias6","categorias6","categorias6"]]],anio:[]},BUSCAR_NODO=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return GLOBAL_NODES.filter(function(o){return o.id===t+e})[0]};$(function(){var t=$("#sankey").height(),e=$("#sankey").width(),o=void 0,n=void 0,r=void 0,a=function(){return INTRO.nodes.forEach(function(t,e){INTRO.nodes[e]=BUSCAR_NODO(t)}),!0},i=function(t){$("#tooltip").css({top:$("#sankey svg").position().top+t.y+7,left:$("#sankey svg").position().left+t.x+210}),1===t.posicionX||3===t.posicionX||5===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.oferta_interna),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion),$(".tooltip_importation").parent().parent().removeAttr("style"),$(".tooltip_importation").text(t.importacion),$(".tooltip_exportation").parent().parent().removeAttr("style"),$(".tooltip_exportation").text(t.exportacion),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros)):2===t.posicionX||4===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros)):($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo),$(".tooltip_production").parent().parent().css({display:"none"}),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().css({display:"none"}),$(".tooltip_others").parent().parent().css({display:"none"}))},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(o,n){if(null!==t){var r=d3.selectAll("#sankey .link"),a=d3.selectAll("#sankey .node"),s=null===e?o.id:e,l=void 0;switch(t){case"fadeIn":l=d3.select("#node_"+s),l.select("rect").style("stroke","black"),l.select("text").style("fill","black"),r.filter(function(t){return t.source.id===s&&43!==t.target.id?(d3.select("#node_"+t.target.id).select("text").style("fill","black"),!0):t.target.id===s&&42!==t.source.id?(d3.select("#node_"+t.source.id).select("text").style("fill","black"),!0):void 0}).style("stroke","url(#gradient_link)").style("stroke-opacity",.5),r.filter(function(t){return t.source.id===s&&43===t.target.id}).style("stroke","#394E5F").style("stroke-opacity",.5),r.filter(function(t){return t.target.id===s&&42===t.source.id}).style("stroke","#6A5587").style("stroke-opacity",.5),i(o);break;case"fadeOut":l=d3.select("#node_"+s),l.select("rect").style("stroke",null),a.select("text").style("fill",null),r.filter(function(t){return t.source.id===s&&43!==t.target.id||t.target.id===s}).style("stroke",null).style("stroke-opacity",null),r.filter(function(t){return t.source.id===s&&43===t.target.id}).style("stroke","silver").style("stroke-opacity",null),$("#tooltip").removeAttr("style")}}}},l=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",r=d3.selectAll("#sankey .link").filter(function(t){return t.source.id===INTRO.nodes[e].id&&t.target.id===INTRO.nodes[e+1].id}),a=d3.selectAll("#sankey .node").filter(function(t){return t.id===INTRO.nodes[e].id}),i=void 0,s=void 0,l=void 0,c=void 0;switch(o){case"create":d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),i=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),i.append("div"),i.select("div").attr("class","flex flex_justify_between flex_align_start").append("h2").attr("class","tooltip_name"),i.select("div").append("span").attr("class","glyphicon glyphicon-remove tooltip_exit"),i.append("p").attr("class","tooltip_production"),s=i.append("div").attr("class","flex flex_justify_between"),l=s.append("button").attr("id","last").text("Anterior"),c=s.append("button").attr("id","next").text("Siguiente"),$(".tooltip_exit").on("click",function(){t(e,"delete","none")}),$(document).keyup(function(o){27===o.keyCode&&1===$(".tooltip_exit").length&&t(e,"delete","none")});break;case"delete":return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),d3.selectAll("#sankey .node rect").transition().style("fill",null).style("stroke",null),d3.selectAll("#sankey .node text").transition().style("fill",null),d3.selectAll("#sankey .link").filter(function(t){return 42!==t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),!1;case"normal":i=d3.select("#tooltip_intro"),s=i.select("div:nth-child(3)"),l=s.select("#last"),c=s.select("#next")}switch(n){case"next":!function(t){a.select("rect").transition().style("stroke","black"),a.select("text").transition().style("fill","black")}(INTRO.nodes[e]),function(t,e){r.style("stroke","url(#gradient_link)").style("stroke-opacity",.5)}(INTRO.nodes[e],INTRO.nodes[e+1]);break;case"back":!function(t){a.select("rect").transition().style("fill",null).style("stroke",null),a.select("text").transition().style("fill",null)}(INTRO.nodes[e+1]),function(t,e){r.style("stroke",null).style("stroke-opacity",null)}(INTRO.nodes[e+1],INTRO.nodes[e+2])}i.select("h2").text(INTRO.nodes[e].nombre),i.select("p").text(INTRO.nodes_description[e]),0===e?(l.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e,"normal","none")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")})):e===INTRO.nodes.length-1?(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,"delete","none")})):(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")}))},c=function(t){return new Promise(function(e){d3.json("public/src/data_"+t+".json",function(t){GLOBAL_NODES=t.nodes,GLOBAL_LINKS=t.links,e()})})},d=function(t,e,a,i){function l(t){d3.select(this).attr("transform","translate("+(t.x=Math.max(0,Math.min(d.width-t.dx,d3.event.x)))+", "+(t.y=Math.max(0,Math.min(d.height-t.dy,d3.event.y)))+")"),o.relayout(),n=o.link(),x.attr("d",n)}var c=i.margin,d={width:1400-c.left-c.right,height:e-c.top-c.bottom-c.header-38},p=i.anchoNodo,u=i.separacionNodo,f=[];r=d3.select("#sankey").append("svg").attr("width",d.width+c.right+c.left).attr("height",d.height+c.top+c.bottom+c.header+38).attr("preserveAspectRatio","xMidYMid meet");var g=r.append("g").attr("id","chart-encabezado").attr("transform","translate("+c.left+", "+(c.top+15)+")");g.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(SANKEY.secciones_header[0][0]),g.append("text").attr("class","chart-encabezado-left").attr("x",-10).attr("y",19).text(SANKEY.secciones_header[0][1]);var m=r.append("g").attr("transform","translate("+c.left+", "+(c.top+$("#chart-encabezado")[0].getBBox().height+c.header)+")");o=d3.sankey().nodeWidth(p).nodePadding(u).size([d.width,d.height]).nodes(a.nodes).links(a.links).layout();var h=r.append("defs").append("linearGradient").attr("id","gradiente_export_on").attr("x1","0%").attr("x2","100%").attr("y1","50%").attr("y2","50%");h.append("stop").attr("offset","0%").attr("stop-color","red").attr("stop-opacity",1),h.append("stop").attr("offset","50%").attr("stop-color","red").attr("stop-opacity",1),h.append("stop").attr("offset","100%").attr("stop-color","white").attr("stop-opacity",0);var y=r.select("defs").append("linearGradient").attr("id","gradiente_export_off").attr("x1","0%").attr("x2","100%").attr("y1","50%").attr("y2","50%");y.append("stop").attr("offset","0%").attr("stop-color","silver").attr("stop-opacity",1),y.append("stop").attr("offset","50%").attr("stop-color","silver").attr("stop-opacity",1),y.append("stop").attr("offset","100%").attr("stop-color","white").attr("stop-opacity",0),r.select("defs").append("svg:pattern").attr("id","gradient_link").attr("x",0).attr("y",0).attr("patternUnits","userSpaceOnUse").attr("height","100%").attr("width","100%").append("svg:image").attr("y",0).attr("x",0).attr("xlink:href","./public/image/gradient_link.svg").attr("width","100%").attr("height","100%"),n=o.link();var x=m.append("g").attr("id","links").selectAll(".link").data(o.links()).enter().append("path").attr("d",n).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy});x.filter(function(t){return 42===t.source.id}).style("stroke","silver"),x.filter(function(t){return 43===t.target.id}).style("stroke","silver");var k=m.append("g").attr("id","nodes").selectAll(".node").data(o.nodes()).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===f.indexOf(t.x)&&f.push(t.x),"translate("+t.x+", "+t.y+")"}).call(d3.drag().subject(function(t){return t}).on("drag",l));k.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("rect").attr("width",o.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseover",s("fadeIn",null)).on("mouseout",s("fadeOut",null)),k.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("text").attr("class","node-text").attr("x",10+o.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.nombre}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),f.sort(function(t,e){return t-e}),SANKEY.secciones_header.forEach(function(t,e){g.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+p+10}).text(t[0]),g.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+p+10}).attr("y",19).text(t[1])})},p=function(){var o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t=$("#sankey").height(),e=$("#sankey").width(),o&&$("#sankey").empty(),$("#content h1").outerHeight()+$("#content form").outerHeight()+550<=$("#content").outerHeight()?(d3.select("#content").attr("style",null),SANKEY.margin.bottom=40,SANKEY.margin.left=200,SANKEY.margin.top=40,SANKEY.margin.header=20,SANKEY.anchoNodo=20,SANKEY.separacionNodo=20):(d3.select("#content").attr("style","height: 100%"),SANKEY.margin.bottom=5,SANKEY.margin.left=150,SANKEY.margin.top=20,SANKEY.margin.header=15,SANKEY.anchoNodo=10,SANKEY.separacionNodo=15),o&&d(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})},u=function(){for(var t=2015;t>1959;t--)$("select[name=anio]").append('<option value="'+t+'">'+t+"</option>");$("select[name=anio]").on("change",function(t){c($("select[name=anio]")[0].value).then(function(){return p(!0)})})};c(2015).then(function(){return a()}).then(function(){return p()}).then(function(){return d(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})}).then(function(){return l(0,"create","next")}).then(function(){return u()}).then(function(){$(window).on("resize",function(){p(!0)})})});