"use strict";var GLOBAL_NODES=void 0,GLOBAL_LINKS=void 0,INTRO={nodes:[3,28,15,26,12,31],nodes_description:["Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."]},SANKEY={secciones_header:[["ENERGÍAS","PRIMARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","TERCIARIAS"],["SECTORES","DE CONSUMOS"],["NO APROVECHABLES"]]},SELECTORES={categorias:[["Energías primarias",["categorias1","categorias1","categorias1","categorias1","categorias1"]],["Energías secundarias",["categorias2","categorias2","categorias2","categorias2","categorias2"]],["Energías terciarias",["categorias3","categorias3","categorias3","categorias3","categorias3"]],["Centros de transformación",["categorias4","categorias4","categorias4","categorias4","categorias4"]],["Consumos",["categorias5","categorias5","categorias5","categorias5","categorias5"]],["No aprovechables",["categorias6","categorias6","categorias6","categorias6","categorias6"]]],anio:[]},BUSCAR_NODO=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return GLOBAL_NODES.filter(function(o){return o.id===t+e})[0]};$(function(){var t=$("#sankey").height(),e=($("#sankey").width(),void 0),o=void 0,n=void 0,a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(o,n){if(null!==t){var a=d3.selectAll("#sankey .link"),i=(d3.selectAll("#sankey .node"),null===e?o.id:e),r=void 0;switch(t){case"fadeIn":r=d3.select("#node_"+i),r.select("rect").transition().style("stroke","black"),r.select("text").transition().style("fill","transparent"),a.filter(function(t){return t.source.id===i&&42!==t.target.id||t.target.id===i&&42!==t.target.id}).style("stroke","url(#gradient_link)").style("stroke-opacity",.5),a.filter(function(t){return t.source.id===i&&42===t.target.id||t.target.id===i&&42===t.target.id}).style("stroke","url(#gradient_lossses_on)").style("stroke-opacity",.5);break;case"fadeOut":r=d3.select("#node_"+i),r.select("rect").style("stroke",null),r.select("text").transition().style("fill",null),a.filter(function(t){return t.source.id===i&&42!==t.target.id||t.target.id===i&&42!==t.target.id}).style("stroke",null).style("stroke-opacity",null),a.filter(function(t){return t.source.id===i&&42===t.target.id||t.target.id===i&&42===t.target.id}).style("stroke","url(#gradient_lossses_off)").style("stroke-opacity",null),$("#tooltip").removeAttr("style")}}}},i=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",a=d3.selectAll("#sankey .link").filter(function(t){return t.source.id===INTRO.nodes[e].id&&t.target.id===INTRO.nodes[e+1].id}),i=d3.selectAll("#sankey .node").filter(function(t){return t.id===INTRO.nodes[e].id}),r=void 0,s=void 0,l=void 0,c=void 0;switch(o){case"create":d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),r=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),r.append("div"),r.select("div").attr("class","flex flex_justify_between flex_align_start").append("h2").attr("class","tooltip_name"),r.select("div").append("span").attr("class","glyphicon glyphicon-remove tooltip_exit"),r.append("p").attr("class","tooltip_production"),s=r.append("div").attr("class","flex flex_justify_between"),l=s.append("button").attr("id","last").text("Anterior"),c=s.append("button").attr("id","next").text("Siguiente"),$(".tooltip_exit").on("click",function(){t(e,"delete","none")}),$(document).keyup(function(o){27===o.keyCode&&1===$(".tooltip_exit").length&&t(e,"delete","none")});break;case"delete":return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),d3.selectAll("#sankey .node rect").transition().style("fill",null).style("stroke",null),d3.selectAll("#sankey .node text").transition().style("fill",null),d3.selectAll("#sankey .link").filter(function(t){return 42!==t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),!1;case"normal":r=d3.select("#tooltip_intro"),s=r.select("div:nth-child(3)"),l=s.select("#last"),c=s.select("#next")}switch(n){case"next":!function(t){i.select("rect").transition().style("stroke","black"),i.select("text").transition().style("fill","black")}(INTRO.nodes[e]),function(t,e){a.style("stroke","url(#gradient_link)").style("stroke-opacity",.5)}(INTRO.nodes[e],INTRO.nodes[e+1]);break;case"back":!function(t){i.select("rect").transition().style("fill",null).style("stroke",null),i.select("text").transition().style("fill",null)}(INTRO.nodes[e+1]),function(t,e){a.style("stroke",null).style("stroke-opacity",null)}(INTRO.nodes[e+1],INTRO.nodes[e+2])}r.select("h2").text(INTRO.nodes[e].nombre),r.select("p").text(INTRO.nodes_description[e]),0===e?(l.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e,"normal","none")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")})):e===INTRO.nodes.length-1?(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,"delete","none")})):(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")}))},r=function(t){$("#tooltip").css({top:$("#sankey svg").position().top+t.y+7,left:$("#sankey svg").position().left+t.x+210}),1===t.posicionX||3===t.posicionX||5===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text("total: "+t.oferta_interna),$(".tooltip_production").removeAttr("style").text("Producción: "+t.produccion),$(".tooltip_importation").removeAttr("style").text("Importación: "+t.importacion),$(".tooltip_exportation").removeAttr("style").text("Exportación: "+t.exportacion),$(".tooltip_consumo").css({display:"none"}).text("Consumo: "+t.consumo),$(".tooltip_losses").removeAttr("style").text("Pérdida: "+t.perdidas),$(".tooltip_others").removeAttr("style").text("Otros: "+t.otros)):2===t.posicionX||4===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text("total: "+t.oferta_interna),$(".tooltip_production").removeAttr("style").text("Producción: "+t.produccion),$(".tooltip_importation").css({display:"none"}).text("Importación: "+t.importacion),$(".tooltip_exportation").css({display:"none"}).text("Exportación: "+t.exportacion),$(".tooltip_consumo").removeAttr("style").text("Consumo: "+t.consumo),$(".tooltip_losses").removeAttr("style").text("Pérdida: "+t.perdidas),$(".tooltip_others").css({display:"none"}).text("Otros: "+t.otros)):($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text("total: "+t.oferta_interna),$(".tooltip_production").css({display:"none"}).text("Producción: "+t.produccion),$(".tooltip_importation").css({display:"none"}).text("Importación: "+t.importacion),$(".tooltip_exportation").css({display:"none"}).text("Exportación: "+t.exportacion),$(".tooltip_consumo").css({display:"none"}).text("Consumo: "+t.consumo),$(".tooltip_losses").css({display:"none"}).text("Pérdida: "+t.perdidas),$(".tooltip_others").css({display:"none"}).text("Otros: "+t.otros))},s=function(t){return new Promise(function(e){d3.json("public/src/data_"+t+".json",function(t){GLOBAL_NODES=t.nodes,GLOBAL_LINKS=t.links,e()})})},l=function(t,i,s){var l={top:40,right:200,bottom:40,left:200,header:20},c={width:1400-l.left-l.right,height:i-l.top-l.bottom-l.header-38},d=[];n=d3.select("#sankey").append("svg").attr("width",c.width+l.right+l.left).attr("height",c.height+l.top+l.bottom+l.header+38).attr("preserveAspectRatio","xMidYMid meet");var p=n.append("g").attr("id","chart-encabezado").attr("transform","translate("+l.left+", "+(l.top+15)+")");p.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(SANKEY.secciones_header[0][0]),p.append("text").attr("class","chart-encabezado-left").attr("x",-10).attr("y",19).text(SANKEY.secciones_header[0][1]);var u=n.append("g").attr("transform","translate("+l.left+", "+(l.top+$("#chart-encabezado")[0].getBBox().height+l.header)+")");e=d3.sankey().nodeWidth(20).nodePadding(20).size([c.width,c.height]).nodes(s.nodes).links(s.links).layout();var f=n.append("defs").append("linearGradient").attr("id","gradient_lossses_on").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%");f.append("stop").attr("offset","0%").attr("stop-color","red").attr("stop-opacity",1),f.append("stop").attr("offset","50%").attr("stop-color","red").attr("stop-opacity",1),f.append("stop").attr("offset","100%").attr("stop-color","white").attr("stop-opacity",0);var g=n.select("defs").append("linearGradient").attr("id","gradient_lossses_off").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%");g.append("stop").attr("offset","0%").attr("stop-color","silver").attr("stop-opacity",1),g.append("stop").attr("offset","50%").attr("stop-color","silver").attr("stop-opacity",1),g.append("stop").attr("offset","100%").attr("stop-color","white").attr("stop-opacity",0),n.select("defs").append("svg:pattern").attr("id","gradient_link").attr("x",0).attr("y",0).attr("patternUnits","userSpaceOnUse").attr("height","100%").attr("width","100%").append("svg:image").attr("y",0).attr("x",0).attr("xlink:href","./public/image/gradient_link.svg").attr("width","100%").attr("height","100%"),o=e.link();var m=(u.append("g").attr("id","links").selectAll(".link").data(e.links()).enter().append("path").attr("d",o).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)}).filter(function(t){return 42===t.target.id}).style("stroke","url(#gradient_lossses_off)"),u.append("g").attr("id","nodes").selectAll(".node").data(e.nodes()).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===d.indexOf(t.x)&&d.push(t.x),"translate("+t.x+", "+t.y+")"}));m.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("rect").attr("width",e.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseover",a("fadeIn",null)).on("mouseout",a("fadeOut",null)).on("mousemove",r),m.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("text").attr("class","node-text").attr("x",10+e.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.nombre}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),d.sort(function(t,e){return t-e}),SANKEY.secciones_header.forEach(function(t,e){p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return d[e]+20+10}).text(t[0]),p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return d[e]+20+10}).attr("y",19).text(t[1])})},c=function(){SELECTORES.categorias.forEach(function(t,e){$("select[name=categorias]").append('<option value="'+e+'">'+t[0]+"</option>")}),SELECTORES.categorias[$("select[name=categorias]")[0].value][1].forEach(function(t,e){$("select[name=subcategorias]").append('<option value="'+e+'">'+t+"</option>")}),$("select[name=categorias]").on("change",function(t){$("select[name=subcategorias]").empty(),SELECTORES.categorias[$("select[name=categorias]")[0].value][1].forEach(function(t,e){$("select[name=subcategorias]").append('<option value="'+e+'">'+t+"</option>")})});for(var e=2015;e>1959;e--)$("select[name=anio]").append('<option value="'+e+'">'+e+"</option>");$("select[name=anio]").on("change",function(e){s($("select[name=anio]")[0].value).then(function(){$("#sankey").empty(),l(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS})})})};s(2015).then(function(){INTRO.nodes.forEach(function(t,e){INTRO.nodes[e]=BUSCAR_NODO(t)}),l(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS}),i(0,"create","next"),c()})});