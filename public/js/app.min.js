"use strict";var colores=["#0075C9","#009DDA","#00B5E4"],subtractLight=function(t,e){var n=parseInt(t,16)-e,i=n<0?0:n;return i=i.toString(16).length>1?i.toString(16):"0"+i.toString(16)},darken=function(t,e){return t=t.indexOf("#")>=0?t.substring(1,t.length):t,e=parseInt(255*e/100),t="#"+subtractLight(t.substring(0,2),e)+subtractLight(t.substring(2,4),e)+subtractLight(t.substring(4,6),e)};$(function(){var t=$("#sankey").height(),e=($("#sankey").width(),void 0),n=void 0,i=void 0,r=void 0,o=void 0,l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(e,n){var i=d3.selectAll("#sankey .link"),r=(d3.selectAll("#sankey .node"),null===t?e.id:t),o=d3.select("#node_"+r);o.select("rect").transition().style("fill","black").style("stroke","black"),o.select("text").transition().style("fill","black"),i.filter(function(t){return t.source.id===r&&42!==t.target.id||t.target.id===r&&42!==t.target.id}).transition().style("stroke","#0075C9").style("stroke-opacity",.5),i.filter(function(t){return t.source.id===r&&42===t.target.id||t.target.id===r&&42===t.target.id}).transition().style("stroke","red").style("stroke-opacity",.5)}},s=function(t){$("#tooltip").css({top:event.layerY+20,left:event.layerX+20}),$(".tooltip_name").text(t.name),$(".tooltip_production").text("Producción: "+t.production),$(".tooltip_losses").text("Pérdida: "+t.losses)},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(e,n){var i=d3.selectAll("#sankey .link"),r=(d3.selectAll("#sankey .node"),null===t?e.id:t),o=d3.select("#node_"+r);o.select("rect").transition().style("fill",null).style("stroke",null),o.select("text").transition().style("fill",null),i.filter(function(t){return t.source.id===r&&42!==t.target.id||t.target.id===r&&42!==t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),i.filter(function(t){return t.source.id===r&&42===t.target.id||t.target.id===r&&42===t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),$("#tooltip").removeAttr("style")}},d=function(t){return e.filter(function(e){return e.id===t})[0]},c=function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=[2,27,13,26,12,31],l=d(o[e]),s=d(o[e+1]),a=d(o[e+2]),c=void 0,u=void 0,f=void 0,p=void 0,h=function(t){var e=d3.select("#node_"+t.id);e.select("rect").transition().style("fill",null).style("stroke",null),e.select("text").transition().style("fill",null)},g=function(t,e){d3.selectAll("#sankey .link").filter(function(n){return n.source.id===t.id&&n.target.id===e.id}).transition().style("stroke",null).style("stroke-opacity",null)};if(n?(d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),c=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),c.append("h2").attr("class","tooltip_name"),c.append("p").attr("class","tooltip_production"),u=c.append("div").attr("class","flex flex_justify_between"),f=u.append("button").attr("id","last").text("Anterior"),p=u.append("button").attr("id","next").text("Siguiente")):(c=d3.select("#tooltip_intro"),u=c.select("div"),f=u.select("#last"),p=u.select("#next")),i)return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),o.forEach(function(t,e){var n=d(o[e]),i=d(o[e+1]);h(n),g(n,i)}),!1;r?(function(t){var e=d3.select("#node_"+t.id);e.select("rect").transition().style("fill","black").style("stroke","black"),e.select("text").transition().style("fill","black")}(l),function(t,e){d3.selectAll("#sankey .link").filter(function(n){return n.source.id===t.id&&n.target.id===e.id}).transition().style("stroke","#0075C9").style("stroke-opacity",.5)}(l,s)):(h(s),g(s,a)),c.select("h2").text(l.name),c.select("p").text("Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."),f.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,!1,!1,!1)}),p.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1)}),0===e?f.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e)}):e===o.length-1&&p.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,!1,!0)})},u=function(t,e,n){var d={top:40,right:200,bottom:40,left:200,header:20},c={width:1400-d.left-d.right,height:e-d.top-d.bottom-d.header-19},u=["COL 01","COL 02","COL 03","COL 04","COL 05","COL 06"],f=[];o=d3.select("#sankey").append("svg").attr("width",c.width+d.right+d.left).attr("height",c.height+d.top+d.bottom+d.header+19).attr("preserveAspectRatio","xMidYMid meet");var p=o.append("g").attr("id","chart-encabezado").attr("transform","translate("+d.left+", "+(d.top+15)+")");p.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(u[0]);var h=o.append("g").attr("transform","translate("+d.left+", "+(d.top+$("#chart-encabezado")[0].getBBox().height+d.header)+")");i=d3.sankey().nodeWidth(20).nodePadding(20).size([c.width,c.height]).nodes(n.nodes).links(n.links).layout(),r=i.link();var g=(h.append("g").attr("id","links").selectAll(".link").data(n.links).enter().append("path").attr("d",r).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy}),h.append("g").attr("id","nodes").selectAll(".node").data(n.nodes).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===f.indexOf(t.x)&&f.push(t.x),"translate("+t.x+", "+t.y+")"}));g.append("rect").attr("width",i.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseover",l()).on("mouseout",a()).on("mousemove",s),g.append("text").attr("class","node-text").attr("x",10+i.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.name}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),f.sort(),u.forEach(function(t,e){p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+20+10}).text(t)})};!function(){(function(){console.log("Se solicitan archivos");return new Promise(function(t){d3.json("public/src/nodes.json",function(i){e=i,d3.json("public/src/links.json",function(e){n=e,t()})})})})().then(function(){u(0,t,{nodes:e,links:n}),c(0,!0)})}()});