"use strict";var COLORES_GRADIENTE=["#206aab","#0075c9","#009dda","#4dcbec","#7fdaf1","#b2e9f7"],GLOBAL_NODES=void 0,GLOBAL_LINKS=void 0,INTRO={nodes:[3,28,15,26,12,31],nodes_description:["Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."]},SANKEY={secciones_header:[["ENERGÍAS","PRIMARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","TERCIARIAS"],["SECTORES","DE CONSUMOS"],["NO APROVECHABLES"]]},GENERAR_GRADIENTES=function(t){var e={};return t.forEach(function(o,n){t.forEach(function(t,i){e[""+(n+1)+(i+1)]=[o,t]})}),e},BUSCAR_NODO=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return GLOBAL_NODES.filter(function(o){return o.id===t+e})[0]};$(function(){var t=$("#sankey").height(),e=($("#sankey").width(),void 0),o=void 0,n=void 0,i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(o,n){if(null!==t){var i=d3.selectAll("#sankey .link"),s=(d3.selectAll("#sankey .node"),null===e?o.id:e),r=void 0;switch(t){case"fadeIn":r=d3.select("#node_"+s),r.select("rect").transition().style("stroke","black"),r.select("text").transition().style("fill","transparent"),i.filter(function(t){return t.source.id===s&&42!==t.target.id||t.target.id===s&&42!==t.target.id}).transition().style("stroke",function(t){return"url(#key_"+t.source.position+t.target.position+")"}).style("stroke-opacity",.5),i.filter(function(t){return t.source.id===s&&42===t.target.id||t.target.id===s&&42===t.target.id}).transition().style("stroke","url(#losses)").style("stroke-opacity",.5);break;case"fadeOut":r=d3.select("#node_"+s),r.select("rect").transition().style("stroke",null),r.select("text").transition().style("fill",null),i.style("stroke",null).style("stroke-opacity",null),$("#tooltip").removeAttr("style")}}}},s=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",i=d3.selectAll("#sankey .link").filter(function(t){return t.source.id===INTRO.nodes[e].id&&t.target.id===INTRO.nodes[e+1].id}),s=d3.selectAll("#sankey .node").filter(function(t){return t.id===INTRO.nodes[e].id}),r=void 0,a=void 0,l=void 0,d=void 0;switch(o){case"create":d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),r=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),r.append("h2").attr("class","tooltip_name"),r.append("p").attr("class","tooltip_production"),a=r.append("div").attr("class","flex flex_justify_between"),l=a.append("button").attr("id","last").text("Anterior"),d=a.append("button").attr("id","next").text("Siguiente");break;case"delete":return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),d3.selectAll("#sankey .node rect").transition().style("fill",null).style("stroke",null),d3.selectAll("#sankey .node text").transition().style("fill",null),d3.selectAll("#sankey .link").transition().style("stroke",null).style("stroke-opacity",null),!1;case"normal":r=d3.select("#tooltip_intro"),a=r.select("div"),l=a.select("#last"),d=a.select("#next")}switch(n){case"next":!function(t){s.select("rect").transition().style("stroke","black"),s.select("text").transition().style("fill","black")}(INTRO.nodes[e]),function(t,e){i.transition().style("stroke",function(t){return"url(#key_"+t.source.position+t.target.position+")"}).style("stroke-opacity",.5)}(INTRO.nodes[e],INTRO.nodes[e+1]);break;case"back":!function(t){s.select("rect").transition().style("fill",null).style("stroke",null),s.select("text").transition().style("fill",null)}(INTRO.nodes[e+1]),function(t,e){i.transition().style("stroke",null).style("stroke-opacity",null)}(INTRO.nodes[e+1],INTRO.nodes[e+2])}r.select("h2").text(INTRO.nodes[e].name),r.select("p").text(INTRO.nodes_description[e]),0===e?(l.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e,"normal","none")}),d.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")})):e===INTRO.nodes.length-1?(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),d.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,"delete","none")})):(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),d.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")}))},r=function(t){$("#tooltip").css({top:$("#sankey svg").position().top+t.y+7-20,left:$("#sankey svg").position().left+t.x+210}),1===t.position||3===t.position||5===t.position?($(".tooltip_name").text(t.name),$(".tooltip_ktep").text(t.ketp),$(".tooltip_production").removeAttr("style").text("Producción: "+t.production),$(".tooltip_importation").removeAttr("style").text("Importación: "+t.importation),$(".tooltip_exportation").removeAttr("style").text("Exportación: "+t.exportation),$(".tooltip_consumo").css({display:"none"}).text("Consumo: "+t.consumo),$(".tooltip_losses").removeAttr("style").text("Pérdida: "+t.losses),$(".tooltip_others").removeAttr("style").text("Otros: "+t.others)):2===t.position||4===t.position?($(".tooltip_name").text(t.name),$(".tooltip_ktep").text(t.ketp),$(".tooltip_production").removeAttr("style").text("Producción: "+t.production),$(".tooltip_importation").css({display:"none"}).text("Importación: "+t.importation),$(".tooltip_exportation").css({display:"none"}).text("Exportación: "+t.exportation),$(".tooltip_consumo").removeAttr("style").text("Consumo: "+t.consumo),$(".tooltip_losses").removeAttr("style").text("Pérdida: "+t.losses),$(".tooltip_others").css({display:"none"}).text("Otros: "+t.others)):($(".tooltip_name").text(t.name),$(".tooltip_ktep").text(t.ketp),$(".tooltip_production").css({display:"none"}).text("Producción: "+t.production),$(".tooltip_importation").css({display:"none"}).text("Importación: "+t.importation),$(".tooltip_exportation").css({display:"none"}).text("Exportación: "+t.exportation),$(".tooltip_consumo").css({display:"none"}).text("Consumo: "+t.consumo),$(".tooltip_losses").css({display:"none"}).text("Pérdida: "+t.losses),$(".tooltip_others").css({display:"none"}).text("Otros: "+t.others))},a=function(t,s,a){var l={top:40,right:200,bottom:40,left:200,header:20},d={width:1400-l.left-l.right,height:s-l.top-l.bottom-l.header-38},c=[];n=d3.select("#sankey").append("svg").attr("width",d.width+l.right+l.left).attr("height",d.height+l.top+l.bottom+l.header+38).attr("preserveAspectRatio","xMidYMid meet");var p=n.append("g").attr("id","chart-encabezado").attr("transform","translate("+l.left+", "+(l.top+15)+")");p.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(SANKEY.secciones_header[0][0]),p.append("text").attr("class","chart-encabezado-left").attr("x",-10).attr("y",19).text(SANKEY.secciones_header[0][1]);var u=n.append("g").attr("transform","translate("+l.left+", "+(l.top+$("#chart-encabezado")[0].getBBox().height+l.header)+")");console.log(a.nodes),console.log(a.nodes.filter(function(t){return t.internal_offer>0||void 0===t.internal_offer})),e=d3.sankey().nodeWidth(20).nodePadding(20).size([d.width,d.height]).nodes(a.nodes).links(a.links).layout();var f=GENERAR_GRADIENTES(COLORES_GRADIENTE);n.append("defs").append("linearGradient").attr("id","losses").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%"),d3.select("#losses").append("stop").attr("offset","0%").attr("stop-color","red").attr("stop-opacity",1),d3.select("#losses").append("stop").attr("offset","50%").attr("stop-color","red").attr("stop-opacity",1),d3.select("#losses").append("stop").attr("offset","100%").attr("stop-color","white").attr("stop-opacity",0);for(var m in f)n.select("defs").append("linearGradient").attr("id","key_"+m).attr("gradientUnits","userSpaceOnUse"),d3.select("#key_"+m).append("stop").attr("offset","0%").attr("stop-color",""+f[m][0]).attr("stop-opacity",1),d3.select("#key_"+m).append("stop").attr("offset","100%").attr("stop-color",""+f[m][1]).attr("stop-opacity",1);o=e.link();var y=(u.append("g").attr("id","links").selectAll(".link").data(e.links()).enter().append("path").attr("d",o).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy}),u.append("g").attr("id","nodes").selectAll(".node").data(e.nodes()).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===c.indexOf(t.x)&&c.push(t.x),"translate("+t.x+", "+t.y+")"}));y.filter(function(t){return"borrar"!==t.name&&t.internal_offer>0||void 0===t.internal_offer}).append("rect").attr("width",e.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseover",i("fadeIn",null)).on("mouseout",i("fadeOut",null)).on("mousemove",r),y.filter(function(t){return"borrar"!==t.name&&t.internal_offer>0||void 0===t.internal_offer}).append("text").attr("class","node-text").attr("x",10+e.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.name}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),c.sort(function(t,e){return t-e}),SANKEY.secciones_header.forEach(function(t,e){p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return c[e]+20+10}).text(t[0]),p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return c[e]+20+10}).attr("y",19).text(t[1])})};(function(){return new Promise(function(t){d3.json("public/src/nodes.json",function(e){GLOBAL_NODES=e,d3.json("public/src/links.json",function(e){GLOBAL_LINKS=e,t()})})})})().then(function(){INTRO.nodes.forEach(function(t,e){INTRO.nodes[e]=BUSCAR_NODO(t)}),a(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS}),s(0,"create","next")})});