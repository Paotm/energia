'use strict';

// VARIABLES GLOBALES
var colores = ['#0075C9', '#009DDA', '#00B5E4'];

//  Funciones
// const formatoNumero = (d) => {
//   let format = d3.format(',.0f');
//
//   return `${ format(d) } Twh`;
// };

/* Resta el porcentaje indicado a un color (RR, GG o BB) hexadecimal para oscurecerlo */
var subtractLight = function subtractLight(color, amount) {
  var cc = parseInt(color, 16) - amount;
  var c = cc < 0 ? 0 : cc;
  c = c.toString(16).length > 1 ? c.toString(16) : '0' + c.toString(16);

  return c;
};

/* Oscurece un color hexadecimal de 6 caracteres #RRGGBB segun el porcentaje indicado */
var darken = function darken(color, amount) {
  color = color.indexOf('#') >= 0 ? color.substring(1, color.length) : color;
  amount = parseInt(255 * amount / 100);
  color = '#' + subtractLight(color.substring(0, 2), amount) + subtractLight(color.substring(2, 4), amount) + subtractLight(color.substring(4, 6), amount);

  return color;
};

$(function () {

  var height = $('#sankey').height(),
      width = $('#sankey').width(),

  // clavesNodos = [],
  // dataSankey  = {},
  // moveId = 0,
  nodesOri = void 0,
      linksOri = void 0,
      nodesGlo = void 0,
      linksGlo = void 0,
      sankeyChartD3 = void 0,
      path = void 0,
      svg = void 0;

  //  Funciones
  // const generarPuertas    = () => {
  //   dataSankey.nodes.filter((element) => (element.parent === false)).forEach((v, k) => {
  //     clavesNodos.push({ 'id': v.id, 'state': true });
  //   });
  // };
  var createGrafico = function createGrafico(data, container) {
    // Variables
    var margin = { top: 0, right: 0, bottom: 0, left: 0 };
    var size = { width: 300 - margin.left - margin.right, height: 50 - margin.top - margin.bottom };
    var years = ['2012', '2013', '2014', '2015', '2016', '2017'];
    var newData = [];

    data.forEach(function (v, k) {
      newData.push({ date: new Date(years[k]), value: v });
    });

    var svgGrafico = container.html('').append('svg').attr('width', size.width + margin.left + margin.right).attr('height', size.height + margin.top + margin.bottom).append('g').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');

    // let parseTime = d3.timeParse('%d-%b-%y');

    var x = d3.scaleTime().domain(d3.extent(newData, function (d) {
      return d.date;
    })).rangeRound([0, size.width]);
    var y = d3.scaleLinear().domain(d3.extent(newData, function (d) {
      return d.value;
    })).rangeRound([size.height, 0]);

    var line = d3.line().x(function (d) {
      return x(d.date);
    }).y(function (d) {
      return y(d.value);
    });

    svgGrafico.append('g').call(d3.axisBottom(x)).style('transform', 'translate(0px, ' + (size.height - 1) + 'px)');

    svgGrafico.append('g').call(d3.axisLeft(y));
    // .append('text')
    //   .attr('fill', '#000')
    //   .attr('transform', 'rotate(-90)')
    //   .attr('y', 6)
    //   .attr('dy', '0.71em')
    //   .attr('text-anchor', 'end')
    //   .text('Price ($)');

    svgGrafico.append('path').datum(newData).attr('fill', 'none').attr('stroke', 'steelblue').attr('stroke-linejoin', 'round').attr('stroke-linecap', 'round').attr('stroke-width', 1.5).attr('d', line);
  };

  var fadeIn = function fadeIn() {
    var id = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    return function (g, i) {
      var all_links = d3.selectAll('#sankey .link'),
          all_nodes = d3.selectAll('#sankey .node'),
          nodes_id = [],
          element_id = id === null ? g.id : id;

      console.log(element_id);

      var event_node = all_nodes.filter(function (d) {
        return d.id === element_id;
      });
      event_node.select('rect').transition().style('fill', 'black').style('stroke', 'black');
      event_node.select('text').transition().style('fill', 'black');

      var filter_nodes = all_nodes.filter(function (d) {
        var state = false;

        nodes_id.forEach(function (element) {
          if (d.id === element) {
            state = true;
          }
        });

        return state;
      });
      filter_nodes.select('rect').transition().style('fill', 'black').style('stroke', 'black');
      filter_nodes.select('text').transition().style('fill', 'black');

      var filter_links = all_links.filter(function (d) {
        var state = true;

        if (d.source.id === element_id) {
          nodes_id.push(d.target.id);
        } else if (d.target.id === element_id) {
          nodes_id.push(d.source.id);
        } else {
          state = false;
        }

        return state;
      });
      filter_links.transition().style('stroke', '#0075C9').style('stroke-opacity', 0.5);
    };
  };
  var tooltipIn = function tooltipIn(d) {
    $('#tooltip').css({ top: event.layerY + 20, left: event.layerX + 20 });
    $('.tooltip_name').text(d.name);
    $('.tooltip_production').text('Producci\xF3n: ' + d.production);
    $('.tooltip_losses').text('P\xE9rdida: ' + d.losses);
  };
  var fadeOut = function fadeOut(opacity) {
    return function (g, i) {
      var all_links = d3.selectAll('#sankey .link'),
          all_nodes = d3.selectAll('#sankey .node'),
          nodes_id = [];

      var event_node = all_nodes.filter(function (d) {
        return d.id === g.id;
      });
      event_node.select('rect').transition().style('fill', null).style('stroke', null);
      event_node.select('text').transition().style('fill', null);

      var filter_nodes = all_nodes.filter(function (d) {
        var state = false;

        nodes_id.forEach(function (element) {
          if (d.id === element) {
            state = true;
          }
        });

        return state;
      });
      filter_nodes.select('rect').transition().style('fill', null).style('stroke', null);
      filter_nodes.select('text').transition().style('fill', null);

      var filter_links = all_links.filter(function (d) {
        var state = true;

        if (d.source.id === g.id) {
          nodes_id.push(d.target.id);
        } else if (d.target.id === g.id) {
          nodes_id.push(d.source.id);
        } else {
          state = false;
        }

        return state;
      });
      filter_links.transition().style('stroke', null).style('stroke-opacity', null);

      $('#tooltip').removeAttr('style');
    };
  };

  var intro = function intro() {
    fadeIn(2)();
    fadeIn(27)();
    fadeIn(13)();
    fadeIn(26)();
    fadeIn(12)();
    fadeIn(31)();
  };
  // const colapsarExpandirNodo = (nodo) => {
  //
  //   nodesOri[nodo.id].group = (nodesOri[nodo.id].group) ? (false) : (true);
  //
  //   return nodesOri;
  //
  //
  //   // let oldLinks = dataSankey.links;
  //
  //   // if (nodo.parent === false) {
  //   //   console.log('Se expande nodo');
  //   //   clavesNodos.forEach((element) => { if (element.id === nodo.id + moveId) { element.state = false; } });
  //   //
  //   //   dataSankey.nodes = nodosOriginales;
  //   //   dataSankey.links = linksOriginales;
  //   //
  //   //   dataSankey.links = declareGroupLinks(dataSankey.links, true);
  //   //
  //   //   dataSankey = buscarNodes(dataSankey.nodes, dataSankey.links);
  //   //   moveId = 0;
  //   //   $('#sankey').empty();
  //   //   dibujarSankey(width, height, dataSankey);
  //   //   // actualizarSankey($('#content').width(), $('#content').height(), dataSankey, oldLinks);
  //   // } else {
  //   //   console.log('Se colapsa nodo');
  //   //   // let parent = dataSankey.nodes.filter((element) => (element.name === nodo.parent))[0];
  //   //   // clavesNodos.filter((element) => (element.id === parent.id))[0].state = true;
  //   //   //
  //   //   // dataSankey = buscarNodes(nodosOriginales, dataSankey.links = declareGroupLinks(linksOriginales));
  //   //   //
  //   //   // $('#sankey').empty();
  //   //   // dibujarSankey(width, height, dataSankey);
  //   //   // actualizarSankey($('#content').width(), $('#content').height(), dataSankey, oldLinks);
  //   // }
  // };

  var dibujarSankey = function dibujarSankey(width, heigth, data) {

    // Se vacia contenedor
    $('#sankey').empty();

    // Se definen variables
    var margin = {
      top: 40,
      right: 200,
      bottom: 40,
      left: 200,
      header: 20
    },
        headerSize = 19,
        size = {
      width: (width < 1400 ? width : 1400) - margin.left - margin.right,
      height: heigth - margin.top - margin.bottom - margin.header - headerSize
    },
        secciones = ['COL 01', 'COL 02', 'COL 03', 'COL 04', 'COL 05', 'COL 06'],
        anchoNodo = 20,
        separacionNodo = 20,
        posColumnas = [];

    // CreaciÃ³n SVG
    svg = d3.select('#sankey').append('svg').attr('width', size.width + margin.right + margin.left).attr('height', size.height + margin.top + margin.bottom + margin.header + headerSize);

    // Borrar
    // svg.append('g')
    //   .attr('transform', `translate(${ 0 }, ${ 0 })`)
    //   .append('rect')
    //   .attr('width', `${ size.width + margin.right + margin.left }px`)
    //   .attr('height', `${ margin.top }px`)
    //   .style('fill', 'silver');
    // Borrar
    // svg.append('g')
    //   .attr('transform', `translate(${ 0 }, ${ height - margin.bottom })`)
    //   .append('rect')
    //   .attr('width', `${ size.width + margin.right + margin.left }px`)
    //   .attr('height', `${ margin.top }px`)
    //   .style('fill', 'silver');
    // Borrar
    // svg.append('g')
    //   .attr('transform', `translate(${ 0 }, ${ margin.top + headerSize })`)
    //   .append('rect')
    //   .attr('width', `${ size.width + margin.right + margin.left }px`)
    //   .attr('height', `${ margin.header }px`)
    //   .style('fill', 'silver');

    // Se agregan encabezados
    var encabezado = svg.append('g').attr('id', 'chart-encabezado').attr('transform', 'translate(' + margin.left + ', ' + (margin.top + 15) + ')');
    encabezado.append('text').attr('class', 'chart-encabezado-left').attr('x', -10).text(secciones[0]);

    // Se crea grafico
    var chart = svg.append('g').attr('transform', 'translate(' + margin.left + ', ' + (margin.top + $('#chart-encabezado')[0].getBBox().height + margin.header) + ')');

    // CreaciÃ³n Sankey
    sankeyChartD3 = d3.sankey().nodeWidth(anchoNodo).nodePadding(separacionNodo).size([size.width, size.height]).nodes(data.nodes).links(data.links).layout();

    // CreaciÃ³n de Links
    path = sankeyChartD3.link();

    //  Se crean links
    var link = chart.append('g').attr('id', 'links').selectAll('.link').data(data.links).enter().append('path').attr('d', path).attr('class', 'link').style('stroke-width', function (d) {
      return Math.max(1, d.dy);
    })
    // .on('mouseover', (d) => { d3.select(d3.event.target).style('stroke-opacity', 1); })
    // .on('mouseout', (d) => { d3.select(d3.event.target).style('stroke-opacity', 0.75); })
    .sort(function (a, b) {
      return b.dy - a.dy;
    });

    // link.filter((element) => (element.target.name === 'EXPORTACIONES' || element.target.name === 'CONSUMO PROPIO' || element.target.name === 'TRANSPORTE' || element.target.name === 'PERDIDA'))
    //   .style('stroke', '#BA3F1D');

    // Se crean nodos
    var node = chart.append('g').attr('id', 'nodes').selectAll('.node').data(data.nodes).enter().append('g').attr('id', function (d) {
      return d.id;
    }).attr('class', 'node').attr('transform', function (d) {

      if (posColumnas.indexOf(d.x) === -1) {
        posColumnas.push(d.x);
      }

      return 'translate(' + d.x + ', ' + d.y + ')';
    }); // error compatibilidad
    // .call(d3.drag().on('drag', dragmove));

    // Se crean rectangulos nodos
    node.append('rect').attr('width', sankeyChartD3.nodeWidth()).attr('height', function (d) {
      return Math.max(5, d.dy);
    }).on('mouseover', fadeIn()).on('mouseout', fadeOut()).on('mousemove', tooltipIn);

    // Se crean textos nodos
    node.append('text').attr('class', 'node-text').attr('x', 10 + sankeyChartD3.nodeWidth()).attr('y', function (d) {
      return d.dy / 2;
    }).attr('dy', '0.35em').text(function (d) {
      return d.name;
    }).filter(function (d) {
      return d.targetLinks.length === 0;
    }).attr('class', 'node-text-start').attr('x', -10);

    // Se agrega texto referencia hover link
    // link.append('title').text((d) => `${ d.source.name } (${ d.source.id }) â ${ d.target.name } (${ d.target.id }) â ${ d.value }`);

    // Se agrega texto referencia hover node
    // node.append('title').text((d) => `${ d.name } (${ d.id })`);

    // Se agregan encabezados
    posColumnas.sort(); // Se ordena posicion de columnas
    secciones.forEach(function (v, k) {
      encabezado.append('text').filter(function (d) {
        return k > 0;
      }).attr('class', 'chart-encabezado-right').attr('x', function (d) {
        return posColumnas[k] + anchoNodo + 10;
      }).text(v);
    });

    // the function for moving the nodes
    // function dragmove(d) {
    //   d3.select(this).attr('transform', `translate(${ d.x = Math.max(0, Math.min(size.width - d.dx, d3.event.x)) }, ${ d.y = Math.max(0, Math.min(size.height - d.dy, d3.event.y)) })`);
    //   sankeyChartD3.relayout();
    //   link.attr('d', path);
    // }
  };

  // const actualizarSankey = (width, heigth, data, oldLinks) => {
  //   const linksDiff = (links_old, links_new) => {
  //     console.log(links_old);
  //     console.log(links_new);
  //     let links = [],
  //         source,
  //         target;
  //
  //     links_new.forEach((v, k) => {
  //       source  = v.source;
  //       target  = v.target;
  //
  //       links_old.forEach((v, k) => { if ((source !== v.source.id) || (target !== v.target.id)) { links.push(v); } });
  //     });
  //
  //     return links;
  //   };
  //
  //   // let newNodes = nodesDiff(data, sankeyData);
  //   // let newLinks = linksDiff(oldLinks, data.links);
  //
  //   // Parametros
  //   let margin = {
  //     top: 0,
  //     right: 0,
  //     bottom: 0,
  //     left: 0
  //   };
  //   let size = {
  //     width: width - margin.left - margin.right,
  //     height: heigth - margin.top - margin.bottom
  //   };
  //
  //   // CreaciÃ³n Sankey
  //   sankeyChartD3 = d3.sankey()
  //     .nodeWidth(20) // Ancho nodo
  //     .size([size.width, size.height])
  //     .nodes(data.nodes)
  //     .links(data.links)
  //     .layout(32);
  //
  //   sankeyChartD3.relayout();
  //
  //   // CreaciÃ³n de Links
  //   path = sankeyChartD3.link();
  //   $('#links').empty();
  //
  //   let links = d3.select('#links')
  //     .selectAll('.link')
  //     .data(data.links)
  //     .enter();
  //
  //   links.append('path')
  //       .attr('class', 'link')
  //       .attr('d', (d) => path(d))
  //       .style('stroke-width', (d) => {
  //         return d.dy;
  //       })
  //       .style('stroke', 'gray')
  //       .on('mouseover', (d) => {
  //         // console.log(d3.event);
  //         d3.select(d3.event.target).style('stroke', 'red');
  //       })
  //       .on('mouseout', (d) => {
  //         d3.select(d3.event.target).style('stroke', 'gray');
  //       });
  //
  //   // d3.selectAll('.link')
  //   //   .data(data.links)
  //   //   .attr('d', (d) => path(d));
  //   d3.selectAll('.node')
  //     .data(data.nodes)
  //     // .transition()
  //     .attr('transform', (d) => `translate(${ d.x }, ${ d.y })`);
  //   d3.selectAll('rect')
  //     .data(data.nodes)
  //     .style('opacity', 0)
  //     .attr('width', sankeyChartD3.nodeWidth())
  //     .attr('height', (d) => d.dy)
  //     .transition()
  //     .style('opacity', 1);
  //
  //   // Create Diference
  //   // newLinks.forEach((v, k) => {
  //   //   let link = d3.select('#links')
  //   //     .append('path')
  //   //       .attr('class', 'link')
  //   //       .attr('d', () => path(v))
  //   //       .style('stroke-width', () => Math.max(1, v.dy))
  //   //       .style('stroke', () => scaleColor(v.source.name.replace(' ', '')))
  //   //       .sort((a, b) => (b.dy - a.dy));
  //   //
  //   //   link.append('title').text(() => `${ v.source.name } â ${ v.target.name } \n ${ formatoNumero(v.value) }`);
  //   // });
  // };
  // const maxParent = (nodo) => {
  //   // console.log(nodo);
  //   let parentNode = nodesGlo.filter((element) => (element.id === nodo.parent))[0];
  //
  //   if (nodo.parent !== false) {
  //     if (typeof(parentNode) !== 'undefined' && parentNode.group === true) {
  //       return maxParent(nodesGlo.filter((element) => (element.id === nodo.parent))[0]);
  //     } else {
  //       return nodo;
  //     }
  //   } else {
  //     return nodo;
  //   }
  // };
  // const deleteEmptyNodes = () => {
  //   let del = 0,
  //       nodesDelete = [],
  //       status;
  //
  //   // moveId = 0;
  //
  //   nodesGlo.forEach((node, nodeI) => {
  //
  //     // console.log('nodo: ' + nodeI + ' ( id: ' + node.id + ')');
  //     status = false;
  //
  //     // Consulto si el nodo se utiliza en algun link
  //     linksGlo.forEach((link, linkI) => {
  //       if (node.id === link.source) {
  //         status = true;
  //         link.source = link.source - del;
  //       }
  //       if (node.id === link.target) {
  //         status = true;
  //         link.target = link.target - del;
  //       }
  //     });
  //
  //     // // Modificar el ID restando la cantidad de elementos borrados
  //     // node.id = node.id - del;
  //
  //     if (!status) {
  //       // console.log('Borrar');
  //       nodesDelete.push(nodeI);
  //       del++;
  //     }
  //     // else {
  //     //   // console.log('nodo: ' + nodeI + ' ( id: ' + node.id + ')<-');
  //     // }
  //   });
  //
  //   nodesDelete.reverse().forEach((node) => { nodesGlo.splice(node, 1); });
  //
  //   // moveId = del;
  //   // nodes.forEach((node, nodeI) => {
  //   //   console.log('nodo: ' + nodeI + ' ( id: ' + node.id + ')');
  //   // });
  //
  //   // console.log(links);
  //   return nodesGlo;
  // };
  // const declareGroupLinks = () => {
  //   let links = [],
  //       source, parentSource, stateSource,
  //       target, parentTarget, stateTarget,
  //       nodoExistente,
  //       addSource,
  //       addTarget,
  //       addValue;
  //
  //   linksGlo.forEach((v, k) => {
  //
  //     //Se obtiene source y target del elemento
  //     source = nodesGlo.filter((element) => (element.id === parseInt(v.source)))[0];
  //     target = nodesGlo.filter((element) => (element.id === parseInt(v.target)))[0];
  //     //Se guarda source-padre y target-padre
  //     parentSource = maxParent(source);
  //     parentTarget = maxParent(target);
  //     //Se guarda source-state y target-state
  //     stateSource = parentSource.group;
  //     stateTarget = parentTarget.group;
  //     //Se guarda source y link a crear
  //     addSource = (stateSource) ? (parentSource) : (source);
  //     addTarget = (stateTarget) ? (parentTarget) : (target);
  //     addValue  = parseInt(v.value);
  //     //Se consulta si el nodo existe
  //     nodoExistente = links.filter((element) => (element.source === addSource.id && element.target === addTarget.id));
  //
  //     if (nodoExistente.length !== 0) {
  //       //Se suma valor a duplicado
  //       nodoExistente[0].value += addValue;
  //     } else {
  //       //Se creo nuevo link
  //       links.push({
  //         'source': addSource.id,
  //         'target': addTarget.id,
  //         'value':  addValue
  //       });
  //     }
  //   });
  //   return links;
  // };
  // const preSankey = () => {
  //   linksGlo = $.extend(true, [], linksOri);
  //   nodesGlo = $.extend(true, [], nodesOri);
  //   linksGlo = declareGroupLinks();
  //   nodesGlo = deleteEmptyNodes();
  //
  //   dibujarSankey(width, height, { 'nodes': nodesGlo, 'links': linksGlo });
  // };

  var init = function init() {

    var downloadFile = function downloadFile() {
      console.log('Se solicitan archivos'); // Borrar

      var formatoSankey = function formatoSankey(elemento, data) {
        var processData = [];

        switch (elemento) {
          case 'nodos':
            data.forEach(function (v, k) {

              processData.push({
                'id': parseInt(v.id),
                'name': v.name,
                'parent': v.parent === 'null' ? false : parseInt(v.parent),
                'category': v.category,
                'pos': parseInt(v.position),
                'group': v.group === 'true' ? true : false,
                'imp': v.importation.split(';').map(function (element) {
                  return parseInt(element);
                }),
                'exp': v.exportation.split(';').map(function (element) {
                  return parseInt(element);
                }),
                'prod': v.production.split(';').map(function (element) {
                  return parseInt(element);
                })
              });
            });
            break;
          case 'links':
            data.forEach(function (v, k) {
              processData.push({
                'source': parseInt(v.source),
                'target': parseInt(v.target),
                'value': parseInt(v.value)
              });
            });
            break;
        }

        return processData;
      };

      var promise = new Promise(function (success) {
        d3.json('public/src/nodes.json', function (nodos) {
          nodesOri = nodos;

          d3.json('public/src/links.json', function (links) {
            linksOri = links;

            success();
          });
        });

        // d3.csv('public/src/nodes.csv',
        //   (nodos) => {
        //     nodesOri = formatoSankey('nodos', nodos);
        //
        //     d3.csv('public/src/links.csv',
        //       (links) => {
        //         linksOri = formatoSankey('links', links);
        //
        //         success();
        //       }
        //     );
        //   }
        // );
      });

      return promise;
    };

    downloadFile().then(function () {
      dibujarSankey(width, height, { 'nodes': nodesOri, 'links': linksOri });
      intro();
      // preSankey();
    });
  };

  init();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJjb2xvcmVzIiwic3VidHJhY3RMaWdodCIsImNvbG9yIiwiYW1vdW50IiwiY2MiLCJwYXJzZUludCIsImMiLCJ0b1N0cmluZyIsImxlbmd0aCIsImRhcmtlbiIsImluZGV4T2YiLCJzdWJzdHJpbmciLCIkIiwiaGVpZ2h0Iiwid2lkdGgiLCJub2Rlc09yaSIsImxpbmtzT3JpIiwibm9kZXNHbG8iLCJsaW5rc0dsbyIsInNhbmtleUNoYXJ0RDMiLCJwYXRoIiwic3ZnIiwiY3JlYXRlR3JhZmljbyIsImRhdGEiLCJjb250YWluZXIiLCJtYXJnaW4iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJzaXplIiwieWVhcnMiLCJuZXdEYXRhIiwiZm9yRWFjaCIsInYiLCJrIiwicHVzaCIsImRhdGUiLCJEYXRlIiwidmFsdWUiLCJzdmdHcmFmaWNvIiwiaHRtbCIsImFwcGVuZCIsImF0dHIiLCJ4IiwiZDMiLCJzY2FsZVRpbWUiLCJkb21haW4iLCJleHRlbnQiLCJkIiwicmFuZ2VSb3VuZCIsInkiLCJzY2FsZUxpbmVhciIsImxpbmUiLCJjYWxsIiwiYXhpc0JvdHRvbSIsInN0eWxlIiwiYXhpc0xlZnQiLCJkYXR1bSIsImZhZGVJbiIsImlkIiwiZyIsImkiLCJhbGxfbGlua3MiLCJzZWxlY3RBbGwiLCJhbGxfbm9kZXMiLCJub2Rlc19pZCIsImVsZW1lbnRfaWQiLCJjb25zb2xlIiwibG9nIiwiZXZlbnRfbm9kZSIsImZpbHRlciIsInNlbGVjdCIsInRyYW5zaXRpb24iLCJmaWx0ZXJfbm9kZXMiLCJzdGF0ZSIsImVsZW1lbnQiLCJmaWx0ZXJfbGlua3MiLCJzb3VyY2UiLCJ0YXJnZXQiLCJ0b29sdGlwSW4iLCJjc3MiLCJldmVudCIsImxheWVyWSIsImxheWVyWCIsInRleHQiLCJuYW1lIiwicHJvZHVjdGlvbiIsImxvc3NlcyIsImZhZGVPdXQiLCJvcGFjaXR5IiwicmVtb3ZlQXR0ciIsImludHJvIiwiZGlidWphclNhbmtleSIsImhlaWd0aCIsImVtcHR5IiwiaGVhZGVyIiwiaGVhZGVyU2l6ZSIsInNlY2Npb25lcyIsImFuY2hvTm9kbyIsInNlcGFyYWNpb25Ob2RvIiwicG9zQ29sdW1uYXMiLCJlbmNhYmV6YWRvIiwiY2hhcnQiLCJnZXRCQm94Iiwic2Fua2V5Iiwibm9kZVdpZHRoIiwibm9kZVBhZGRpbmciLCJub2RlcyIsImxpbmtzIiwibGF5b3V0IiwibGluayIsImVudGVyIiwiTWF0aCIsIm1heCIsImR5Iiwic29ydCIsImEiLCJiIiwibm9kZSIsIm9uIiwidGFyZ2V0TGlua3MiLCJpbml0IiwiZG93bmxvYWRGaWxlIiwiZm9ybWF0b1NhbmtleSIsImVsZW1lbnRvIiwicHJvY2Vzc0RhdGEiLCJwYXJlbnQiLCJjYXRlZ29yeSIsInBvc2l0aW9uIiwiZ3JvdXAiLCJpbXBvcnRhdGlvbiIsInNwbGl0IiwibWFwIiwiZXhwb3J0YXRpb24iLCJwcm9taXNlIiwiUHJvbWlzZSIsInN1Y2Nlc3MiLCJqc29uIiwibm9kb3MiLCJ0aGVuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0EsSUFBTUEsVUFBVSxDQUNkLFNBRGMsRUFFZCxTQUZjLEVBR2QsU0FIYyxDQUFoQjs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFNQyxnQkFBZ0IsU0FBaEJBLGFBQWdCLENBQVNDLEtBQVQsRUFBZ0JDLE1BQWhCLEVBQXVCO0FBQzNDLE1BQUlDLEtBQUtDLFNBQVNILEtBQVQsRUFBZSxFQUFmLElBQXFCQyxNQUE5QjtBQUNBLE1BQUlHLElBQUtGLEtBQUssQ0FBTixHQUFXLENBQVgsR0FBZ0JBLEVBQXhCO0FBQ0FFLE1BQUtBLEVBQUVDLFFBQUYsQ0FBVyxFQUFYLEVBQWVDLE1BQWYsR0FBd0IsQ0FBekIsR0FBK0JGLEVBQUVDLFFBQUYsQ0FBVyxFQUFYLENBQS9CLFNBQW9ERCxFQUFFQyxRQUFGLENBQVcsRUFBWCxDQUF4RDs7QUFFQSxTQUFPRCxDQUFQO0FBQ0QsQ0FORDs7QUFRQTtBQUNBLElBQU1H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SVFuRCxDQUpSO0FBS0QsS0FORDs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRCxHQWhLRDs7QUFrS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTXdGLE9BQU8sU0FBUEEsSUFBTyxHQUFNOztBQUVqQixRQUFNQyxlQUFlLFNBQWZBLFlBQWUsR0FBTTtBQUN6QnZELGNBQVFDLEdBQVIsQ0FBWSx1QkFBWixFQUR5QixDQUNhOztBQUV0QyxVQUFNdUQsZ0JBQW9CLFNBQXBCQSxhQUFvQixDQUFDQyxRQUFELEVBQVd0RyxJQUFYLEVBQW9CO0FBQzVDLFlBQUl1RyxjQUFjLEVBQWxCOztBQUVBLGdCQUFRRCxRQUFSO0FBQ0UsZUFBSyxPQUFMO0FBQ0V0RyxpQkFBS1UsT0FBTCxDQUFhLFVBQUNDLENBQUQsRUFBSUMsQ0FBSixFQUFVOztBQUVyQjJGLDBCQUFZMUYsSUFBWixDQUFpQjtBQUNmLHNCQUFZL0IsU0FBUzZCLEVBQUUwQixFQUFYLENBREc7QUFFZix3QkFBWTFCLEVBQUVvRCxJQUZDO0FBR2YsMEJBQWFwRCxFQUFFNkYsTUFBRixLQUFhLE1BQWQsR0FBdUIsS0FBdkIsR0FBK0IxSCxTQUFTNkIsRUFBRTZGLE1BQVgsQ0FINUI7QUFJZiw0QkFBWTdGLEVBQUU4RixRQUpDO0FBS2YsdUJBQVkzSCxTQUFTNkIsRUFBRStGLFFBQVgsQ0FMRztBQU1mLHlCQUFhL0YsRUFBRWdHLEtBQUYsS0FBWSxNQUFiLEdBQXNCLElBQXRCLEdBQTZCLEtBTjFCO0FBT2YsdUJBQVloRyxFQUFFaUcsV0FBRixDQUFjQyxLQUFkLENBQW9CLEdBQXBCLEVBQXlCQyxHQUF6QixDQUE2QixVQUFDekQsT0FBRDtBQUFBLHlCQUFjdkUsU0FBU3VFLE9BQVQsQ0FBZDtBQUFBLGlCQUE3QixDQVBHO0FBUWYsdUJBQVkxQyxFQUFFb0csV0FBRixDQUFjRixLQUFkLENBQW9CLEdBQXBCLEVBQXlCQyxHQUF6QixDQUE2QixVQUFDekQsT0FBRDtBQUFBLHlCQUFjdkUsU0FBU3VFLE9BQVQsQ0FBZDtBQUFBLGlCQUE3QixDQVJHO0FBU2Ysd0JBQVkxQyxFQUFFcUQsVUFBRixDQUFhNkMsS0FBYixDQUFtQixHQUFuQixFQUF3QkMsR0FBeEIsQ0FBNEIsVUFBQ3pELE9BQUQ7QUFBQSx5QkFBY3ZFLFNBQVN1RSxPQUFULENBQWQ7QUFBQSxpQkFBNUI7QUFURyxlQUFqQjtBQVdELGFBYkQ7QUFjQTtBQUNGLGVBQUssT0FBTDtBQUNFckQsaUJBQUtVLE9BQUwsQ0FBYSxVQUFDQyxDQUFELEVBQUlDLENBQUosRUFBVTtBQUNyQjJGLDBCQUFZMUYsSUFBWixDQUFpQjtBQUNmLDBCQUFVL0IsU0FBUzZCLEVBQUU0QyxNQUFYLENBREs7QUFFZiwwQkFBVXpFLFNBQVM2QixFQUFFNkMsTUFBWCxDQUZLO0FBR2YseUJBQVUxRSxTQUFTNkIsRUFBRUssS0FBWDtBQUhLLGVBQWpCO0FBS0QsYUFORDtBQU9BO0FBekJKOztBQTRCQSxlQUFPdUYsV0FBUDtBQUNELE9BaENEOztBQWtDQSxVQUFJUyxVQUFVLElBQUlDLE9BQUosQ0FBWSxVQUFDQyxPQUFELEVBQWE7QUFDckM1RixXQUFHNkYsSUFBSCxDQUFRLHVCQUFSLEVBQWlDLFVBQUNDLEtBQUQsRUFBVztBQUMxQzVILHFCQUFXNEgsS0FBWDs7QUFFQTlGLGFBQUc2RixJQUFILENBQVEsdUJBQVIsRUFDRSxVQUFDN0IsS0FBRCxFQUFXO0FBQ1Q3Rix1QkFBVzZGLEtBQVg7O0FBRUE0QjtBQUNELFdBTEg7QUFPRCxTQVZEOztBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0QsT0ExQmEsQ0FBZDs7QUE0QkEsYUFBT0YsT0FBUDtBQUNELEtBbEVEOztBQW9FQVosbUJBQWVpQixJQUFmLENBQW9CLFlBQU07QUFDeEIvQyxvQkFBYy9FLEtBQWQsRUFBcUJELE1BQXJCLEVBQTZCLEVBQUUsU0FBU0UsUUFBWCxFQUFxQixTQUFTQyxRQUE5QixFQUE3QjtBQUNBNEU7QUFDQTtBQUNELEtBSkQ7QUFLRCxHQTNFRDs7QUE2RUo4QjtBQUNELENBdHBCRCIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWQVJJQUJMRVMgR0xPQkFMRVNcbmNvbnN0IGNvbG9yZXMgPSBbXG4gICcjMDA3NUM5JyxcbiAgJyMwMDlEREEnLFxuICAnIzAwQjVFNCdcbl07XG5cbi8vICBGdW5jaW9uZXNcbi8vIGNvbnN0IGZvcm1hdG9OdW1lcm8gPSAoZCkgPT4ge1xuLy8gICBsZXQgZm9ybWF0ID0gZDMuZm9ybWF0KCcsLjBmJyk7XG4vL1xuLy8gICByZXR1cm4gYCR7IGZvcm1hdChkKSB9IFR3aGA7XG4vLyB9O1xuXG4vKiBSZXN0YSBlbCBwb3JjZW50YWplIGluZGljYWRvIGEgdW4gY29sb3IgKFJSLCBHRyBvIEJCKSBoZXhhZGVjaW1hbCBwYXJhIG9zY3VyZWNlcmxvICovXG5jb25zdCBzdWJ0cmFjdExpZ2h0ID0gZnVuY3Rpb24oY29sb3IsIGFtb3VudCl7XG4gIGxldCBjYyA9IHBhcnNlSW50KGNvbG9yLDE2KSAtIGFtb3VudDtcbiAgbGV0IGMgPSAoY2MgPCAwKSA/IDAgOiAoY2MpO1xuICBjID0gKGMudG9TdHJpbmcoMTYpLmxlbmd0aCA+IDEgKSA/IGMudG9TdHJpbmcoMTYpIDogYDAke2MudG9TdHJpbmcoMTYpfWA7XG5cbiAgcmV0dXJuIGM7XG59O1xuXG4vKiBPc2N1cmVjZSB1biBjb2xvciBoZXhhZGVjaW1hbCBkZSA2IGNhcmFjdGVyZXMgI1JSR0dCQiBzZWd1biBlbCBwb3JjZW50YWplIGluZGljYWRvICovXG5jb25zdCBkYXJrZW4gPSAoY29sb3IsIGFtb3VudCkgPT57XG4gIGNvbG9yID0gKGNvbG9yLmluZGV4T2YoJyMnKT49MCkgPyBjb2xvci5zdWJzdHJpbmcoMSxjb2xvci5sZW5ndGgpIDogY29sb3I7XG4gIGFtb3VudCA9IHBhcnNlSW50KCgyNTUqYW1vdW50KS8xMDApO1xuICBjb2xvciA9IGAjJHtzdWJ0cmFjdExpZ2h0KGNvbG9yLnN1YnN0cmluZygwLDIpLCBhbW91bnQpfSR7c3VidHJhY3RMaWdodChjb2xvci5zdWJzdHJpbmcoMiw0KSwgYW1vdW50KX0ke3N1YnRyYWN0TGlnaHQoY29sb3Iuc3Vic3RyaW5nKDQsNiksIGFtb3VudCl9YDtcblxuICByZXR1cm4gY29sb3I7XG59O1xuXG4kKCgpID0+IHtcblxuICBsZXQgaGVpZ2h0ICAgICAgPSAkKCcjc2Fua2V5JykuaGVpZ2h0KCksXG4gICAgICB3aWR0aCAgICAgICA9ICQoJyNzYW5rZXknKS53aWR0aCgpLFxuICAgICAgLy8gY2xhdmVzTm9kb3MgPSBbXSxcbiAgICAgIC8vIGRhdGFTYW5rZXkgID0ge30sXG4gICAgICAvLyBtb3ZlSWQgPSAwLFxuICAgICAgbm9kZXNPcmksIGxpbmtzT3JpLFxuICAgICAgbm9kZXNHbG8sIGxpbmtzR2xvLFxuICAgICAgc2Fua2V5Q2hhcnREMywgcGF0aCwgc3ZnO1xuXG4gIC8vICBGdW5jaW9uZXNcbiAgICAgIC8vIGNvbnN0IGdlbmVyYXJQdWVydGFzICAgID0gKCkgPT4ge1xuICAgICAgLy8gICBkYXRhU2Fua2V5Lm5vZGVzLmZpbHRlcigoZWxlbWVudCkgPT4gKGVsZW1lbnQucGFyZW50ID09PSBmYWxzZSkpLmZvckVhY2goKHYsIGspID0+IHtcbiAgICAgIC8vICAgICBjbGF2ZXNOb2Rvcy5wdXNoKHsgJ2lkJzogdi5pZCwgJ3N0YXRlJzogdHJ1ZSB9KTtcbiAgICAgIC8vICAgfSk7XG4gICAgICAvLyB9O1xuICAgICAgY29uc3QgY3JlYXRlR3JhZmljbyA9IChkYXRhLCBjb250YWluZXIpID0+IHtcbiAgICAgICAgLy8gVmFyaWFibGVzXG4gICAgICAgIGxldCBtYXJnaW4gPSB7IHRvcDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMCwgbGVmdDogMCB9O1xuICAgICAgICBsZXQgc2l6ZSA9IHsgd2lkdGg6ICgzMDAgLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodCksIGhlaWdodDogKDUwIC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20pIH07XG4gICAgICAgIGxldCB5ZWFycyA9IFsnMjAxMicsICcyMDEzJywgJzIwMTQnLCAnMjAxNScsICcyMDE2JywgJzIwMTcnXTtcbiAgICAgICAgbGV0IG5ld0RhdGEgPSBbXTtcblxuICAgICAgICBkYXRhLmZvckVhY2goKHYsIGspID0+IHsgbmV3RGF0YS5wdXNoKHsgZGF0ZTogbmV3IERhdGUoeWVhcnNba10pLCB2YWx1ZTogdiB9KTsgfSk7XG5cbiAgICAgICAgbGV0IHN2Z0dyYWZpY28gPSBjb250YWluZXIuaHRtbCgnJykuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHNpemUud2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcbiAgICAgICAgICAuYXR0cignaGVpZ2h0Jywgc2l6ZS5oZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcbiAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sICR7IG1hcmdpbi50b3AgfSlgKTtcblxuICAgICAgICAvLyBsZXQgcGFyc2VUaW1lID0gZDMudGltZVBhcnNlKCclZC0lYi0leScpO1xuXG4gICAgICAgIGxldCB4ID0gZDMuc2NhbGVUaW1lKClcbiAgICAgICAgICAuZG9tYWluKGQzLmV4dGVudChuZXdEYXRhLCAoZCkgPT4gZC5kYXRlKSlcbiAgICAgICAgICAucmFuZ2VSb3VuZChbMCwgc2l6ZS53aWR0aF0pO1xuICAgICAgICBsZXQgeSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAgICAgICAuZG9tYWluKGQzLmV4dGVudChuZXdEYXRhLCAoZCkgPT4gZC52YWx1ZSkpXG4gICAgICAgICAgLnJhbmdlUm91bmQoW3NpemUuaGVpZ2h0LCAwXSk7XG5cblxuICAgICAgICBsZXQgbGluZSA9IGQzLmxpbmUoKS54KChkKSA9PiB4KGQuZGF0ZSkpLnkoKGQpID0+IHkoZC52YWx1ZSkpO1xuXG4gICAgICAgIHN2Z0dyYWZpY28uYXBwZW5kKCdnJylcbiAgICAgICAgICAuY2FsbChkMy5heGlzQm90dG9tKHgpKVxuICAgICAgICAgIC5zdHlsZSgndHJhbnNmb3JtJywgYHRyYW5zbGF0ZSgwcHgsICR7IHNpemUuaGVpZ2h0IC0gMSB9cHgpYCk7XG5cbiAgICAgICAgc3ZnR3JhZmljby5hcHBlbmQoJ2cnKVxuICAgICAgICAgIC5jYWxsKGQzLmF4aXNMZWZ0KHkpKTtcbiAgICAgICAgLy8gLmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC8vICAgLmF0dHIoJ2ZpbGwnLCAnIzAwMCcpXG4gICAgICAgIC8vICAgLmF0dHIoJ3RyYW5zZm9ybScsICdyb3RhdGUoLTkwKScpXG4gICAgICAgIC8vICAgLmF0dHIoJ3knLCA2KVxuICAgICAgICAvLyAgIC5hdHRyKCdkeScsICcwLjcxZW0nKVxuICAgICAgICAvLyAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdlbmQnKVxuICAgICAgICAvLyAgIC50ZXh0KCdQcmljZSAoJCknKTtcblxuICAgICAgICBzdmdHcmFmaWNvLmFwcGVuZCgncGF0aCcpXG4gICAgICAgICAgLmRhdHVtKG5ld0RhdGEpXG4gICAgICAgICAgLmF0dHIoJ2ZpbGwnLCAnbm9uZScpXG4gICAgICAgICAgLmF0dHIoJ3N0cm9rZScsICdzdGVlbGJsdWUnKVxuICAgICAgICAgIC5hdHRyKCdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKVxuICAgICAgICAgIC5hdHRyKCdzdHJva2UtbGluZWNhcCcsICdyb3VuZCcpXG4gICAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDEuNSlcbiAgICAgICAgICAuYXR0cignZCcsIGxpbmUpO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgZmFkZUluID0gKGlkID0gbnVsbCkgPT4gKGcsIGkpID0+IHtcbiAgICAgICAgbGV0IGFsbF9saW5rcyA9IGQzLnNlbGVjdEFsbCgnI3NhbmtleSAubGluaycpLFxuICAgICAgICAgICAgYWxsX25vZGVzID0gZDMuc2VsZWN0QWxsKCcjc2Fua2V5IC5ub2RlJyksXG4gICAgICAgICAgICBub2Rlc19pZCAgPSBbXSxcbiAgICAgICAgICAgIGVsZW1lbnRfaWQgPSAoaWQgPT09IG51bGwpPyhnLmlkKTooaWQpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGVsZW1lbnRfaWQpO1xuXG4gICAgICAgIGxldCBldmVudF9ub2RlID0gYWxsX25vZGVzLmZpbHRlcigoZCkgPT4gKGQuaWQgPT09IGVsZW1lbnRfaWQpKTtcbiAgICAgICAgZXZlbnRfbm9kZS5zZWxlY3QoJ3JlY3QnKVxuICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnYmxhY2snKVxuICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgJ2JsYWNrJyk7XG4gICAgICAgIGV2ZW50X25vZGUuc2VsZWN0KCd0ZXh0JylcbiAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgLnN0eWxlKCdmaWxsJywgJ2JsYWNrJyk7XG5cbiAgICAgICAgbGV0IGZpbHRlcl9ub2RlcyA9IGFsbF9ub2Rlcy5maWx0ZXIoKGQpID0+IHtcbiAgICAgICAgICBsZXQgc3RhdGUgPSBmYWxzZTtcblxuICAgICAgICAgIG5vZGVzX2lkLmZvckVhY2goKGVsZW1lbnQpID0+IHsgaWYoZC5pZCA9PT0gZWxlbWVudCkgeyBzdGF0ZSA9IHRydWU7IH0gfSk7XG5cbiAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH0pO1xuICAgICAgICBmaWx0ZXJfbm9kZXMuc2VsZWN0KCdyZWN0JylcbiAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgLnN0eWxlKCdmaWxsJywgJ2JsYWNrJylcbiAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICdibGFjaycpO1xuICAgICAgICBmaWx0ZXJfbm9kZXMuc2VsZWN0KCd0ZXh0JylcbiAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgLnN0eWxlKCdmaWxsJywgJ2JsYWNrJyk7XG5cbiAgICAgICAgbGV0IGZpbHRlcl9saW5rcyA9IGFsbF9saW5rcy5maWx0ZXIoKGQpID0+IHtcbiAgICAgICAgICBsZXQgc3RhdGUgPSB0cnVlO1xuXG4gICAgICAgICAgaWYgKGQuc291cmNlLmlkID09PSBlbGVtZW50X2lkKSB7XG4gICAgICAgICAgICBub2Rlc19pZC5wdXNoKGQudGFyZ2V0LmlkKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGQudGFyZ2V0LmlkID09PSBlbGVtZW50X2lkKSB7XG4gICAgICAgICAgICBub2Rlc19pZC5wdXNoKGQuc291cmNlLmlkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhdGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH0pO1xuICAgICAgICBmaWx0ZXJfbGlua3MudHJhbnNpdGlvbigpXG4gICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnIzAwNzVDOScpXG4gICAgICAgICAgLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIDAuNSk7XG4gICAgICB9O1xuICAgICAgY29uc3QgdG9vbHRpcEluID0gKGQpID0+IHtcbiAgICAgICAgJCgnI3Rvb2x0aXAnKS5jc3MoeyB0b3A6IGV2ZW50LmxheWVyWSArIDIwLCBsZWZ0OiBldmVudC5sYXllclggKyAyMCB9KTtcbiAgICAgICAgJCgnLnRvb2x0aXBfbmFtZScpLnRleHQoZC5uYW1lKTtcbiAgICAgICAgJCgnLnRvb2x0aXBfcHJvZHVjdGlvbicpLnRleHQoYFByb2R1Y2Npw7NuOiAkeyBkLnByb2R1Y3Rpb24gfWApO1xuICAgICAgICAkKCcudG9vbHRpcF9sb3NzZXMnKS50ZXh0KGBQw6lyZGlkYTogJHsgZC5sb3NzZXMgfWApO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGZhZGVPdXQgPSAob3BhY2l0eSkgPT4gKGcsIGkpID0+IHtcbiAgICAgICAgbGV0IGFsbF9saW5rcyA9IGQzLnNlbGVjdEFsbCgnI3NhbmtleSAubGluaycpLFxuICAgICAgICAgICAgYWxsX25vZGVzID0gZDMuc2VsZWN0QWxsKCcjc2Fua2V5IC5ub2RlJyksXG4gICAgICAgICAgICBub2Rlc19pZCAgPSBbXTtcblxuICAgICAgICBsZXQgZXZlbnRfbm9kZSA9IGFsbF9ub2Rlcy5maWx0ZXIoKGQpID0+IChkLmlkID09PSBnLmlkKSk7XG4gICAgICAgIGV2ZW50X25vZGUuc2VsZWN0KCdyZWN0JylcbiAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgLnN0eWxlKCdmaWxsJywgbnVsbClcbiAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIG51bGwpO1xuICAgICAgICBldmVudF9ub2RlLnNlbGVjdCgndGV4dCcpXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIG51bGwpO1xuXG4gICAgICAgIGxldCBmaWx0ZXJfbm9kZXMgPSBhbGxfbm9kZXMuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgICAgbGV0IHN0YXRlID0gZmFsc2U7XG5cbiAgICAgICAgICBub2Rlc19pZC5mb3JFYWNoKChlbGVtZW50KSA9PiB7IGlmKGQuaWQgPT09IGVsZW1lbnQpIHsgc3RhdGUgPSB0cnVlOyB9IH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgZmlsdGVyX25vZGVzLnNlbGVjdCgncmVjdCcpXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIG51bGwpXG4gICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBudWxsKTtcbiAgICAgICAgZmlsdGVyX25vZGVzLnNlbGVjdCgndGV4dCcpXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIG51bGwpO1xuXG4gICAgICAgIGxldCBmaWx0ZXJfbGlua3MgPSBhbGxfbGlua3MuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgICAgbGV0IHN0YXRlID0gdHJ1ZTtcblxuICAgICAgICAgIGlmIChkLnNvdXJjZS5pZCA9PT0gZy5pZCkge1xuICAgICAgICAgICAgbm9kZXNfaWQucHVzaChkLnRhcmdldC5pZCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChkLnRhcmdldC5pZCA9PT0gZy5pZCkge1xuICAgICAgICAgICAgbm9kZXNfaWQucHVzaChkLnNvdXJjZS5pZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXRlID0gZmFsc2U7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgZmlsdGVyX2xpbmtzLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgbnVsbClcbiAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgbnVsbCk7XG5cbiAgICAgICAgJCgnI3Rvb2x0aXAnKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgaW50cm8gPSAoKSA9PiB7XG4gICAgICAgIChmYWRlSW4oMikpKCk7XG4gICAgICAgIChmYWRlSW4oMjcpKSgpO1xuICAgICAgICAoZmFkZUluKDEzKSkoKTtcbiAgICAgICAgKGZhZGVJbigyNikpKCk7XG4gICAgICAgIChmYWRlSW4oMTIpKSgpO1xuICAgICAgICAoZmFkZUluKDMxKSkoKTtcbiAgICAgIH07XG4gICAgICAvLyBjb25zdCBjb2xhcHNhckV4cGFuZGlyTm9kbyA9IChub2RvKSA9PiB7XG4gICAgICAvL1xuICAgICAgLy8gICBub2Rlc09yaVtub2RvLmlkXS5ncm91cCA9IChub2Rlc09yaVtub2RvLmlkXS5ncm91cCkgPyAoZmFsc2UpIDogKHRydWUpO1xuICAgICAgLy9cbiAgICAgIC8vICAgcmV0dXJuIG5vZGVzT3JpO1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIGxldCBvbGRMaW5rcyA9IGRhdGFTYW5rZXkubGlua3M7XG4gICAgICAvL1xuICAgICAgLy8gICAvLyBpZiAobm9kby5wYXJlbnQgPT09IGZhbHNlKSB7XG4gICAgICAvLyAgIC8vICAgY29uc29sZS5sb2coJ1NlIGV4cGFuZGUgbm9kbycpO1xuICAgICAgLy8gICAvLyAgIGNsYXZlc05vZG9zLmZvckVhY2goKGVsZW1lbnQpID0+IHsgaWYgKGVsZW1lbnQuaWQgPT09IG5vZG8uaWQgKyBtb3ZlSWQpIHsgZWxlbWVudC5zdGF0ZSA9IGZhbHNlOyB9IH0pO1xuICAgICAgLy8gICAvL1xuICAgICAgLy8gICAvLyAgIGRhdGFTYW5rZXkubm9kZXMgPSBub2Rvc09yaWdpbmFsZXM7XG4gICAgICAvLyAgIC8vICAgZGF0YVNhbmtleS5saW5rcyA9IGxpbmtzT3JpZ2luYWxlcztcbiAgICAgIC8vICAgLy9cbiAgICAgIC8vICAgLy8gICBkYXRhU2Fua2V5LmxpbmtzID0gZGVjbGFyZUdyb3VwTGlua3MoZGF0YVNhbmtleS5saW5rcywgdHJ1ZSk7XG4gICAgICAvLyAgIC8vXG4gICAgICAvLyAgIC8vICAgZGF0YVNhbmtleSA9IGJ1c2Nhck5vZGVzKGRhdGFTYW5rZXkubm9kZXMsIGRhdGFTYW5rZXkubGlua3MpO1xuICAgICAgLy8gICAvLyAgIG1vdmVJZCA9IDA7XG4gICAgICAvLyAgIC8vICAgJCgnI3NhbmtleScpLmVtcHR5KCk7XG4gICAgICAvLyAgIC8vICAgZGlidWphclNhbmtleSh3aWR0aCwgaGVpZ2h0LCBkYXRhU2Fua2V5KTtcbiAgICAgIC8vICAgLy8gICAvLyBhY3R1YWxpemFyU2Fua2V5KCQoJyNjb250ZW50Jykud2lkdGgoKSwgJCgnI2NvbnRlbnQnKS5oZWlnaHQoKSwgZGF0YVNhbmtleSwgb2xkTGlua3MpO1xuICAgICAgLy8gICAvLyB9IGVsc2Uge1xuICAgICAgLy8gICAvLyAgIGNvbnNvbGUubG9nKCdTZSBjb2xhcHNhIG5vZG8nKTtcbiAgICAgIC8vICAgLy8gICAvLyBsZXQgcGFyZW50ID0gZGF0YVNhbmtleS5ub2Rlcy5maWx0ZXIoKGVsZW1lbnQpID0+IChlbGVtZW50Lm5hbWUgPT09IG5vZG8ucGFyZW50KSlbMF07XG4gICAgICAvLyAgIC8vICAgLy8gY2xhdmVzTm9kb3MuZmlsdGVyKChlbGVtZW50KSA9PiAoZWxlbWVudC5pZCA9PT0gcGFyZW50LmlkKSlbMF0uc3RhdGUgPSB0cnVlO1xuICAgICAgLy8gICAvLyAgIC8vXG4gICAgICAvLyAgIC8vICAgLy8gZGF0YVNhbmtleSA9IGJ1c2Nhck5vZGVzKG5vZG9zT3JpZ2luYWxlcywgZGF0YVNhbmtleS5saW5rcyA9IGRlY2xhcmVHcm91cExpbmtzKGxpbmtzT3JpZ2luYWxlcykpO1xuICAgICAgLy8gICAvLyAgIC8vXG4gICAgICAvLyAgIC8vICAgLy8gJCgnI3NhbmtleScpLmVtcHR5KCk7XG4gICAgICAvLyAgIC8vICAgLy8gZGlidWphclNhbmtleSh3aWR0aCwgaGVpZ2h0LCBkYXRhU2Fua2V5KTtcbiAgICAgIC8vICAgLy8gICAvLyBhY3R1YWxpemFyU2Fua2V5KCQoJyNjb250ZW50Jykud2lkdGgoKSwgJCgnI2NvbnRlbnQnKS5oZWlnaHQoKSwgZGF0YVNhbmtleSwgb2xkTGlua3MpO1xuICAgICAgLy8gICAvLyB9XG4gICAgICAvLyB9O1xuXG4gICAgICBjb25zdCBkaWJ1amFyU2Fua2V5ID0gKHdpZHRoLCBoZWlndGgsIGRhdGEpID0+IHtcblxuICAgICAgICAvLyBTZSB2YWNpYSBjb250ZW5lZG9yXG4gICAgICAgICQoJyNzYW5rZXknKS5lbXB0eSgpO1xuXG4gICAgICAgIC8vIFNlIGRlZmluZW4gdmFyaWFibGVzXG4gICAgICAgIGxldCBtYXJnaW4gPSB7XG4gICAgICAgICAgdG9wOiA0MCxcbiAgICAgICAgICByaWdodDogMjAwLFxuICAgICAgICAgIGJvdHRvbTogNDAsXG4gICAgICAgICAgbGVmdDogMjAwLFxuICAgICAgICAgIGhlYWRlcjogMjBcbiAgICAgICAgfSxcbiAgICAgICAgaGVhZGVyU2l6ZSA9IDE5LFxuICAgICAgICBzaXplID0ge1xuICAgICAgICAgIHdpZHRoOiAoKCh3aWR0aCA8IDE0MDApPyh3aWR0aCk6KDE0MDApKSAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0KSxcbiAgICAgICAgICBoZWlnaHQ6IChoZWlndGggLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSAtIG1hcmdpbi5oZWFkZXIgLSBoZWFkZXJTaXplKVxuICAgICAgICB9LFxuICAgICAgICBzZWNjaW9uZXMgPSBbXG4gICAgICAgICAgJ0NPTCAwMScsXG4gICAgICAgICAgJ0NPTCAwMicsXG4gICAgICAgICAgJ0NPTCAwMycsXG4gICAgICAgICAgJ0NPTCAwNCcsXG4gICAgICAgICAgJ0NPTCAwNScsXG4gICAgICAgICAgJ0NPTCAwNicsXG4gICAgICAgIF0sXG4gICAgICAgIGFuY2hvTm9kbyA9IDIwLFxuICAgICAgICBzZXBhcmFjaW9uTm9kbyA9IDIwLFxuICAgICAgICBwb3NDb2x1bW5hcyA9IFtdO1xuXG4gICAgICAgIC8vIENyZWFjacOzbiBTVkdcbiAgICAgICAgc3ZnID0gZDMuc2VsZWN0KCcjc2Fua2V5JylcbiAgICAgICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHNpemUud2lkdGggKyBtYXJnaW4ucmlnaHQgKyBtYXJnaW4ubGVmdClcbiAgICAgICAgICAuYXR0cignaGVpZ2h0Jywgc2l6ZS5oZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSArIG1hcmdpbi5oZWFkZXIgKyBoZWFkZXJTaXplKTtcblxuICAgICAgICAvLyBCb3JyYXJcbiAgICAgICAgLy8gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgIC8vICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHsgMCB9LCAkeyAwIH0pYClcbiAgICAgICAgLy8gICAuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLy8gICAuYXR0cignd2lkdGgnLCBgJHsgc2l6ZS53aWR0aCArIG1hcmdpbi5yaWdodCArIG1hcmdpbi5sZWZ0IH1weGApXG4gICAgICAgIC8vICAgLmF0dHIoJ2hlaWdodCcsIGAkeyBtYXJnaW4udG9wIH1weGApXG4gICAgICAgIC8vICAgLnN0eWxlKCdmaWxsJywgJ3NpbHZlcicpO1xuICAgICAgICAvLyBCb3JyYXJcbiAgICAgICAgLy8gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgIC8vICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHsgMCB9LCAkeyBoZWlnaHQgLSBtYXJnaW4uYm90dG9tIH0pYClcbiAgICAgICAgLy8gICAuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLy8gICAuYXR0cignd2lkdGgnLCBgJHsgc2l6ZS53aWR0aCArIG1hcmdpbi5yaWdodCArIG1hcmdpbi5sZWZ0IH1weGApXG4gICAgICAgIC8vICAgLmF0dHIoJ2hlaWdodCcsIGAkeyBtYXJnaW4udG9wIH1weGApXG4gICAgICAgIC8vICAgLnN0eWxlKCdmaWxsJywgJ3NpbHZlcicpO1xuICAgICAgICAvLyBCb3JyYXJcbiAgICAgICAgLy8gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgIC8vICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHsgMCB9LCAkeyBtYXJnaW4udG9wICsgaGVhZGVyU2l6ZSB9KWApXG4gICAgICAgIC8vICAgLmFwcGVuZCgncmVjdCcpXG4gICAgICAgIC8vICAgLmF0dHIoJ3dpZHRoJywgYCR7IHNpemUud2lkdGggKyBtYXJnaW4ucmlnaHQgKyBtYXJnaW4ubGVmdCB9cHhgKVxuICAgICAgICAvLyAgIC5hdHRyKCdoZWlnaHQnLCBgJHsgbWFyZ2luLmhlYWRlciB9cHhgKVxuICAgICAgICAvLyAgIC5zdHlsZSgnZmlsbCcsICdzaWx2ZXInKTtcblxuICAgICAgICAvLyBTZSBhZ3JlZ2FuIGVuY2FiZXphZG9zXG4gICAgICAgIGxldCBlbmNhYmV6YWRvID0gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgICAgLmF0dHIoJ2lkJywgJ2NoYXJ0LWVuY2FiZXphZG8nKVxuICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sICR7IG1hcmdpbi50b3AgKyAxNSB9KWApO1xuICAgICAgICBlbmNhYmV6YWRvLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NoYXJ0LWVuY2FiZXphZG8tbGVmdCcpXG4gICAgICAgICAgLmF0dHIoJ3gnLCAtMTApXG4gICAgICAgICAgLnRleHQoc2VjY2lvbmVzWzBdKTtcblxuICAgICAgICAvLyBTZSBjcmVhIGdyYWZpY29cbiAgICAgICAgbGV0IGNoYXJ0ID0gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHsgbWFyZ2luLmxlZnQgfSwgJHsgbWFyZ2luLnRvcCArICQoJyNjaGFydC1lbmNhYmV6YWRvJylbMF0uZ2V0QkJveCgpLmhlaWdodCArIG1hcmdpbi5oZWFkZXIgfSlgKTtcblxuICAgICAgICAvLyBDcmVhY2nDs24gU2Fua2V5XG4gICAgICAgIHNhbmtleUNoYXJ0RDMgPSBkMy5zYW5rZXkoKVxuICAgICAgICAgIC5ub2RlV2lkdGgoYW5jaG9Ob2RvKVxuICAgICAgICAgIC5ub2RlUGFkZGluZyhzZXBhcmFjaW9uTm9kbylcbiAgICAgICAgICAuc2l6ZShbc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHRdKVxuICAgICAgICAgIC5ub2RlcyhkYXRhLm5vZGVzKVxuICAgICAgICAgIC5saW5rcyhkYXRhLmxpbmtzKVxuICAgICAgICAgIC5sYXlvdXQoKTtcblxuICAgICAgICAvLyBDcmVhY2nDs24gZGUgTGlua3NcbiAgICAgICAgcGF0aCA9IHNhbmtleUNoYXJ0RDMubGluaygpO1xuXG4gICAgICAgIC8vICBTZSBjcmVhbiBsaW5rc1xuICAgICAgICBsZXQgbGluayA9IGNoYXJ0LmFwcGVuZCgnZycpXG4gICAgICAgICAgLmF0dHIoJ2lkJywgJ2xpbmtzJylcbiAgICAgICAgICAuc2VsZWN0QWxsKCcubGluaycpXG4gICAgICAgICAgLmRhdGEoZGF0YS5saW5rcylcbiAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgIC5hdHRyKCdkJywgcGF0aClcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGluaycpXG4gICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAoZCkgPT4gTWF0aC5tYXgoMSwgZC5keSkpXG4gICAgICAgICAgLy8gLm9uKCdtb3VzZW92ZXInLCAoZCkgPT4geyBkMy5zZWxlY3QoZDMuZXZlbnQudGFyZ2V0KS5zdHlsZSgnc3Ryb2tlLW9wYWNpdHknLCAxKTsgfSlcbiAgICAgICAgICAvLyAub24oJ21vdXNlb3V0JywgKGQpID0+IHsgZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgMC43NSk7IH0pXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IChiLmR5IC0gYS5keSkpO1xuXG4gICAgICAgICAgLy8gbGluay5maWx0ZXIoKGVsZW1lbnQpID0+IChlbGVtZW50LnRhcmdldC5uYW1lID09PSAnRVhQT1JUQUNJT05FUycgfHwgZWxlbWVudC50YXJnZXQubmFtZSA9PT0gJ0NPTlNVTU8gUFJPUElPJyB8fCBlbGVtZW50LnRhcmdldC5uYW1lID09PSAnVFJBTlNQT1JURScgfHwgZWxlbWVudC50YXJnZXQubmFtZSA9PT0gJ1BFUkRJREEnKSlcbiAgICAgICAgICAvLyAgIC5zdHlsZSgnc3Ryb2tlJywgJyNCQTNGMUQnKTtcblxuICAgICAgICAvLyBTZSBjcmVhbiBub2Rvc1xuICAgICAgICBsZXQgbm9kZSA9IGNoYXJ0LmFwcGVuZCgnZycpXG4gICAgICAgICAgLmF0dHIoJ2lkJywgJ25vZGVzJylcbiAgICAgICAgICAuc2VsZWN0QWxsKCcubm9kZScpXG4gICAgICAgICAgLmRhdGEoZGF0YS5ub2RlcylcbiAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2lkJywgKGQpID0+IGQuaWQpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZScpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgKGQpID0+IHtcblxuICAgICAgICAgICAgICBpZiAocG9zQ29sdW1uYXMuaW5kZXhPZihkLngpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHBvc0NvbHVtbmFzLnB1c2goZC54KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBgdHJhbnNsYXRlKCR7IGQueCB9LCAkeyBkLnkgfSlgO1xuICAgICAgICAgICAgfSk7IC8vIGVycm9yIGNvbXBhdGliaWxpZGFkXG4gICAgICAgICAgICAvLyAuY2FsbChkMy5kcmFnKCkub24oJ2RyYWcnLCBkcmFnbW92ZSkpO1xuXG4gICAgICAgIC8vIFNlIGNyZWFuIHJlY3Rhbmd1bG9zIG5vZG9zXG4gICAgICAgIG5vZGUuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHNhbmtleUNoYXJ0RDMubm9kZVdpZHRoKCkpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgKGQpID0+IE1hdGgubWF4KDUsIGQuZHkpKVxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmYWRlSW4oKSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmYWRlT3V0KCkpXG4gICAgICAgICAgICAub24oJ21vdXNlbW92ZScsIHRvb2x0aXBJbik7XG5cbiAgICAgICAgLy8gU2UgY3JlYW4gdGV4dG9zIG5vZG9zXG4gICAgICAgIG5vZGUuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZS10ZXh0JylcbiAgICAgICAgICAuYXR0cigneCcsIDEwICsgc2Fua2V5Q2hhcnREMy5ub2RlV2lkdGgoKSlcbiAgICAgICAgICAuYXR0cigneScsIChkKSA9PiAoZC5keSAvIDIpKVxuICAgICAgICAgIC5hdHRyKCdkeScsICcwLjM1ZW0nKVxuICAgICAgICAgIC50ZXh0KChkKSA9PiAoZC5uYW1lKSlcbiAgICAgICAgICAuZmlsdGVyKChkKSA9PiAoZC50YXJnZXRMaW5rcy5sZW5ndGggPT09IDApKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdub2RlLXRleHQtc3RhcnQnKVxuICAgICAgICAgIC5hdHRyKCd4JywgLTEwKTtcblxuICAgICAgICAvLyBTZSBhZ3JlZ2EgdGV4dG8gcmVmZXJlbmNpYSBob3ZlciBsaW5rXG4gICAgICAgIC8vIGxpbmsuYXBwZW5kKCd0aXRsZScpLnRleHQoKGQpID0+IGAkeyBkLnNvdXJjZS5uYW1lIH0gKCR7IGQuc291cmNlLmlkIH0pIOKGkiAkeyBkLnRhcmdldC5uYW1lIH0gKCR7IGQudGFyZ2V0LmlkIH0pIOKGkiAkeyBkLnZhbHVlIH1gKTtcblxuICAgICAgICAvLyBTZSBhZ3JlZ2EgdGV4dG8gcmVmZXJlbmNpYSBob3ZlciBub2RlXG4gICAgICAgIC8vIG5vZGUuYXBwZW5kKCd0aXRsZScpLnRleHQoKGQpID0+IGAkeyBkLm5hbWUgfSAoJHsgZC5pZCB9KWApO1xuXG4gICAgICAgIC8vIFNlIGFncmVnYW4gZW5jYWJlemFkb3NcbiAgICAgICAgcG9zQ29sdW1uYXMuc29ydCgpOyAvLyBTZSBvcmRlbmEgcG9zaWNpb24gZGUgY29sdW1uYXNcbiAgICAgICAgc2VjY2lvbmVzLmZvckVhY2goKHYsIGspID0+IHtcbiAgICAgICAgICBlbmNhYmV6YWRvLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAuZmlsdGVyKChkKSA9PiAoayA+IDApKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NoYXJ0LWVuY2FiZXphZG8tcmlnaHQnKVxuICAgICAgICAgICAgLmF0dHIoJ3gnLCAoZCkgPT4gKHBvc0NvbHVtbmFzW2tdICsgYW5jaG9Ob2RvICsgMTApKVxuICAgICAgICAgICAgLnRleHQodik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHRoZSBmdW5jdGlvbiBmb3IgbW92aW5nIHRoZSBub2Rlc1xuICAgICAgICAvLyBmdW5jdGlvbiBkcmFnbW92ZShkKSB7XG4gICAgICAgIC8vICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHsgZC54ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oc2l6ZS53aWR0aCAtIGQuZHgsIGQzLmV2ZW50LngpKSB9LCAkeyBkLnkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihzaXplLmhlaWdodCAtIGQuZHksIGQzLmV2ZW50LnkpKSB9KWApO1xuICAgICAgICAvLyAgIHNhbmtleUNoYXJ0RDMucmVsYXlvdXQoKTtcbiAgICAgICAgLy8gICBsaW5rLmF0dHIoJ2QnLCBwYXRoKTtcbiAgICAgICAgLy8gfVxuICAgICAgfTtcblxuICAgICAgLy8gY29uc3QgYWN0dWFsaXphclNhbmtleSA9ICh3aWR0aCwgaGVpZ3RoLCBkYXRhLCBvbGRMaW5rcykgPT4ge1xuICAgICAgLy8gICBjb25zdCBsaW5rc0RpZmYgPSAobGlua3Nfb2xkLCBsaW5rc19uZXcpID0+IHtcbiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhsaW5rc19vbGQpO1xuICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGxpbmtzX25ldyk7XG4gICAgICAvLyAgICAgbGV0IGxpbmtzID0gW10sXG4gICAgICAvLyAgICAgICAgIHNvdXJjZSxcbiAgICAgIC8vICAgICAgICAgdGFyZ2V0O1xuICAgICAgLy9cbiAgICAgIC8vICAgICBsaW5rc19uZXcuZm9yRWFjaCgodiwgaykgPT4ge1xuICAgICAgLy8gICAgICAgc291cmNlICA9IHYuc291cmNlO1xuICAgICAgLy8gICAgICAgdGFyZ2V0ICA9IHYudGFyZ2V0O1xuICAgICAgLy9cbiAgICAgIC8vICAgICAgIGxpbmtzX29sZC5mb3JFYWNoKCh2LCBrKSA9PiB7IGlmICgoc291cmNlICE9PSB2LnNvdXJjZS5pZCkgfHwgKHRhcmdldCAhPT0gdi50YXJnZXQuaWQpKSB7IGxpbmtzLnB1c2godik7IH0gfSk7XG4gICAgICAvLyAgICAgfSk7XG4gICAgICAvL1xuICAgICAgLy8gICAgIHJldHVybiBsaW5rcztcbiAgICAgIC8vICAgfTtcbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIGxldCBuZXdOb2RlcyA9IG5vZGVzRGlmZihkYXRhLCBzYW5rZXlEYXRhKTtcbiAgICAgIC8vICAgLy8gbGV0IG5ld0xpbmtzID0gbGlua3NEaWZmKG9sZExpbmtzLCBkYXRhLmxpbmtzKTtcbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIFBhcmFtZXRyb3NcbiAgICAgIC8vICAgbGV0IG1hcmdpbiA9IHtcbiAgICAgIC8vICAgICB0b3A6IDAsXG4gICAgICAvLyAgICAgcmlnaHQ6IDAsXG4gICAgICAvLyAgICAgYm90dG9tOiAwLFxuICAgICAgLy8gICAgIGxlZnQ6IDBcbiAgICAgIC8vICAgfTtcbiAgICAgIC8vICAgbGV0IHNpemUgPSB7XG4gICAgICAvLyAgICAgd2lkdGg6IHdpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQsXG4gICAgICAvLyAgICAgaGVpZ2h0OiBoZWlndGggLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbVxuICAgICAgLy8gICB9O1xuICAgICAgLy9cbiAgICAgIC8vICAgLy8gQ3JlYWNpw7NuIFNhbmtleVxuICAgICAgLy8gICBzYW5rZXlDaGFydEQzID0gZDMuc2Fua2V5KClcbiAgICAgIC8vICAgICAubm9kZVdpZHRoKDIwKSAvLyBBbmNobyBub2RvXG4gICAgICAvLyAgICAgLnNpemUoW3NpemUud2lkdGgsIHNpemUuaGVpZ2h0XSlcbiAgICAgIC8vICAgICAubm9kZXMoZGF0YS5ub2RlcylcbiAgICAgIC8vICAgICAubGlua3MoZGF0YS5saW5rcylcbiAgICAgIC8vICAgICAubGF5b3V0KDMyKTtcbiAgICAgIC8vXG4gICAgICAvLyAgIHNhbmtleUNoYXJ0RDMucmVsYXlvdXQoKTtcbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIENyZWFjacOzbiBkZSBMaW5rc1xuICAgICAgLy8gICBwYXRoID0gc2Fua2V5Q2hhcnREMy5saW5rKCk7XG4gICAgICAvLyAgICQoJyNsaW5rcycpLmVtcHR5KCk7XG4gICAgICAvL1xuICAgICAgLy8gICBsZXQgbGlua3MgPSBkMy5zZWxlY3QoJyNsaW5rcycpXG4gICAgICAvLyAgICAgLnNlbGVjdEFsbCgnLmxpbmsnKVxuICAgICAgLy8gICAgIC5kYXRhKGRhdGEubGlua3MpXG4gICAgICAvLyAgICAgLmVudGVyKCk7XG4gICAgICAvL1xuICAgICAgLy8gICBsaW5rcy5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLy8gICAgICAgLmF0dHIoJ2NsYXNzJywgJ2xpbmsnKVxuICAgICAgLy8gICAgICAgLmF0dHIoJ2QnLCAoZCkgPT4gcGF0aChkKSlcbiAgICAgIC8vICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgKGQpID0+IHtcbiAgICAgIC8vICAgICAgICAgcmV0dXJuIGQuZHk7XG4gICAgICAvLyAgICAgICB9KVxuICAgICAgLy8gICAgICAgLnN0eWxlKCdzdHJva2UnLCAnZ3JheScpXG4gICAgICAvLyAgICAgICAub24oJ21vdXNlb3ZlcicsIChkKSA9PiB7XG4gICAgICAvLyAgICAgICAgIC8vIGNvbnNvbGUubG9nKGQzLmV2ZW50KTtcbiAgICAgIC8vICAgICAgICAgZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCkuc3R5bGUoJ3N0cm9rZScsICdyZWQnKTtcbiAgICAgIC8vICAgICAgIH0pXG4gICAgICAvLyAgICAgICAub24oJ21vdXNlb3V0JywgKGQpID0+IHtcbiAgICAgIC8vICAgICAgICAgZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCkuc3R5bGUoJ3N0cm9rZScsICdncmF5Jyk7XG4gICAgICAvLyAgICAgICB9KTtcbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIGQzLnNlbGVjdEFsbCgnLmxpbmsnKVxuICAgICAgLy8gICAvLyAgIC5kYXRhKGRhdGEubGlua3MpXG4gICAgICAvLyAgIC8vICAgLmF0dHIoJ2QnLCAoZCkgPT4gcGF0aChkKSk7XG4gICAgICAvLyAgIGQzLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgLy8gICAgIC5kYXRhKGRhdGEubm9kZXMpXG4gICAgICAvLyAgICAgLy8gLnRyYW5zaXRpb24oKVxuICAgICAgLy8gICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAoZCkgPT4gYHRyYW5zbGF0ZSgkeyBkLnggfSwgJHsgZC55IH0pYCk7XG4gICAgICAvLyAgIGQzLnNlbGVjdEFsbCgncmVjdCcpXG4gICAgICAvLyAgICAgLmRhdGEoZGF0YS5ub2RlcylcbiAgICAgIC8vICAgICAuc3R5bGUoJ29wYWNpdHknLCAwKVxuICAgICAgLy8gICAgIC5hdHRyKCd3aWR0aCcsIHNhbmtleUNoYXJ0RDMubm9kZVdpZHRoKCkpXG4gICAgICAvLyAgICAgLmF0dHIoJ2hlaWdodCcsIChkKSA9PiBkLmR5KVxuICAgICAgLy8gICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC8vICAgICAuc3R5bGUoJ29wYWNpdHknLCAxKTtcbiAgICAgIC8vXG4gICAgICAvLyAgIC8vIENyZWF0ZSBEaWZlcmVuY2VcbiAgICAgIC8vICAgLy8gbmV3TGlua3MuZm9yRWFjaCgodiwgaykgPT4ge1xuICAgICAgLy8gICAvLyAgIGxldCBsaW5rID0gZDMuc2VsZWN0KCcjbGlua3MnKVxuICAgICAgLy8gICAvLyAgICAgLmFwcGVuZCgncGF0aCcpXG4gICAgICAvLyAgIC8vICAgICAgIC5hdHRyKCdjbGFzcycsICdsaW5rJylcbiAgICAgIC8vICAgLy8gICAgICAgLmF0dHIoJ2QnLCAoKSA9PiBwYXRoKHYpKVxuICAgICAgLy8gICAvLyAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICgpID0+IE1hdGgubWF4KDEsIHYuZHkpKVxuICAgICAgLy8gICAvLyAgICAgICAuc3R5bGUoJ3N0cm9rZScsICgpID0+IHNjYWxlQ29sb3Iodi5zb3VyY2UubmFtZS5yZXBsYWNlKCcgJywgJycpKSlcbiAgICAgIC8vICAgLy8gICAgICAgLnNvcnQoKGEsIGIpID0+IChiLmR5IC0gYS5keSkpO1xuICAgICAgLy8gICAvL1xuICAgICAgLy8gICAvLyAgIGxpbmsuYXBwZW5kKCd0aXRsZScpLnRleHQoKCkgPT4gYCR7IHYuc291cmNlLm5hbWUgfSDihpIgJHsgdi50YXJnZXQubmFtZSB9IFxcbiAkeyBmb3JtYXRvTnVtZXJvKHYudmFsdWUpIH1gKTtcbiAgICAgIC8vICAgLy8gfSk7XG4gICAgICAvLyB9O1xuICAgICAgLy8gY29uc3QgbWF4UGFyZW50ID0gKG5vZG8pID0+IHtcbiAgICAgIC8vICAgLy8gY29uc29sZS5sb2cobm9kbyk7XG4gICAgICAvLyAgIGxldCBwYXJlbnROb2RlID0gbm9kZXNHbG8uZmlsdGVyKChlbGVtZW50KSA9PiAoZWxlbWVudC5pZCA9PT0gbm9kby5wYXJlbnQpKVswXTtcbiAgICAgIC8vXG4gICAgICAvLyAgIGlmIChub2RvLnBhcmVudCAhPT0gZmFsc2UpIHtcbiAgICAgIC8vICAgICBpZiAodHlwZW9mKHBhcmVudE5vZGUpICE9PSAndW5kZWZpbmVkJyAmJiBwYXJlbnROb2RlLmdyb3VwID09PSB0cnVlKSB7XG4gICAgICAvLyAgICAgICByZXR1cm4gbWF4UGFyZW50KG5vZGVzR2xvLmZpbHRlcigoZWxlbWVudCkgPT4gKGVsZW1lbnQuaWQgPT09IG5vZG8ucGFyZW50KSlbMF0pO1xuICAgICAgLy8gICAgIH0gZWxzZSB7XG4gICAgICAvLyAgICAgICByZXR1cm4gbm9kbztcbiAgICAgIC8vICAgICB9XG4gICAgICAvLyAgIH0gZWxzZSB7XG4gICAgICAvLyAgICAgcmV0dXJuIG5vZG87XG4gICAgICAvLyAgIH1cbiAgICAgIC8vIH07XG4gICAgICAvLyBjb25zdCBkZWxldGVFbXB0eU5vZGVzID0gKCkgPT4ge1xuICAgICAgLy8gICBsZXQgZGVsID0gMCxcbiAgICAgIC8vICAgICAgIG5vZGVzRGVsZXRlID0gW10sXG4gICAgICAvLyAgICAgICBzdGF0dXM7XG4gICAgICAvL1xuICAgICAgLy8gICAvLyBtb3ZlSWQgPSAwO1xuICAgICAgLy9cbiAgICAgIC8vICAgbm9kZXNHbG8uZm9yRWFjaCgobm9kZSwgbm9kZUkpID0+IHtcbiAgICAgIC8vXG4gICAgICAvLyAgICAgLy8gY29uc29sZS5sb2coJ25vZG86ICcgKyBub2RlSSArICcgKCBpZDogJyArIG5vZGUuaWQgKyAnKScpO1xuICAgICAgLy8gICAgIHN0YXR1cyA9IGZhbHNlO1xuICAgICAgLy9cbiAgICAgIC8vICAgICAvLyBDb25zdWx0byBzaSBlbCBub2RvIHNlIHV0aWxpemEgZW4gYWxndW4gbGlua1xuICAgICAgLy8gICAgIGxpbmtzR2xvLmZvckVhY2goKGxpbmssIGxpbmtJKSA9PiB7XG4gICAgICAvLyAgICAgICBpZiAobm9kZS5pZCA9PT0gbGluay5zb3VyY2UpIHtcbiAgICAgIC8vICAgICAgICAgc3RhdHVzID0gdHJ1ZTtcbiAgICAgIC8vICAgICAgICAgbGluay5zb3VyY2UgPSBsaW5rLnNvdXJjZSAtIGRlbDtcbiAgICAgIC8vICAgICAgIH1cbiAgICAgIC8vICAgICAgIGlmIChub2RlLmlkID09PSBsaW5rLnRhcmdldCkge1xuICAgICAgLy8gICAgICAgICBzdGF0dXMgPSB0cnVlO1xuICAgICAgLy8gICAgICAgICBsaW5rLnRhcmdldCA9IGxpbmsudGFyZ2V0IC0gZGVsO1xuICAgICAgLy8gICAgICAgfVxuICAgICAgLy8gICAgIH0pO1xuICAgICAgLy9cbiAgICAgIC8vICAgICAvLyAvLyBNb2RpZmljYXIgZWwgSUQgcmVzdGFuZG8gbGEgY2FudGlkYWQgZGUgZWxlbWVudG9zIGJvcnJhZG9zXG4gICAgICAvLyAgICAgLy8gbm9kZS5pZCA9IG5vZGUuaWQgLSBkZWw7XG4gICAgICAvL1xuICAgICAgLy8gICAgIGlmICghc3RhdHVzKSB7XG4gICAgICAvLyAgICAgICAvLyBjb25zb2xlLmxvZygnQm9ycmFyJyk7XG4gICAgICAvLyAgICAgICBub2Rlc0RlbGV0ZS5wdXNoKG5vZGVJKTtcbiAgICAgIC8vICAgICAgIGRlbCsrO1xuICAgICAgLy8gICAgIH1cbiAgICAgIC8vICAgICAvLyBlbHNlIHtcbiAgICAgIC8vICAgICAvLyAgIC8vIGNvbnNvbGUubG9nKCdub2RvOiAnICsgbm9kZUkgKyAnICggaWQ6ICcgKyBub2RlLmlkICsgJyk8LScpO1xuICAgICAgLy8gICAgIC8vIH1cbiAgICAgIC8vICAgfSk7XG4gICAgICAvL1xuICAgICAgLy8gICBub2Rlc0RlbGV0ZS5yZXZlcnNlKCkuZm9yRWFjaCgobm9kZSkgPT4geyBub2Rlc0dsby5zcGxpY2Uobm9kZSwgMSk7IH0pO1xuICAgICAgLy9cbiAgICAgIC8vICAgLy8gbW92ZUlkID0gZGVsO1xuICAgICAgLy8gICAvLyBub2Rlcy5mb3JFYWNoKChub2RlLCBub2RlSSkgPT4ge1xuICAgICAgLy8gICAvLyAgIGNvbnNvbGUubG9nKCdub2RvOiAnICsgbm9kZUkgKyAnICggaWQ6ICcgKyBub2RlLmlkICsgJyknKTtcbiAgICAgIC8vICAgLy8gfSk7XG4gICAgICAvL1xuICAgICAgLy8gICAvLyBjb25zb2xlLmxvZyhsaW5rcyk7XG4gICAgICAvLyAgIHJldHVybiBub2Rlc0dsbztcbiAgICAgIC8vIH07XG4gICAgICAvLyBjb25zdCBkZWNsYXJlR3JvdXBMaW5rcyA9ICgpID0+IHtcbiAgICAgIC8vICAgbGV0IGxpbmtzID0gW10sXG4gICAgICAvLyAgICAgICBzb3VyY2UsIHBhcmVudFNvdXJjZSwgc3RhdGVTb3VyY2UsXG4gICAgICAvLyAgICAgICB0YXJnZXQsIHBhcmVudFRhcmdldCwgc3RhdGVUYXJnZXQsXG4gICAgICAvLyAgICAgICBub2RvRXhpc3RlbnRlLFxuICAgICAgLy8gICAgICAgYWRkU291cmNlLFxuICAgICAgLy8gICAgICAgYWRkVGFyZ2V0LFxuICAgICAgLy8gICAgICAgYWRkVmFsdWU7XG4gICAgICAvL1xuICAgICAgLy8gICBsaW5rc0dsby5mb3JFYWNoKCh2LCBrKSA9PiB7XG4gICAgICAvL1xuICAgICAgLy8gICAgIC8vU2Ugb2J0aWVuZSBzb3VyY2UgeSB0YXJnZXQgZGVsIGVsZW1lbnRvXG4gICAgICAvLyAgICAgc291cmNlID0gbm9kZXNHbG8uZmlsdGVyKChlbGVtZW50KSA9PiAoZWxlbWVudC5pZCA9PT0gcGFyc2VJbnQodi5zb3VyY2UpKSlbMF07XG4gICAgICAvLyAgICAgdGFyZ2V0ID0gbm9kZXNHbG8uZmlsdGVyKChlbGVtZW50KSA9PiAoZWxlbWVudC5pZCA9PT0gcGFyc2VJbnQodi50YXJnZXQpKSlbMF07XG4gICAgICAvLyAgICAgLy9TZSBndWFyZGEgc291cmNlLXBhZHJlIHkgdGFyZ2V0LXBhZHJlXG4gICAgICAvLyAgICAgcGFyZW50U291cmNlID0gbWF4UGFyZW50KHNvdXJjZSk7XG4gICAgICAvLyAgICAgcGFyZW50VGFyZ2V0ID0gbWF4UGFyZW50KHRhcmdldCk7XG4gICAgICAvLyAgICAgLy9TZSBndWFyZGEgc291cmNlLXN0YXRlIHkgdGFyZ2V0LXN0YXRlXG4gICAgICAvLyAgICAgc3RhdGVTb3VyY2UgPSBwYXJlbnRTb3VyY2UuZ3JvdXA7XG4gICAgICAvLyAgICAgc3RhdGVUYXJnZXQgPSBwYXJlbnRUYXJnZXQuZ3JvdXA7XG4gICAgICAvLyAgICAgLy9TZSBndWFyZGEgc291cmNlIHkgbGluayBhIGNyZWFyXG4gICAgICAvLyAgICAgYWRkU291cmNlID0gKHN0YXRlU291cmNlKSA/IChwYXJlbnRTb3VyY2UpIDogKHNvdXJjZSk7XG4gICAgICAvLyAgICAgYWRkVGFyZ2V0ID0gKHN0YXRlVGFyZ2V0KSA/IChwYXJlbnRUYXJnZXQpIDogKHRhcmdldCk7XG4gICAgICAvLyAgICAgYWRkVmFsdWUgID0gcGFyc2VJbnQodi52YWx1ZSk7XG4gICAgICAvLyAgICAgLy9TZSBjb25zdWx0YSBzaSBlbCBub2RvIGV4aXN0ZVxuICAgICAgLy8gICAgIG5vZG9FeGlzdGVudGUgPSBsaW5rcy5maWx0ZXIoKGVsZW1lbnQpID0+IChlbGVtZW50LnNvdXJjZSA9PT0gYWRkU291cmNlLmlkICYmIGVsZW1lbnQudGFyZ2V0ID09PSBhZGRUYXJnZXQuaWQpKTtcbiAgICAgIC8vXG4gICAgICAvLyAgICAgaWYgKG5vZG9FeGlzdGVudGUubGVuZ3RoICE9PSAwKSB7XG4gICAgICAvLyAgICAgICAvL1NlIHN1bWEgdmFsb3IgYSBkdXBsaWNhZG9cbiAgICAgIC8vICAgICAgIG5vZG9FeGlzdGVudGVbMF0udmFsdWUgKz0gYWRkVmFsdWU7XG4gICAgICAvLyAgICAgfSBlbHNlIHtcbiAgICAgIC8vICAgICAgIC8vU2UgY3JlbyBudWV2byBsaW5rXG4gICAgICAvLyAgICAgICBsaW5rcy5wdXNoKHtcbiAgICAgIC8vICAgICAgICAgJ3NvdXJjZSc6IGFkZFNvdXJjZS5pZCxcbiAgICAgIC8vICAgICAgICAgJ3RhcmdldCc6IGFkZFRhcmdldC5pZCxcbiAgICAgIC8vICAgICAgICAgJ3ZhbHVlJzogIGFkZFZhbHVlXG4gICAgICAvLyAgICAgICB9KTtcbiAgICAgIC8vICAgICB9XG4gICAgICAvLyAgIH0pO1xuICAgICAgLy8gICByZXR1cm4gbGlua3M7XG4gICAgICAvLyB9O1xuICAgICAgLy8gY29uc3QgcHJlU2Fua2V5ID0gKCkgPT4ge1xuICAgICAgLy8gICBsaW5rc0dsbyA9ICQuZXh0ZW5kKHRydWUsIFtdLCBsaW5rc09yaSk7XG4gICAgICAvLyAgIG5vZGVzR2xvID0gJC5leHRlbmQodHJ1ZSwgW10sIG5vZGVzT3JpKTtcbiAgICAgIC8vICAgbGlua3NHbG8gPSBkZWNsYXJlR3JvdXBMaW5rcygpO1xuICAgICAgLy8gICBub2Rlc0dsbyA9IGRlbGV0ZUVtcHR5Tm9kZXMoKTtcbiAgICAgIC8vXG4gICAgICAvLyAgIGRpYnVqYXJTYW5rZXkod2lkdGgsIGhlaWdodCwgeyAnbm9kZXMnOiBub2Rlc0dsbywgJ2xpbmtzJzogbGlua3NHbG8gfSk7XG4gICAgICAvLyB9O1xuXG4gICAgICBjb25zdCBpbml0ID0gKCkgPT4ge1xuXG4gICAgICAgIGNvbnN0IGRvd25sb2FkRmlsZSA9ICgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnU2Ugc29saWNpdGFuIGFyY2hpdm9zJyk7IC8vIEJvcnJhclxuXG4gICAgICAgICAgY29uc3QgZm9ybWF0b1NhbmtleSAgICAgPSAoZWxlbWVudG8sIGRhdGEpID0+IHtcbiAgICAgICAgICAgIGxldCBwcm9jZXNzRGF0YSA9IFtdO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKGVsZW1lbnRvKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ25vZG9zJzpcbiAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goKHYsIGspID0+IHtcblxuICAgICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICdpZCcgICAgICA6IHBhcnNlSW50KHYuaWQpLFxuICAgICAgICAgICAgICAgICAgICAnbmFtZScgICAgOiB2Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICdwYXJlbnQnICA6ICh2LnBhcmVudCA9PT0gJ251bGwnKT8oZmFsc2UpOihwYXJzZUludCh2LnBhcmVudCkpLFxuICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiB2LmNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICAncG9zJyAgICAgOiBwYXJzZUludCh2LnBvc2l0aW9uKSxcbiAgICAgICAgICAgICAgICAgICAgJ2dyb3VwJyAgIDogKHYuZ3JvdXAgPT09ICd0cnVlJyk/KHRydWUpOihmYWxzZSksXG4gICAgICAgICAgICAgICAgICAgICdpbXAnICAgICA6IHYuaW1wb3J0YXRpb24uc3BsaXQoJzsnKS5tYXAoKGVsZW1lbnQpID0+IChwYXJzZUludChlbGVtZW50KSkpLFxuICAgICAgICAgICAgICAgICAgICAnZXhwJyAgICAgOiB2LmV4cG9ydGF0aW9uLnNwbGl0KCc7JykubWFwKChlbGVtZW50KSA9PiAocGFyc2VJbnQoZWxlbWVudCkpKSxcbiAgICAgICAgICAgICAgICAgICAgJ3Byb2QnICAgIDogdi5wcm9kdWN0aW9uLnNwbGl0KCc7JykubWFwKChlbGVtZW50KSA9PiAocGFyc2VJbnQoZWxlbWVudCkpKVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2xpbmtzJzpcbiAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goKHYsIGspID0+IHtcbiAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAnc291cmNlJzogcGFyc2VJbnQodi5zb3VyY2UpLFxuICAgICAgICAgICAgICAgICAgICAndGFyZ2V0JzogcGFyc2VJbnQodi50YXJnZXQpLFxuICAgICAgICAgICAgICAgICAgICAndmFsdWUnIDogcGFyc2VJbnQodi52YWx1ZSksXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NEYXRhO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChzdWNjZXNzKSA9PiB7XG4gICAgICAgICAgICBkMy5qc29uKCdwdWJsaWMvc3JjL25vZGVzLmpzb24nLCAobm9kb3MpID0+IHtcbiAgICAgICAgICAgICAgbm9kZXNPcmkgPSBub2RvcztcblxuICAgICAgICAgICAgICBkMy5qc29uKCdwdWJsaWMvc3JjL2xpbmtzLmpzb24nLFxuICAgICAgICAgICAgICAgIChsaW5rcykgPT4ge1xuICAgICAgICAgICAgICAgICAgbGlua3NPcmkgPSBsaW5rcztcblxuICAgICAgICAgICAgICAgICAgc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBkMy5jc3YoJ3B1YmxpYy9zcmMvbm9kZXMuY3N2JyxcbiAgICAgICAgICAgIC8vICAgKG5vZG9zKSA9PiB7XG4gICAgICAgICAgICAvLyAgICAgbm9kZXNPcmkgPSBmb3JtYXRvU2Fua2V5KCdub2RvcycsIG5vZG9zKTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAgICAgZDMuY3N2KCdwdWJsaWMvc3JjL2xpbmtzLmNzdicsXG4gICAgICAgICAgICAvLyAgICAgICAobGlua3MpID0+IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgbGlua3NPcmkgPSBmb3JtYXRvU2Fua2V5KCdsaW5rcycsIGxpbmtzKTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAgICAgICAgIHN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIC8vICAgICAgIH1cbiAgICAgICAgICAgIC8vICAgICApO1xuICAgICAgICAgICAgLy8gICB9XG4gICAgICAgICAgICAvLyApO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgZG93bmxvYWRGaWxlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgZGlidWphclNhbmtleSh3aWR0aCwgaGVpZ2h0LCB7ICdub2Rlcyc6IG5vZGVzT3JpLCAnbGlua3MnOiBsaW5rc09yaSB9KTtcbiAgICAgICAgICBpbnRybygpO1xuICAgICAgICAgIC8vIHByZVNhbmtleSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgaW5pdCgpO1xufSk7XG4iXX0=
