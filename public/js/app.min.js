"use strict";var colores=["#0075C9","#009DDA","#00B5E4"],subtractLight=function(t,e){var n=parseInt(t,16)-e,i=n<0?0:n;return i=i.toString(16).length>1?i.toString(16):"0"+i.toString(16)},darken=function(t,e){return t=t.indexOf("#")>=0?t.substring(1,t.length):t,e=parseInt(255*e/100),t="#"+subtractLight(t.substring(0,2),e)+subtractLight(t.substring(2,4),e)+subtractLight(t.substring(4,6),e)};$(function(){var t=$("#sankey").height(),e=$("#sankey").width(),n=void 0,i=void 0,r=void 0,l=void 0,o=void 0,s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(e,n){var i=d3.selectAll("#sankey .link"),r=d3.selectAll("#sankey .node"),l=[],o=null===t?e.id:t;console.log(o);var s=r.filter(function(t){return t.id===o});s.select("rect").transition().style("fill","black").style("stroke","black"),s.select("text").transition().style("fill","black");var a=r.filter(function(t){var e=!1;return l.forEach(function(n){t.id===n&&(e=!0)}),e});a.select("rect").transition().style("fill","black").style("stroke","black"),a.select("text").transition().style("fill","black"),i.filter(function(t){var e=!0;return t.source.id===o?l.push(t.target.id):t.target.id===o?l.push(t.source.id):e=!1,e}).transition().style("stroke","#0075C9").style("stroke-opacity",.5)}},a=function(t){$("#tooltip").css({top:event.layerY+20,left:event.layerX+20}),$(".tooltip_name").text(t.name),$(".tooltip_production").text("Producción: "+t.production),$(".tooltip_losses").text("Pérdida: "+t.losses)},c=function(t){return function(t,e){var n=d3.selectAll("#sankey .link"),i=d3.selectAll("#sankey .node"),r=[],l=i.filter(function(e){return e.id===t.id});l.select("rect").transition().style("fill",null).style("stroke",null),l.select("text").transition().style("fill",null);var o=i.filter(function(t){var e=!1;return r.forEach(function(n){t.id===n&&(e=!0)}),e});o.select("rect").transition().style("fill",null).style("stroke",null),o.select("text").transition().style("fill",null),n.filter(function(e){var n=!0;return e.source.id===t.id?r.push(e.target.id):e.target.id===t.id?r.push(e.source.id):n=!1,n}).transition().style("stroke",null).style("stroke-opacity",null),$("#tooltip").removeAttr("style")}},d=function(t){return n.filter(function(e){return e.id===t})[0]},u=function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=[2,27,13,26,12,31],o=d(l[e]),s=d(l[e+1]),a=d(l[e+2]),c=void 0,u=void 0,f=void 0,p=void 0,h=function(t){var e=d3.select("#node_"+t.id);e.select("rect").transition().style("fill",null).style("stroke",null),e.select("text").transition().style("fill",null)},y=function(t,e){d3.selectAll("#sankey .link").filter(function(n){return n.source.id===t.id&&n.target.id===e.id}).transition().style("stroke",null).style("stroke-opacity",null)};if(n?(d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),c=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),c.append("h2").attr("class","tooltip_name"),c.append("p").attr("class","tooltip_production"),u=c.append("div").attr("class","flex flex_justify_between"),f=u.append("button").attr("id","last").text("Anterior"),p=u.append("button").attr("id","next").text("Siguiente")):(c=d3.select("#tooltip_intro"),u=c.select("div"),f=u.select("#last"),p=u.select("#next")),i)return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),l.forEach(function(t,e){var n=d(l[e]),i=d(l[e+1]);h(n),y(n,i)}),!1;r?(function(t){var e=d3.select("#node_"+t.id);e.select("rect").transition().style("fill","black").style("stroke","black"),e.select("text").transition().style("fill","black")}(o),function(t,e){d3.selectAll("#sankey .link").filter(function(n){return n.source.id===t.id&&n.target.id===e.id}).transition().style("stroke","#0075C9").style("stroke-opacity",.5)}(o,s)):(h(s),y(s,a)),c.select("h2").text(o.name),c.select("p").text("Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."),f.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,!1,!1,!1)}),p.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1)}),0===e?f.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e)}):e===l.length-1&&p.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,!1,!0)})},f=function(t,e,n){$("#sankey").empty();var i={top:40,right:200,bottom:40,left:200,header:20},d={width:(t<1400?t:1400)-i.left-i.right,height:e-i.top-i.bottom-i.header-19},u=["COL 01","COL 02","COL 03","COL 04","COL 05","COL 06"],f=[];o=d3.select("#sankey").append("svg").attr("width",d.width+i.right+i.left).attr("height",d.height+i.top+i.bottom+i.header+19);var p=o.append("g").attr("id","chart-encabezado").attr("transform","translate("+i.left+", "+(i.top+15)+")");p.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(u[0]);var h=o.append("g").attr("transform","translate("+i.left+", "+(i.top+$("#chart-encabezado")[0].getBBox().height+i.header)+")");r=d3.sankey().nodeWidth(20).nodePadding(20).size([d.width,d.height]).nodes(n.nodes).links(n.links).layout(),l=r.link();var y=(h.append("g").attr("id","links").selectAll(".link").data(n.links).enter().append("path").attr("d",l).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy}),h.append("g").attr("id","nodes").selectAll(".node").data(n.nodes).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===f.indexOf(t.x)&&f.push(t.x),"translate("+t.x+", "+t.y+")"}));y.append("rect").attr("width",r.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseover",s()).on("mouseout",c()).on("mousemove",a),y.append("text").attr("class","node-text").attr("x",10+r.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.name}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),f.sort(),u.forEach(function(t,e){p.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return f[e]+20+10}).text(t)})};!function(){(function(){console.log("Se solicitan archivos");return new Promise(function(t){d3.json("public/src/nodes.json",function(e){n=e,d3.json("public/src/links.json",function(e){i=e,t()})})})})().then(function(){f(e,t,{nodes:n,links:i}),u(0,!0)})}()});