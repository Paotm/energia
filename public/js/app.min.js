"use strict";var GLOBAL_NODES=void 0,GLOBAL_LINKS=void 0,INTRO={nodes:[3,28,15,26,12,31],nodes_description:["Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."]},SANKEY={margin:{top:40,right:200,bottom:40,left:200,header:20},separacionNodo:20,anchoNodo:20,secciones_header:[["ENERGÍAS","PRIMARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["CENTROS DE","TRANSFORMACIÓN"],["ENERGÍAS","SECUNDARIAS"],["SECTORES","DE CONSUMOS"]]},SELECTORES={categorias:[["Energías primarias",["categorias1","categorias1","categorias1","categorias1","categorias1"]],["Energías secundarias",["categorias2","categorias2","categorias2","categorias2","categorias2"]],["Energías terciarias",["categorias3","categorias3","categorias3","categorias3","categorias3"]],["Centros de transformación",["categorias4","categorias4","categorias4","categorias4","categorias4"]],["Consumos",["categorias5","categorias5","categorias5","categorias5","categorias5"]],["No aprovechables",["categorias6","categorias6","categorias6","categorias6","categorias6"]]],anio:[]},COLORES_FLUJO={importacion:"#FFCF87",exportacion:"#00897B",produccion:"#7FC6E6",perdida:"#ED7960",default:"#CFD8DC"},BUSCAR_NODO=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return GLOBAL_NODES.filter(function(o){return o.id===t+e})[0]};$(function(){var t=$("#sankey").height(),e=$("#sankey").width(),o=void 0,n=void 0,r=void 0,a=void 0,i=void 0,s=function(){return INTRO.nodes.forEach(function(t,e){INTRO.nodes[e]=BUSCAR_NODO(t)}),!0},l=function(t){$("#tooltip").css({top:$("#sankey svg").position().top+t.y+7,left:$("#sankey svg").position().left+t.x+210}),1===t.posicionX||3===t.posicionX||5===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.oferta_interna),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion),$(".tooltip_importation").parent().parent().removeAttr("style"),$(".tooltip_importation").text(t.importacion),$(".tooltip_exportation").parent().parent().removeAttr("style"),$(".tooltip_exportation").text(t.exportacion),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros)):2===t.posicionX||4===t.posicionX?($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo),$(".tooltip_production").parent().parent().removeAttr("style"),$(".tooltip_production").text(t.produccion),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().removeAttr("style"),$(".tooltip_losses").text(t.perdidas),$(".tooltip_others").parent().parent().removeAttr("style"),$(".tooltip_others").text(t.otros)):($(".tooltip_name").text(t.nombre),$(".tooltip_ktep").text(t.consumo),$(".tooltip_production").parent().parent().css({display:"none"}),$(".tooltip_importation").parent().parent().css({display:"none"}),$(".tooltip_exportation").parent().parent().css({display:"none"}),$(".tooltip_losses").parent().parent().css({display:"none"}),$(".tooltip_others").parent().parent().css({display:"none"}))},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r){var a=null===e?n.id:e,i=void 0;switch(t){case"fadeIn":i=d3.select("#node_"+a),i.select("rect").transition().style("stroke","black"),i.select("text").transition().style("fill","black"),o.each(function(t,e){t.source.id===a?d3.select("#node_"+t.target.id).select("text").transition().style("fill","black"):t.target.id===a&&d3.select("#node_"+t.source.id).select("text").transition().style("fill","black")}),o.filter(function(t){return t.source.id===a&&37!==t.target.id&&43!==t.target.id||t.target.id===a&&42!==t.source.id}).transition().duration(100).style("stroke","url(#gradient_prod)").style("stroke-opacity",.5),o.filter(function(t){return 42===t.source.id&&t.target.id===a}).transition().duration(100).style("stroke","url(#gradient_imp)").style("stroke-opacity",.5),o.filter(function(t){return t.source.id===a&&43===t.target.id}).transition().duration(100).style("stroke","url(#gradient_exp)").style("stroke-opacity",.5),o.filter(function(t){return t.source.id===a&&37===t.target.id||t.target.id===a&&37===a}).transition().duration(100).style("stroke",COLORES_FLUJO.perdida).style("stroke-opacity",.5),l(n);break;case"fadeOut":i=d3.select("#node_"+a),i.select("rect").transition().style("stroke",null),i.select("text").transition().style("fill",null),o.each(function(t,e){t.source.id===a?d3.select("#node_"+t.target.id).select("text").transition().style("fill",null):t.target.id===a&&d3.select("#node_"+t.source.id).select("text").transition().style("fill",null)}),o.filter(function(t){return t.source.id===a&&37!==t.target.id&&43!==t.target.id||t.target.id===a&&42!==t.source.id}).transition().duration(100).style("stroke",COLORES_FLUJO.default).style("stroke-opacity",null),o.filter(function(t){return 42===t.source.id&&t.target.id===a}).transition().duration(100).style("stroke","url(#gradient_imp_default)").style("stroke-opacity",null),o.filter(function(t){return t.source.id===a&&43===t.target.id}).transition().duration(100).style("stroke","url(#gradient_exp_default)").style("stroke-opacity",null),o.filter(function(t){return t.source.id===a&&37===t.target.id||t.target.id===a&&37===a}).transition().duration(100).style("stroke",COLORES_FLUJO.default).style("stroke-opacity",null),$("#tooltip").removeAttr("style")}}},d=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",r=d3.selectAll("#sankey .link").filter(function(t){return t.source.id===INTRO.nodes[e].id&&t.target.id===INTRO.nodes[e+1].id}),a=d3.selectAll("#sankey .node").filter(function(t){return t.id===INTRO.nodes[e].id}),i=void 0,s=void 0,l=void 0,c=void 0;switch(o){case"create":d3.select("#content").append("div").attr("id","intro_screen").style("top","0px").style("left","0px"),i=d3.select("#content").append("div").attr("id","tooltip_intro").style("bottom","20px").style("right","20px"),i.append("div"),i.select("div").attr("class","flex flex_justify_between flex_align_start").append("h2").attr("class","tooltip_name"),i.select("div").append("span").attr("class","glyphicon glyphicon-remove tooltip_exit"),i.append("p").attr("class","tooltip_production"),s=i.append("div").attr("class","flex flex_justify_between"),l=s.append("button").attr("id","last").text("Anterior"),c=s.append("button").attr("id","next").text("Siguiente"),$(".tooltip_exit").on("click",function(){t(e,"delete","none")}),$(document).keyup(function(o){27===o.keyCode&&1===$(".tooltip_exit").length&&t(e,"delete","none")});break;case"delete":return d3.select("#tooltip_intro").remove(),d3.select("#intro_screen").remove(),d3.selectAll("#sankey .node rect").transition().style("fill",null).style("stroke",null),d3.selectAll("#sankey .node text").transition().style("fill",null),d3.selectAll("#sankey .link").filter(function(t){return 42!==t.source.id&&43!==t.target.id}).transition().style("stroke",null).style("stroke-opacity",null),!1;case"normal":i=d3.select("#tooltip_intro"),s=i.select("div:nth-child(3)"),l=s.select("#last"),c=s.select("#next")}switch(n){case"next":!function(t){a.select("rect").transition().style("stroke","black"),a.select("text").transition().style("fill","black")}(INTRO.nodes[e]),function(t,e){r.style("stroke","url(#gradient_link)").style("stroke-opacity",.5)}(INTRO.nodes[e],INTRO.nodes[e+1]);break;case"back":!function(t){a.select("rect").transition().style("fill",null).style("stroke",null),a.select("text").transition().style("fill",null)}(INTRO.nodes[e+1]),function(t,e){r.style("stroke",null).style("stroke-opacity",null)}(INTRO.nodes[e+1],INTRO.nodes[e+2])}i.select("h2").text(INTRO.nodes[e].nombre),i.select("p").text(INTRO.nodes_description[e]),0===e?(l.attr("class","btn btn-default btn-xs disabled").on("click",function(){t(e,"normal","none")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")})):e===INTRO.nodes.length-1?(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-primary btn-xs").text("Comenzar").on("click",function(){t(e,"delete","none")})):(l.attr("class","btn btn-default btn-xs").on("click",function(){t(e-1,"normal","back")}),c.attr("class","btn btn-default btn-xs").on("click",function(){t(e+1,"normal","next")}))},p=function(t){return new Promise(function(e){d3.json("public/src/data_"+t+".json",function(t){GLOBAL_NODES=t.nodes,GLOBAL_LINKS=t.links,e()})})},u=function(t,e,o,n){var s=n.margin,l={width:1400-s.left-s.right,height:e-s.top-s.bottom-s.header-38},d=n.anchoNodo,p=n.separacionNodo,u=[];i=d3.select("#sankey").append("svg").attr("width",l.width+s.right+s.left).attr("height",l.height+s.top+s.bottom+s.header+38).attr("preserveAspectRatio","xMidYMid meet");var f=i.append("g").attr("id","chart-encabezado").attr("transform","translate("+s.left+", "+(s.top+15)+")");f.append("text").attr("class","chart-encabezado-left").attr("x",-10).text(SANKEY.secciones_header[0][0]),f.append("text").attr("class","chart-encabezado-left").attr("x",-10).attr("y",19).text(SANKEY.secciones_header[0][1]);var g=i.append("g").attr("transform","translate("+s.left+", "+(s.top+$("#chart-encabezado")[0].getBBox().height+s.header)+")");r=d3.sankey().nodeWidth(d).nodePadding(p).size([l.width,l.height]).nodes(o.nodes).links(o.links).layout();var y=i.append("defs"),m=y.append("linearGradient").attr("id","gradient_imp").attr("x1","100%").attr("y1","100%").attr("x2","0%").attr("y2","0%");m.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",1),m.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",1),m.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.importacion).attr("stop-opacity",0);var _=y.append("linearGradient").attr("id","gradient_imp_default").attr("x1","100%").attr("y1","100%").attr("x2","0%").attr("y2","0%");_.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),_.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),_.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",0);var h=y.append("linearGradient").attr("id","gradient_exp").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");h.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",1),h.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",1),h.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.exportacion).attr("stop-opacity",0);var x=y.append("linearGradient").attr("id","gradient_exp_default").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");x.append("stop").attr("offset","0%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),x.append("stop").attr("offset","50%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",1),x.append("stop").attr("offset","100%").attr("stop-color",COLORES_FLUJO.default).attr("stop-opacity",0);var O=y.append("linearGradient").attr("gradientUnits","userSpaceOnUse").attr("id","gradient_prod").attr("x1","0%").attr("y1","50%").attr("x2","100%").attr("y2","50%");O.append("stop").attr("offset","0%").attr("stop-color","rgb(32,106,171)").attr("stop-opacity",1),O.append("stop").attr("offset","20%").attr("stop-color","rgb(0,117,201)").attr("stop-opacity",1),O.append("stop").attr("offset","40%").attr("stop-color","rgb(0,157,218)").attr("stop-opacity",1),O.append("stop").attr("offset","60%").attr("stop-color","rgb(77,203,236)").attr("stop-opacity",1),O.append("stop").attr("offset","80%").attr("stop-color","rgb(127,218,241)").attr("stop-opacity",1),O.append("stop").attr("offset","100%").attr("stop-color","rgb(178,233,247)").attr("stop-opacity",1),a=r.link();var k=g.append("g").attr("id","links").selectAll(".link").data(r.links()).enter().append("path").attr("d",a).attr("class","link").style("stroke-width",function(t){return Math.max(1,t.dy)});k.filter(function(t){return 42===t.source.id}).style("stroke","url(#gradient_imp_default)"),k.filter(function(t){return 43===t.target.id}).style("stroke","url(#gradient_exp_default)");var N=g.append("g").attr("id","nodes").selectAll(".node").data(r.nodes()).enter().append("g").attr("id",function(t){return"node_"+t.id}).attr("class","node").attr("transform",function(t){return-1===u.indexOf(t.x)&&u.push(t.x),"translate("+t.x+", "+t.y+")"}).on("click",function(t){console.log("click")});N.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("rect").attr("width",r.nodeWidth()).attr("height",function(t){return Math.max(5,t.dy)}).on("mouseenter",c("fadeIn",null)).on("mouseleave",c("fadeOut",null)),N.filter(function(t){return"borrar"!==t.nombre&&t.oferta_interna>0||void 0===t.oferta_interna}).append("text").attr("class","node-text").attr("x",10+r.nodeWidth()).attr("y",function(t){return t.dy/2}).attr("dy","0.35em").text(function(t){return t.nombre}).filter(function(t){return 0===t.targetLinks.length}).attr("class","node-text-start").attr("x",-10),u.sort(function(t,e){return t-e}),SANKEY.secciones_header.forEach(function(t,e){f.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return u[e]+d+10}).text(t[0]),f.append("text").filter(function(t){return e>0}).attr("class","chart-encabezado-right").attr("x",function(t){return u[e]+d+10}).attr("y",19).text(t[1])})},f=function(){var o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t=$("#sankey").height(),e=$("#sankey").width(),o&&$("#sankey").empty(),$("#content h1").outerHeight()+$("#content form").outerHeight()+550<=$("#content").outerHeight()?(d3.select("#content").attr("style",null),SANKEY.margin.bottom=40,SANKEY.margin.left=200,SANKEY.margin.top=40,SANKEY.margin.header=20,SANKEY.anchoNodo=20,SANKEY.separacionNodo=20):(d3.select("#content").attr("style","height: 100%"),SANKEY.margin.bottom=5,SANKEY.margin.left=150,SANKEY.margin.top=20,SANKEY.margin.header=15,SANKEY.anchoNodo=10,SANKEY.separacionNodo=15),o&&u(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})},g=function(){return o=d3.selectAll("#sankey .link"),n=d3.selectAll("#sankey .node"),!0};p(2015).then(function(){return s()}).then(function(){return f()}).then(function(){return u(0,t,{nodes:GLOBAL_NODES,links:GLOBAL_LINKS},{margin:SANKEY.margin,separacionNodo:SANKEY.separacionNodo,anchoNodo:SANKEY.anchoNodo})}).then(function(){return g()}).then(function(){return d(0,"create","next")}).then(function(){for(var t=2015;t>1959;t--)$("select[name=anio]").append('<option value="'+t+'">'+t+"</option>");$("select[name=anio]").on("change",function(t){p($("select[name=anio]")[0].value).then(function(){return g()}).then(function(){return f(!0)})}),$(window).on("resize",function(){f(!0)})})});