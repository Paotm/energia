"use strict";d3.sankey=function(){function n(){d.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),l.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=d[n.source]),"number"==typeof r&&(r=n.target=d[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){d.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function r(){for(var n,t=d,o=0;t.length&&o<d.length;){if(n=[],t.forEach(function(t){t.x=t.posicionX-1,t.dx=h,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&!t.cycleBreaker&&n.push(t.target)})}),n.length==t.length)return e(n),r();t=n,++o}u((y[0]-h)/5)}function e(n){function t(n,r){for(var e,u,o=n.sourceLinks.length-1;o>=0;o--)if(u=n.sourceLinks[o],!u.cycleBreaker){e=u.target;for(var i=0;i<r.length;i++)if(r[i].source==e){for(var c=u;i<r.length;i++)r[i].value<c.value&&(c=r[i]);return c.cycleBreaker=!0,c}if(r.push(u),u=t(e,r),r.pop(),u)return u}}for(var r,e=n.length-1;e>=0;e--)if(r=t(n[e],[]))return r}function u(n){d.forEach(function(t){t.x*=n})}function o(n){function t(){r.forEach(function(n){var t,r,e,u=0,o=n.length;for(n.sort(a),e=0;e<o;++e)t=n[e],r=u-t.y,r>0&&(t.y+=r),u=t.y+t.dy+g;if((r=u-g-y[1])>0)for(u=t.y-=r,e=o-2;e>=0;--e)t=n[e],r=t.y+t.dy+g-u,r>0&&(t.y-=r),u=t.y})}var r=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(d).map(function(n){return n.values});!function(){var n=d3.min(r,function(n){return(y[1]-(n.length-1)*g)/d3.sum(n,f)});r.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),l.forEach(function(t){t.dy=t.value*n})}(),t(),i();for(var e=1;n>0;--n)!function(n){function t(n){return(n.target.y+n.ty+n.dy/2)*n.value}r.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var e=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,f);r.y+=(e-c(r))*n}})})}(e*=.99),t(),i(),function(n){function t(n){return(n.source.y+n.sy+n.dy/2)*n.value}r.forEach(function(r,e){r.forEach(function(r){if(r.targetLinks.length){var e=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,f);r.y+=(e-c(r))*n}})})}(e),t(),i()}function i(){function n(n,t){return 30===t.target.id||30===n.target.id?1:t.dy-n.dy}function t(n,t){return n.target.posicionY-t.target.posicionY}d.forEach(function(r){r.sourceLinks.sort(n),r.targetLinks.sort(t)}),d.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function c(n){return n.y+n.dy/2}function f(n){return n.value}function a(n,t){var r=n.posicionY,e=t.posicionY;return r<e?1:r>e?-1:0}var s={},h=24,g=30,y=[1,1],d=[],l=[],v=!0;return s.nodeWidth=function(n){return arguments.length?(h=+n,s):h},s.nodePadding=function(n){return arguments.length?(g=+n,s):g},s.nodes=function(n){return arguments.length?(d=n,s):d},s.links=function(n){return arguments.length?(l=n,s):l},s.size=function(n){return arguments.length?(y=n,s):y},s.sinksRight=function(n){return arguments.length?(v=n,s):v},s.layout=function(e){return n(),t(),r(),o(e),s},s.relayout=function(){return i(),s},s.link=function(){function n(n){var e=n.source.x+n.source.dx,u=n.source.y+n.sy+n.dy/2,o=n.target.x,i=n.target.y+n.ty+n.dy/2,c=d3.interpolateNumber(e,o),f=c(r),a=c(1-r),s=o-e-10,h=i-u;return n.source.posicionX<n.target.posicionX?(31===n.target.id&&(t="m "+e+" "+u+" h 10 l 10 10"),31!==n.target.id&&(t="M "+e+" "+u+" C "+f+" "+u+" "+a+" "+i+" "+o+" "+i)):(30===n.source.id&&(t="m "+(o-20)+" "+(i-10)+" l 10 10 h 10"),30!==n.source.id&&(t="M "+e+" "+u+" h 5 c 5 0 5 10 0 10 c "+1.5*s+" 0 "+1.5*s+" "+(h-10)+" "+s+" "+(h-10)+" h 5")),t}var t,r=.75;return n.curvature=function(t){return arguments.length?(r=+t,n):r},n},s};