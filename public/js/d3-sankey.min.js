"use strict";d3.sankey=function(){function n(){l.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),d.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=l[n.source]),"number"==typeof r&&(r=n.target=l[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){l.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function r(){for(var n,t=l,u=0;t.length&&u<l.length;){if(n=[],t.forEach(function(t){t.x=t.posicionX-1,t.dx=h,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&!t.cycleBreaker&&n.push(t.target)})}),n.length==t.length)return e(n),r();t=n,++u}o((g[0]-h)/5)}function e(n){function t(n,r){for(var e,o,u=n.sourceLinks.length-1;u>=0;u--)if(o=n.sourceLinks[u],!o.cycleBreaker){e=o.target;for(var i=0;i<r.length;i++)if(r[i].source==e){for(var c=o;i<r.length;i++)r[i].value<c.value&&(c=r[i]);return c.cycleBreaker=!0,c}if(r.push(o),o=t(e,r),r.pop(),o)return o}}for(var r,e=n.length-1;e>=0;e--)if(r=t(n[e],[]))return r}function o(n){l.forEach(function(t){t.x*=n})}function u(n){function t(){r.forEach(function(n){var t,r,e,o=0,u=n.length;for(n.sort(a),e=0;e<u;++e)t=n[e],r=o-t.y,r>0&&(t.y+=r),o=t.y+t.dy+y;if((r=o-y-g[1])>0)for(o=t.y-=r,e=u-2;e>=0;--e)t=n[e],r=t.y+t.dy+y-o,r>0&&(t.y-=r),o=t.y})}var r=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(l).map(function(n){return n.values});!function(){var n=d3.min(r,function(n){return(g[1]-(n.length-1)*y)/d3.sum(n,f)});r.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),d.forEach(function(t){t.dy=t.value*n})}(),t(),i();for(var e=1;n>0;--n)!function(n){function t(n){return(n.target.y+n.ty+n.dy/2)*n.value}r.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var e=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,f);r.y+=(e-c(r))*n}})})}(e*=.99),t(),i(),function(n){function t(n){return(n.source.y+n.sy+n.dy/2)*n.value}r.forEach(function(r,e){r.forEach(function(r){if(r.targetLinks.length){var e=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,f);r.y+=(e-c(r))*n}})})}(e),t(),i()}function i(){function n(n,t){return 42===t.target.id||42===n.target.id?1:t.dy-n.dy}function t(n,t){return n.target.posicionY-t.target.posicionY}l.forEach(function(r){r.sourceLinks.sort(n),r.targetLinks.sort(t)}),l.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function c(n){return n.y+n.dy/2}function f(n){return n.value}function a(n,t){var r=n.posicionY,e=t.posicionY;return r<e?1:r>e?-1:0}var s={},h=24,y=30,g=[1,1],l=[],d=[],v=!0;return s.nodeWidth=function(n){return arguments.length?(h=+n,s):h},s.nodePadding=function(n){return arguments.length?(y=+n,s):y},s.nodes=function(n){return arguments.length?(l=n,s):l},s.links=function(n){return arguments.length?(d=n,s):d},s.size=function(n){return arguments.length?(g=n,s):g},s.sinksRight=function(n){return arguments.length?(v=n,s):v},s.layout=function(e){return n(),t(),r(),u(e),s},s.relayout=function(){return console.log("relayout"),i(),s},s.link=function(){function n(n){var r=n.source.x+n.source.dx,e=n.target.x,o=d3.interpolateNumber(r,e),u=o(t),i=o(1-t),c=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;if(n.source.posicionX<n.target.posicionX)return 43===n.target.id?"m "+r+" "+c+" h 10 l 10 10":"M "+r+" "+c+" C "+u+" "+c+" "+i+" "+f+" "+e+" "+f;if("ImportaciÃ³n"===n.source.nombre)return"m "+(e-20)+" "+(f-10)+" l 10 10 h 10";var a=(n.dy,Math.abs(r-e),o(.5),d3.interpolateNumber(c,f)(.5)),s=(n.dy,Math.abs(r-e),Math.abs(c-f),g[1],e-r-10),h=f-c;return"M "+r+" "+c+"\n                  h 5\n                  c 5 0 5 10 0 10\n                  h "+s+"\n                  c "+s/2+" 0 "+s/2+" "+(h-10)+" 0 "+(h-10)+"\n                  h 5"}var t=.75;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},s};