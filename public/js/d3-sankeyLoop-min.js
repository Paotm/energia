"use strict";d3.sankey=function(){function n(){v.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),k.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=v[n.source]),"number"==typeof r&&(r=n.target=v[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){v.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,s),d3.sum(n.targetLinks,s))})}function r(){for(var n=v,t,u=0,i=4;n.length&&u<v.length;){if(t=[],n.forEach(function(n){n.x=n.pos-1,n.dx=g,n.sourceLinks.forEach(function(n){t.indexOf(n.target)<0&&!n.cycleBreaker&&t.push(n.target)})}),t.length==n.length)return e(t),r();n=t,++u}L&&o(4),c((d[0]-g)/3)}function e(n){function t(n,r){for(var e,u,o=n.sourceLinks.length-1;o>=0;o--)if(u=n.sourceLinks[o],!u.cycleBreaker){e=u.target;for(var c=0;c<r.length;c++)if(r[c].source==e){for(var i=u;c<r.length;c++)r[c].value<i.value&&(i=r[c]);return i.cycleBreaker=!0,i}if(r.push(u),u=t(e,r),r.pop(),u)return u}}for(var r,e=n.length-1;e>=0;e--)if(r=t(n[e],[]))return r}function u(){v.forEach(function(n){n.targetLinks.length||(n.x=d3.min(n.sourceLinks,function(n){return n.target.x})-1)})}function o(n){v.forEach(function(t){t.sourceLinks.length||(t.x=n-1)})}function c(n){v.forEach(function(t){t.x*=n})}function i(n){function t(){var n=d3.min(c,function(n){return(d[1]-(n.length-1)*l)/d3.sum(n,s)});c.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),k.forEach(function(t){t.dy=t.value*n})}function r(n){function t(n){return(n.source.y+n.sy+n.dy/2)*n.value}c.forEach(function(r,e){r.forEach(function(r){if(r.targetLinks.length){var e=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,s);r.y+=(e-a(r))*n}})})}function e(n){function t(n){return(n.target.y+n.ty+n.dy/2)*n.value}c.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var e=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,s);r.y+=(e-a(r))*n}})})}function u(){c.forEach(function(n){var t,r,e=0,u=n.length,o;for(n.sort(h),o=0;o<u;++o)t=n[o],r=e-t.y,r>0&&(t.y+=r),e=t.y+t.dy+l;if((r=e-l-d[1])>0)for(e=t.y-=r,o=u-2;o>=0;--o)t=n[o],r=t.y+t.dy+l-e,r>0&&(t.y-=r),e=t.y})}function o(n,t){return n.y-t.y}var c=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(v).map(function(n){return n.values});t(),u(),f();for(var i=1;n>0;--n)e(i*=.99),u(),f(),r(i),u(),f()}function f(){function n(n,t){return n.source.y-t.source.y}function t(n,t){return n.target.y-t.target.y}v.forEach(function(n){n.sourceLinks.sort(h),n.targetLinks.sort(h)}),v.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function a(n){return n.y+n.dy/2}function s(n){return n.value}function h(n,t){var r=n.value,e=t.value;return r<e?1:r>e?-1:0}var y={},g=24,l=30,d=[1,1],v=[],k=[],L=!0;return y.nodeWidth=function(n){return arguments.length?(g=+n,y):g},y.nodePadding=function(n){return arguments.length?(l=+n,y):l},y.nodes=function(n){return arguments.length?(v=n,y):v},y.links=function(n){return arguments.length?(k=n,y):k},y.size=function(n){return arguments.length?(d=n,y):d},y.sinksRight=function(n){return arguments.length?(L=n,y):L},y.layout=function(e){return n(),t(),r(),i(e),y},y.relayout=function(){return f(),y},y.link=function(){function n(n){var r=n.source.x+n.source.dx,e=n.target.x,u=d3.interpolateNumber(r,e),o=u(t),c=u(1-t),i=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;if(n.cycleBreaker){var a=1.5*n.dy+.05*Math.abs(r-e);o=r+a,c=e-a;var s=u(.5),h=d3.interpolateNumber(i,f)(.5),y=(2*n.dy+.1*Math.abs(r-e)+.1*Math.abs(i-f))*(h<d[1]/2?-1:1);return"M"+r+","+i+"C"+o+","+i+" "+o+","+(i+y)+" "+s+","+(h+y)+"S"+c+","+f+" "+e+","+f}return"M"+r+","+i+"C"+o+","+i+" "+c+","+f+" "+e+","+f}var t=.5;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},y};
//# sourceMappingURL=./d3-sankeyLoop-min.js.map