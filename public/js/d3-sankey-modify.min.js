"use strict";d3.sankey=function(){function n(){l.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),d.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=l[n.source]),"number"==typeof r&&(r=n.target=l[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){l.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function r(){for(var n,t=l,o=0;t.length&&o<l.length;){if(n=[],t.forEach(function(t){t.x=t.position-1,t.dx=h,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&!t.cycleBreaker&&n.push(t.target)})}),n.length==t.length)return e(n),r();t=n,++o}u((g[0]-h)/5)}function e(n){function t(n,r){for(var e,u,o=n.sourceLinks.length-1;o>=0;o--)if(u=n.sourceLinks[o],!u.cycleBreaker){e=u.target;for(var i=0;i<r.length;i++)if(r[i].source==e){for(var c=u;i<r.length;i++)r[i].value<c.value&&(c=r[i]);return c.cycleBreaker=!0,c}if(r.push(u),u=t(e,r),r.pop(),u)return u}}for(var r,e=n.length-1;e>=0;e--)if(r=t(n[e],[]))return r}function u(n){l.forEach(function(t){t.x*=n})}function o(n){function t(){r.forEach(function(n){var t,r,e,u=0,o=n.length;for(n.sort(a),e=0;e<o;++e)t=n[e],r=u-t.y,r>0&&(t.y+=r),u=t.y+t.dy+y;if((r=u-y-g[1])>0)for(u=t.y-=r,e=o-2;e>=0;--e)t=n[e],r=t.y+t.dy+y-u,r>0&&(t.y-=r),u=t.y})}var r=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(l).map(function(n){return n.values});!function(){var n=d3.min(r,function(n){return(g[1]-(n.length-1)*y)/d3.sum(n,f)});r.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),d.forEach(function(t){t.dy=t.value*n})}(),t(),i();for(var e=1;n>0;--n)!function(n){function t(n){return(n.target.y+n.ty+n.dy/2)*n.value}r.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var e=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,f);r.y+=(e-c(r))*n}})})}(e*=.99),t(),i(),function(n){function t(n){return(n.source.y+n.sy+n.dy/2)*n.value}r.forEach(function(r,e){r.forEach(function(r){if(r.targetLinks.length){var e=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,f);r.y+=(e-c(r))*n}})})}(e),t(),i()}function i(){l.forEach(function(n){n.sourceLinks.sort(a),n.targetLinks.sort(a)}),l.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function c(n){return n.y+n.dy/2}function f(n){return n.value}function a(n,t){var r=n.positionY,e=t.positionY;return r<e?-1:r>e?1:0}var s={},h=24,y=30,g=[1,1],l=[],d=[],v=!0;return s.nodeWidth=function(n){return arguments.length?(h=+n,s):h},s.nodePadding=function(n){return arguments.length?(y=+n,s):y},s.nodes=function(n){return arguments.length?(l=n,s):l},s.links=function(n){return arguments.length?(d=n,s):d},s.size=function(n){return arguments.length?(g=n,s):g},s.sinksRight=function(n){return arguments.length?(v=n,s):v},s.layout=function(e){return n(),t(),r(),o(e),s},s.relayout=function(){return i(),s},s.link=function(){function n(n){var r=n.source.x+n.source.dx,e=n.target.x,u=d3.interpolateNumber(r,e),o=u(t),i=u(1-t),c=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;if(n.cycleBreaker){var a=1.5*n.dy+.05*Math.abs(r-e);o=r+a,i=e-a;var s=u(.5),h=d3.interpolateNumber(c,f)(.5),y=(2*n.dy+.1*Math.abs(r-e)+.1*Math.abs(c-f))*(h<g[1]/2?-1:1);return"M"+r+","+c+"C"+o+","+c+" "+o+","+(c+y)+" "+s+","+(h+y)+"S"+i+","+f+" "+e+","+f}return"PÃ©rdidas"===n.target.name?"M "+r+" "+c+"\n                  L "+(r+5)+" "+c+"\n                  C "+(r+5+5)+" "+c+" "+(r+5+5)+" "+c+" "+(r+5+5)+" "+(c+15):"M"+r+","+c+" C"+o+","+c+" "+i+","+f+" "+e+","+f}var t=.75;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},s};