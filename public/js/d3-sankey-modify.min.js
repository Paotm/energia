"use strict";d3.sankey=function(){function n(){g.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),d.forEach(function(n){var r=n.source,t=n.target;"number"==typeof r&&(r=n.source=g[n.source]),"number"==typeof t&&(t=n.target=g[n.target]),r.sourceLinks.push(n),t.targetLinks.push(n)})}function r(){g.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function t(){for(var n,r=g,o=0;r.length&&o<g.length;){if(n=[],r.forEach(function(r){r.x=r.position-1,r.dx=h,r.sourceLinks.forEach(function(r){n.indexOf(r.target)<0&&!r.cycleBreaker&&n.push(r.target)})}),n.length==r.length)return e(n),t();r=n,++o}u((l[0]-h)/5)}function e(n){function r(n,t){for(var e,u,o=n.sourceLinks.length-1;o>=0;o--)if(u=n.sourceLinks[o],!u.cycleBreaker){e=u.target;for(var c=0;c<t.length;c++)if(t[c].source==e){for(var i=u;c<t.length;c++)t[c].value<i.value&&(i=t[c]);return i.cycleBreaker=!0,i}if(t.push(u),u=r(e,t),t.pop(),u)return u}}for(var t,e=n.length-1;e>=0;e--)if(t=r(n[e],[]))return t}function u(n){g.forEach(function(r){r.x*=n})}function o(n){function r(){t.forEach(function(n){var r,t,e,u=0,o=n.length;for(n.sort(a),e=0;e<o;++e)r=n[e],t=u-r.y,t>0&&(r.y+=t),u=r.y+r.dy+y;if((t=u-y-l[1])>0)for(u=r.y-=t,e=o-2;e>=0;--e)r=n[e],t=r.y+r.dy+y-u,t>0&&(r.y-=t),u=r.y})}var t=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(g).map(function(n){return n.values});!function(){var n=d3.min(t,function(n){return(l[1]-(n.length-1)*y)/d3.sum(n,f)});t.forEach(function(r){r.forEach(function(r,t){r.y=t,r.dy=r.value*n})}),d.forEach(function(r){r.dy=r.value*n})}(),r(),c();for(var e=1;n>0;--n)!function(n){function r(n){return(n.target.y+n.ty+n.dy/2)*n.value}t.slice().reverse().forEach(function(t){t.forEach(function(t){if(t.sourceLinks.length){var e=d3.sum(t.sourceLinks,r)/d3.sum(t.sourceLinks,f);t.y+=(e-i(t))*n}})})}(e*=.99),r(),c(),function(n){function r(n){return(n.source.y+n.sy+n.dy/2)*n.value}t.forEach(function(t,e){t.forEach(function(t){if(t.targetLinks.length){var e=d3.sum(t.targetLinks,r)/d3.sum(t.targetLinks,f);t.y+=(e-i(t))*n}})})}(e),r(),c()}function c(){g.forEach(function(n){n.sourceLinks.sort(a),n.targetLinks.sort(a)}),g.forEach(function(n){var r=0,t=0;n.sourceLinks.forEach(function(n){n.sy=r,r+=n.dy}),n.targetLinks.forEach(function(n){n.ty=t,t+=n.dy})})}function i(n){return n.y+n.dy/2}function f(n){return n.value}function a(n,r){var t=n.value,e=r.value;return t<e?1:t>e?-1:0}var s={},h=24,y=30,l=[1,1],g=[],d=[],v=!0;return s.nodeWidth=function(n){return arguments.length?(h=+n,s):h},s.nodePadding=function(n){return arguments.length?(y=+n,s):y},s.nodes=function(n){return arguments.length?(g=n,s):g},s.links=function(n){return arguments.length?(d=n,s):d},s.size=function(n){return arguments.length?(l=n,s):l},s.sinksRight=function(n){return arguments.length?(v=n,s):v},s.layout=function(e){return n(),r(),t(),o(e),s},s.relayout=function(){return c(),s},s.link=function(){function n(n){var t=n.source.x+n.source.dx,e=n.target.x,u=d3.interpolateNumber(t,e),o=u(r),c=u(1-r),i=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;if(n.cycleBreaker){var a=1.5*n.dy+.05*Math.abs(t-e);o=t+a,c=e-a;var s=u(.5),h=d3.interpolateNumber(i,f)(.5),y=(2*n.dy+.1*Math.abs(t-e)+.1*Math.abs(i-f))*(h<l[1]/2?-1:1);return"M"+t+","+i+"C"+o+","+i+" "+o+","+(i+y)+" "+s+","+(h+y)+"S"+c+","+f+" "+e+","+f}return"M"+t+","+i+"C"+o+","+i+" "+c+","+f+" "+e+","+f}var r=.5;return n.curvature=function(t){return arguments.length?(r=+t,n):r},n},s};